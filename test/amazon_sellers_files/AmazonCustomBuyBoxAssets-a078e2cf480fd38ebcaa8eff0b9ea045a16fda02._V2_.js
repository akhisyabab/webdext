(function(C){var A=window.AmazonUIPageJS||window.P,v=A._namespace||A.attributeErrors,l=v?v("ProductCustomizationSingleTextAssets"):A;l.guardFatal?l.guardFatal(C)(l,window):l.execute(function(){C(l,window)})})(function(C,A,v){C.when("A","ac-widget","ac-ajax-fetcher","ready").register("ac-ajax-customizer",function(l,p,g){var e=l.$;return function(a){var d=this;d.viewName=a.viewName;d.viewFactory=a.viewFactory;d.deviceType=a.deviceType;var c=new g("#a-popover-"+d.viewName,d.deviceType),b=[],k=function(b){l.each(b.states,
function(b,a){l.state.replace(a,b)})},f=function(){var a=!!e("html").hasClass("a-canvas");l.declarative("pc-customization-button","click",function(f){"function"===typeof A.uet&&A.uet("bb","amazonCustomOLP",{wb:1});var g=f.data,r=g.asin,m=g.merchantID,g=g.refTag,u=f.$target,t=d.viewFactory.get(u);l.trigger("amazon-custom-log-ref-tag","CustomizeNowClick");if(null===t){if(0<b.length){for(f=0;f<b.length;f++)d.viewFactory.remove(b[f]);b.length=0}c.fetch(r,m,g,function(f){0<b.length||(k(f),e("#pc-custom-popover-injection").length||
e("body").append(e("<div>").attr("id","pc-custom-popover-injection").addClass("aok-hidden")),e("#pc-custom-popover-injection").empty().append(f.popoverHtml),t=d.viewFactory.create(u,{name:d.viewName,header:f.header,activate:"onclick",popoverLabel:"customize now popover"}),t.lock().show(),b.push(t),a&&(new p).init())})}"function"===typeof A.uet&&A.uex("ld","amazonCustomOLP",{wb:1})})};d.init=function(b){b&&(b=e("span.a-declarative[data-action='pc-customization-button']").first(),b.length&&(b=b.data("pc-customization-button"))&&
c.fetch(b.asin,b.merchantID,b.refTag));f()}}});C.when("A").register("ac-ajax-fetcher",function(l){var p=l.$;return function(g,e){var a={},d=function(a){var b=p(a);if(!b.find(g).length)throw A.console&&console.log("Missing popover html",a),"Missing popover html";a=b.find(".pc-popover-header").remove().text();var k=b.find(g).append(b.find("input#amazonCustomUseCaseId")).wrapAll("<div>").parent().html(),f={states:{},header:a,popoverHtml:k,disabledMessage:b.find(".pc-customization-disabled div:first").html()};
b.find("script").each(function(){var b=p(this).data("a-state");b&&b.key&&(f.states[b.key]=JSON.parse(p(this).text()))});return f};this.fetch=function(c,b,k,f){f||(f=function(){});var h="a:"+c+"-m:"+b+"-refTag:"+k;h in a?f(a[h]):l.get("/gp/product/features/pc-buybox.html",{params:{asin:c,merchantID:b,refTag:k,deviceType:e},success:function(b){b=d(b);a[h]=b;f(b)},error:function(a,f,h){a="Failed to fetch popover data for asin:'"+c+"' and merchantID:'"+b+"'";A.console&&console.log(a,h);throw a;}})}}});
(function(){C.when("A","acc-weblab","ready").register("ac-base",function(l,p){var g=l.$;l.on("pc-single-text-loaded",function(){g("html").hasClass("a-canvas")||(g(".pc-customization-disabled").addClass("active"),g(".pc-customization-enabled").remove())});return{getASIN:function(){return 1<=g(".ac-mobile-app").length?g(".ac-meta-data").find("#asin").val():g("#ASIN").val()},getOfferListingID:function(){return g("#offerListingID").val()},getMerchantID:function(){return 1<=g(".ac-mobile-app").length?
g(".ac-meta-data").find("#merchantID").val():g("#merchantID").val()},isApp:function(){return p.isT1("AC_PRODUCT_TABLETAPP_75334")?1<=g(".ac-mobile-app").length||1<=g(".ac-tablet-app").length:1<=g(".ac-mobile-app").length}}});C.when("A","ac-base","ready").execute(function(l,p){function g(b){var c="/gp/product/features/log-message.html/ref="+b.refTag,f;a++;f="ajax_amzon_custom_log"+a;if(A.ue){var h=A.uet;h("tc",f)}e.ajax({type:"POST",url:c,dataType:"json",data:{component:b.component,message:b.msg,isMetricsNeeded:b.isMetricsNeeded},
success:function(b){b=b.result.rid;if(A.ue){var a=A.ues,h=A.uet,c=A.uex;a("id",f,b);a("t0",f,new Date);a("ctb",f,"1");h("cf",f);h("be",f);c("ld",f)}}})}var e=l.$,a=0,d=p.getASIN(),c={CustomizeNowClick:{refTag:"amz_custom_cn_clk_"+d,component:"Amazon Custom customize now button",msg:"Amazon Custom customize now button clicked",isMetricsNeeded:!1},AddToCartClick:{refTag:"amz_custom_atc_clk_"+d,component:"Amazon Custom Add to cart",msg:"Amazon Custom add to cart clicked",isMetricsNeeded:!1},CloseClick:{refTag:"amz_custom_cls_clk_"+
d,component:"Amazon Custom Add to cart",msg:"Amazon Custom close button clicked",isMetricsNeeded:!1},FontChange:{refTag:"amz_custom_font_chg_"+d,component:"Font drop down list",msg:"Font selected from drop down list",isMetricsNeeded:!1},FontColorChange:{refTag:"amz_custom_color_chg_"+d,component:"Font drop down list",msg:"Font selected from drop down list",isMetricsNeeded:!1},logCustomImageTabClick:{refTag:"pc_ci_tab_clk",component:"Custom image",msg:"Custom Image click",isMetricsNeeded:!1},logVendorGalleryTabClick:{refTag:"pc_ig_tab_clk",
component:"Vendor image gallery",msg:"Vendor image gallery click",isMetricsNeeded:!1},logAddTextTabClick:{refTag:"pc_at_tab_clk",component:"Add Text",msg:"Add Text Click",isMetricsNeeded:!1},logUseThisDesignClick:{refTag:"pc_utdbtn_clk_"+d,component:"UseThisDesignClick",msg:"Use this design click",isMetricsNeeded:!0},logS3TextUploadError:{refTag:"pc_s3_txt_err",component:"S3TextUploadError",msg:"S3 error on text upload",isMetricsNeeded:!0},logS3ImageUploadError:{refTag:"pc_s3_img_pst_err",component:"S3ImageUploadError",
msg:"S3 error on image upload",isMetricsNeeded:!0},logUseThisDesignKindleHucClick:{refTag:"pc_utdgbtn_clk_kin_huc_"+d,component:"UseThisDesignKindleHucClick",msg:"Use this Design From Kindle Click",isMetricsNeeded:!1},hasNonASCII:{refTag:"amz_custom_has_non_ASCII",component:"Text",msg:"Added Non ASCII. PC-Token - ",isMetricsNeeded:!0}};l.on("amazon-custom-popup-open",function(){this.popupOpenTime=new Date});l.on("amazon-custom-popup-close",function(b){b-=this.popupOpenTime;A.ue.count("pcSingleTextTimer",
b/1E3);A.ue.count("pcSingleTextTimer")});l.on("logVendor-ref-Click",function(b){b={refTag:"pc_vi_"+b.categoryName.substring(0,4)+"_"+d,component:"theme for selected vendor image",msg:"Theme selected for vendor image is "+b.categoryName,isMetricsNeeded:!1};g(b)});l.on("amazon-custom-log-ref-tag",function(b,a){if(b!==v){var f=c[b];f!==v&&(a&&a.msg&&(f.msg+=a.msg),g(f))}})})})();(function(){C.when("A","fabric-js","ac-base","ac-utils","ac-constants","ac-simple-textInput","ac-gallery","ac-image-gallery",
"ac-text-image","ac-error-handling","acc-weblab","ready").register("ac-canvas",function(l,p,g,e,a,d,c,b,k,f,h){var n=l.$;return function(b,c){var m=this;m.isActive=!1;m.surface=c;m.childCanvas=[];m.canvas=b;m.isChild=m.canvas.isChild?m.canvas.isChild:!1;m.controls={};m.canvasObjects=[];m.name="";m.data;m.canvas.index!==v?(m.id=m.surface.id+"-area-"+m.canvas.index,m.data=c.data.areas[m.canvas.index],m.name=m.data.name):(m.id=m.surface.id+"-primary",m.isChild=!1);m.currentSelectedObject=null;m.enableBuyBox=
!1;m.hasRequiredField=function(){return"TextPrinting"===m.data.customizationType?m.controls&&m.controls.simpleTextInput&&m.controls.simpleTextInput.hasRequiredField():!1};m.requiredFieldsAreValid=function(){return"TextPrinting"===m.data.customizationType?m.controls&&m.controls.simpleTextInput&&m.controls.simpleTextInput.requiredFieldsAreValid():!0};m.emphasizeMissingField=function(){"TextPrinting"===m.data.customizationType&&m.controls&&m.controls.simpleTextInput&&n.isFunction(m.controls.simpleTextInput.emphasizeMissingField)&&
m.controls.simpleTextInput.emphasizeMissingField()};m.containsEmoji=function(){var b=!1;"TextPrinting"===m.data.customizationType&&(b=m.controls&&m.controls.simpleTextInput&&m.controls.simpleTextInput.containsEmoji());"ImagePrinting"===m.data.customizationType&&(b=m.controls&&m.controls.textInput&&m.controls.textInput.imgText&&m.controls.textInput.imgText.containsEmoji());return b};m.renderAll=function(b){b=b?b:1;m.isChild?(m.canvas.renderAll(),setTimeout(function(){e.debounce(m.surface.updatePrimaryCanvas(m.canvas.index),
25)},b)):m.canvas.renderAll()};m.getObjects=function(){return m.canvas.getObjects()};m.toDataURL=function(){try{m.canvas.toDataURL()}catch(b){return null}};m.verifyScaling=function(){m.canvas.off("object:modified");m.canvas.on("object:modified",function(b){b=b.target;m.renderAll();"text"!==b.type&&(1.5<b.scaleX||1.5<b.scaleY?f.show("pc-scale-warning-message"):f.hide(),m.canvas.calcOffset());m.dragResetObject()})};m.dragResetObject=function(){var b=m.canvas.getActiveObject();if(b){var a=parseInt(m.canvas.width,
10),h=parseInt(m.canvas.height,10),c=new p.Rect({left:0,top:0,width:a,height:h,opacity:0}),k=new p.Point(0,0),d=new p.Point(0+a,0+h);m.canvas.add(c);k=b.intersectsWithObject(c)||c.isContainedWithinObject(b)||b.isContainedWithinRect(k,d);m.canvas.remove(c);k||(b.set({left:0+(a/2-b.width/2),top:0+(h/2-b.height/2),scaleX:1,scaleY:1,angle:0}),f.hide(),b.setCoords(),m.canvas.calcOffset(),m.renderAll(50))}};m.clear=function(){m.canvas.clear();for(var b in m.controls)m.controls.hasOwnProperty(b)&&m.controls[b].cleared&&
(m.controls[b].cleared(),m.controls[b].isControlActive=!1);m.renderAll()};m.childCanvas=[];m.addGalleryImage=function(b){var a=m.getObjects();e.imageLoading.show();for(var f=m.canvas.size()-1;0<=f;f--)if(a[f].name&&"galImage"===a[f].name||a[f].name&&"cusImage"===a[f].name||"text"===a[f].type)m.canvas.remove(a[f]),m.controls.gallery;m.controls.textInput&&m.controls.textInput.imgText&&(m.controls.textInput.imgText.resetControl(),m.controls.textInput.isControlActive=!1);n("#pcTextArea").val("");n(".ac-upload-tnC").fadeOut();
p.Image.fromURL(b.imageUrl,function(a){m.canvas.add(a);a.name="galImage";e.imageLoading.hide();m.renderAll();a.vendorGalleryFileId=b.vendorGalleryFileId;a.vendorGalleryId=b.vendorGalleryId;a.originalURL=b.originalURL;n(".pc-two-column-layout .ac-delete-button").fadeIn()},{height:m.canvas.height,width:m.canvas.width,selectable:!1,crossOrigin:"anonymous"})};m.addCustomerImage=function(b){var f=m.canvas,h=parseInt(n(b.element).attr("data-original-width"),10),c=parseInt(n(b.element).attr("data-original-height"),
10);f.deactivateAll();l.each(m.getObjects(),function(b){"galImage"!==b.name&&"cusImage"!==b.name||f.remove(b)});p.Image.fromURL(function(b){var f=Math.max(h/(a.outputSVGDimention.width/a.scaleRatio),c/(a.outputSVGDimention.height/a.scaleRatio)),f=h*(1<f?1/f:1),k=/[.]/.exec(b.imageUrl)?/[^.]+$/.exec(b.imageUrl):v;b=b.imageUrl.split(k[0]);var k=k[0],d="";"png"===k.toLowerCase()&&(d="_AL__FMPng_");return b[0]+"_SX"+f+"_"+d+"."+k}(b),function(b){f.add(b);b.width=h/a.scaleRatio;b.height=c/a.scaleRatio;
var k=Math.max(b.height/f.height,b.width/f.width);1<k&&(b.width/=1.1*k,b.height/=1.1*k);b.left=(f.width-b.width)/2;b.top=(f.height-b.height)/2;f.calcOffset();b.setCoords();e.imageLoading.hide();b.name="cusImage";b.sendToBack();f.setActiveObject(b);m.renderAll()},{crossOrigin:"anonymous",transparentCorners:!1,centeredScaling:!0,lockUniScaling:!0});n(".ac-upload-tnC").fadeIn()};m.setActiveControl=function(b){for(var a in m.controls)m.controls.hasOwnProperty(a)&&m.controls[a]&&(m.controls[a].isControlActive=
!1);m.controls[b].isControlActive=!0};m.resetControls=function(){var b=!1,a;a=function(){n(".ac-btn-makeOwn.ac-imageUpload").trigger("click")};for(var f in m.controls)if(m.controls.hasOwnProperty(f)&&m.controls[f].isControlActive)switch(f){case "textInput":n(".ac-btn-makeOwn.ac-textInput").trigger("click");b=!0;break;case "imageUpload":n(".ac-btn-makeOwn.ac-imageUpload").trigger("click"),b=!0}b?null:a()};m.activate=function(){};m.bindEvents={commonEvent:function(){m.canvas.off("canvas:cleared");m.canvas.on("canvas:cleared",
function(){for(var b=0;b<=m.controls.length;b++)m.controls[b].cleared&&m.controls[b].cleared()});m.canvas.off("object:modified");m.canvas.on("object:modified",function(b){b=b.target;m.controls.textInput?("text"!==b.type&&((1.5<b.scaleX||1.5<b.scaleY)&&f.show("pc-scale-warning-message"),(1.5>b.scaleX||1.5>b.scaleY)&&f.hide(),m.canvas.calcOffset()),m.dragResetObject(),m.renderAll()):m.controls.imageUpload&&(m.dragResetObject(),m.renderAll())})},hoverAndSelect:function(){var b=n(m.canvas.getSelectionElement()),
a=[4,4],f=function(b){var f=b.canvas,h={};l.each({borderStrokeDashArray:a,borderScaleFactor:.5,hasControls:!1,active:!0},function(a,f){h[f]=b[f];b[f]=a});var c=f._activeObject;f._activeObject=b;b._renderControls(f.getContext());l.each(h,function(a,f){b[f]=a});f._activeObject=c};m.canvas.on("object:selected",function(f){f=f.target;f.borderStrokeDashArray=a;f.borderScaleFactor=.5;f.hasControls=!0;f.canvas.renderAll();b.closest(".canvas-container").addClass("show-border")});m.canvas.on("mouse:over",
function(b){b=b.target;b.active||f(b)});m.canvas.on("mouse:out",function(b){b=b.target;b.active||b.canvas.renderAll()});b.bind("mouseleave",function(){m.canvas._fireOverOutEvents(null)});m.canvas.on("selection:cleared",function(){b.closest(".canvas-container").removeClass("show-border")});n(".ac-preview-container").bind("click",function(b){b=b.target;n(b).is("canvas")&&n.contains(m.canvas.wrapperEl,b)||(m.canvas.deactivateAllWithDispatch(),m.canvas.renderAll())})},imageUpload:function(){m.controls.imageUpload.cleared=
function(){f.hide();n(".ac-upload-tnC").fadeOut()}},imageAndText:function(){m.controls.textInput={};m.canvas.off("object:selected");m.canvas.on("object:selected",function(b){if(b=b.target)"text"===b.type?(m.currentSelectedObject="text",""!==b.text&&n(".pc-two-column-layout .ac-delete-button").fadeIn(),l.trigger("slideUpTextArea")):(m.currentSelectedObject="other",l.trigger("slideDownTextArea"),n(".pc-two-column-layout .ac-delete-button").fadeIn())});m.canvas.off("selection:cleared");m.canvas.on("selection:cleared",
function(){"text"===m.currentSelectedObject&&(m.currentSelectedObject="other",l.trigger("slideDownTextArea"));n(".pc-two-column-layout .ac-delete-button").fadeOut()});m.controls.textInput.cleared=function(){n("#pcTextArea").val("");m.controls.textInput.imgText.cleared();l.each(m.getObjects(),function(b){"text"===b.type&&b.remove()});l.trigger("slideDownTextArea")}}};m.bindControls=function(){var b=n(".ac-area-control."+m.id+", .ac-area-control.ac-widget-control"),a;n.each(b,function(b,f){a=n(f).attr("data-control-template");
switch(a){case "simple-textInput":var h=new d(f,m,{});m.controls.simpleTextInput=h;break;case "imageUpload":"ImagePrinting"===m.surface.customizationType&&(m.verifyScaling(),m.controls.imageUpload={isControlActive:!0},m.bindEvents.imageUpload());break;case "textInput":"ImagePrinting"===m.surface.customizationType&&m.data.customizationTypeSettings.ImagePrinting.isCustomTextSupported&&(m.bindEvents.imageAndText(),m.controls.textInput.imgText=new k(m,{}))}})};m.controlRenderingHandle=function(){var b,
a,f;if("ImagePrinting"===m.surface.customizationType){var h,c,k,d,e=!1;f=a=b=!1;n(".ac-imageUpload-control");h=n(".ac-btn-makeOwn.ac-imageUpload");n(".ac-textInput-control");c=n(".ac-btn-makeOwn.ac-textInput");k=n('.a-tab-heading[data-a-tab-name="gallery"]');d=n('.a-tab-heading[data-a-tab-name="makeOwn"]');m.data.customizationTypeSettings.ImagePrinting&&(m.data.customizationTypeSettings.ImagePrinting.isGallerySupported&&m.data.customizationTypeSettings.ImagePrinting.galleries&&m.data.customizationTypeSettings.ImagePrinting.galleries.length&&
(b=!0),m.data.customizationTypeSettings.ImagePrinting.isCustomerUploadSupported&&(a=!0),m.data.customizationTypeSettings.ImagePrinting.isCustomTextSupported&&(f=!0));k.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");h.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");c.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");
d.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-list-item");b?k.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-list-item"):d.trigger("click");a?h.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-inline"):(n(".ac-imageUpload-control").removeClass("active"),n(".ac-btn-makeOwn.ac-imageUpload").removeClass("active"));
f&&(c.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-inline"),a||(m.surface.widget.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){b=b.getObjects();for(var a=0;a<b.length;a++)b[a].name&&"galImage"===b[a].name&&(e=!0)})}),e||setTimeout(function(){c.trigger("click")},50)));a||f||(d.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden"),k.addClass("a-active"),
k.parents(".a-tab-container").find('.a-tab-content[data-a-name="makeOwn"]').addClass("a-hidden").siblings('.a-tab-content[data-a-name="gallery"]').removeClass("a-hidden").addClass("a-active"))}};m.fulfillmentJSON=function(){var b={},a=m.getObjects(),f,h;m.canvas.deactivateAll();h=function(){var b,a;a={};for(a=0;a<m.surface.data.FontSettings.colors.length;a++)if(m.surface.data.FontSettings.colors[a].value===m.surface.color){b=m.surface.data.FontSettings.colors[a].name;break}a=m.data.customizationTypeSettings.TextPrinting.placeHolderText;
a={fontFamily:m.surface.fontName,text:m.controls.simpleTextInput.inputBox.val(),fill:m.surface.color,customizationType:"TextPrinting",label:a?a:""};b&&(a.colorName=b);return a};b.name=m.name;b.Position=m.data.specifications.position;b.Dimensions=m.data.specifications.dimension;if("ImagePrinting"===m.surface.customizationType){for(h=0;h<a.length;h++)if(a[h].name&&"galImage"===a[h].name){var c=a[h].originalURL;f="VendorGallery";b.vendorGalleryImagePath=c;b.vendorGalleryFileId=a[h].vendorGalleryFileId;
b.vendorGalleryId=a[h].vendorGalleryId;b.customizationType="ImagePrinting"}else"text"!==a[h].type||a[h].text.replace(" ","").length||a[h].remove();!f&&a.length&&(f="SVG",b.canvas=m.canvas,b.customizationType="ImagePrinting")}else f="JSON",b=n.extend(b,h());"AC_ImgTxtPersonalization_3"===n("#amazonCustomUseCaseId").val()&&(b.id=m.id);b.fulfillmentType=f;return b};m.init=function(){m.isChild&&(m.bindControls(),m.bindEvents.hoverAndSelect(),m.controlRenderingHandle());if(1<=n(".ac-mobile-app").length)l.on("resize-preview-text",
function(){m.controls.simpleTextInput&&m.controls.simpleTextInput.inputBox&&m.controls.simpleTextInput.inputBox.trigger("keyup")});h.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_LAUNCH_75411")&&m.controls.simpleTextInput&&!m.controls.simpleTextInput.hasRequiredField()&&m.controls.simpleTextInput.hideIsRequiredLabel()}}})})();(function(){C.when("A","ac-base","fabric-js","ac-utils","ac-canvas","ac-color-picker","ac-font-picker","ac-constants","ac-base","acc-weblab","ready").register("ac-surface",function(l,p,
g,e,a,d,c,b,k,f){var h=l.$;return function(n,q,r){var m={},u,t,H,F,z,J,G;m.isActive=!1;m.name="";m.productImageUrl="";m.maskImageUrl="";m.primaryCanvas=null;m.thumbnail=null;m.childCanvasList=[];m.controls={};m.id;m.font=p.getMerchantID()+"-Arial";m.customizationType=n.areas[0].customizationType;m.data=n;m.widget=q;m.isApp=k.isApp();G=h("html.a-ie9").length||l.capabilities.isIE10;m.miniThumbnailCanvas=[];u=function(b,f){var h=new a(b,m);h.init();if(k.isApp())l.on("resize-preview-text",function(){if(f!==
v){var a=e.getScaleRatio(),h=f.specifications.dimension.height*a+5;b.setWidth(f.specifications.dimension.width*a);b.setHeight(h)}});return h};H=function(){for(var b=h('.ac-controls-container[data-surface="surface-'+n.index+'"]').find('[type="text"]'),a=0;a<b.length;a++)if(b[a].value.length)return!0;return!1};t=function(b,a){var f,c,k,d,n,q,r=m.isApp,t;if(a.isChild)return null;c=b.specifications.position.y;k=b.specifications.position.x;d=b.specifications.dimension.height;n=b.specifications.dimension.width;
q=b.specifications.angle?b.specifications.angle:0;f=document.createElement("canvas");f.id=m.id+"-area-"+b.index;f.className+=" canvasArea";r?(t=e.getScaleRatio(),f.setAttribute("data-left",k*t),f.setAttribute("data-top",c*t),f.setAttribute("data-initial-left",k),f.setAttribute("data-initial-top",c),f.setAttribute("data-initial-width",n),f.setAttribute("data-initial-height",d),f.setAttribute("data-angle",q),f.height=d*t+5,f.width=n*t):(f.setAttribute("data-left",k),f.setAttribute("data-top",c),f.setAttribute("data-angle",
q),f.height=d+5,f.width=n);h('.ac-preview-container[data-surface="'+m.id+'"]').append(f);f.getContext("2d");var u=new g.Canvas(f.id);q="rotate("+q+"deg)";r?h(f).parent(".canvas-container").css({width:n*t,height:d*t,position:"absolute",top:c*t+"px",left:k*t+"px","-ms-transform":q,"-webkit-transform":q,transform:q}):h(f).parent(".canvas-container").css({position:"absolute",top:c+"px",left:k+"px","-ms-transform":q,"-webkit-transform":q,transform:q});u.isChild=!0;u.parent=a;u.index=b.index;return u};
F=function(a){var f=new Image;f.crossOrigin="anonymous";f.src=n.preview.url;f.onload=function(){a.canvas.setBackgroundImage(new g.Image(f,{originX:"left",originY:"top",left:0,top:0}),function(){a.renderAll.bind(a.canvas);e.debounce(m.updateThumbnail(),50)})};if(n.mask&&n.mask.url){var c=new Image;c.crossOrigin="anonymous";c.src=n.mask.url;c.style.top="-"+n.areas[0].specifications.position.y+"px";c.style.left="-"+n.areas[0].specifications.position.x+"px";c.style.width=b.defaults.maskWidth+"px";c.style.height=
b.defaults.maskHeight+"px";c.style.maxWidth="none";c.onload=function(){a.canvas.setOverlayImage(new g.Image(c,{originY:"top",originX:"left",left:0,top:0}),function(){a.renderAll.bind(a.canvas);e.debounce(m.updateThumbnail(),25)});h("#"+m.id+"-area-0").after(c)}}};z=function(b){for(var a,f=0;f<n.areas.length;f++)a=n.areas[f],a.index=f,a=m.isApp?u(t(a,b),a):u(t(a,b)),0===f&&m.setActiveArea(a),b.childCanvas.push(a);F(b);return b.childCanvas};J=function(){var b,a=m.data.areas[0].customizationTypeSettings.ImagePrinting.galleries,
f,c=!1,k,d;h("#ac-gallery.vendor-categories > .vendor-category").css({display:"none"});m.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery&&(f=m.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery);for(var e=0;e<a.length;e++)if(b="",b="/"===a[e].charAt(0)?a[e].substr(1,a[e].length):a[e])k=h('#ac-gallery.vendor-categories > .vendor-category > a[data-themename="'+b+'"]'),d=h('#ac-gallery.vendor-categories > .vendor-category > a[data-categoryid="'+b+'"]'),k.length?
(k.parent(".vendor-category").css({display:"block"}),f&&f.substr(1,f.length)===b&&(k.trigger("click"),c=!0)):d.length&&(d.parent(".vendor-category").css({display:"block"}),f&&f.substr(1,f.length)===b&&(d.trigger("click"),c=!0));c||h("#ac-gallery.vendor-categories > .vendor-category > a").each(function(b,a){"block"===h(a).parent(".vendor-category").css("display")&&h(a).trigger("click")})};m.setActiveArea=function(b){for(var a=0;a<m.childCanvasList.length;a++)m.childCanvasList[a].isActive=!1;b.isActive=
!0;return b};m.updateTickerOnTab=function(){H()?h(".pc-surface-nav-carousel").find('[data-surface-num="'+(n.index+1)+'"]').addClass("customized"):h(".pc-surface-nav-carousel").find('[data-surface-num="'+(n.index+1)+'"]').removeClass("customized")};m.isSurfaceCustomized=function(){for(var b=h('.ac-controls-container[data-surface="surface-'+n.index+'"]').find('[type="text"]'),a=0;a<b.length;a++)if(b[a].value.length)return!0;return!1};m.getActiveArea=function(){var b,a;for(b=0;b<m.childCanvasList.length;b++)!0===
m.childCanvasList[b].isActive&&(a=m.childCanvasList[b]);return a};m.hasRequiredField=function(){return l.reduce(m.childCanvasList,function(b,a){return b||a.hasRequiredField()},!1)};m.requiredFieldsAreValid=function(){return l.reduce(m.childCanvasList,function(b,a){return b&&a.requiredFieldsAreValid()},!0)};m.emphasizeMissingFields=function(){l.each(m.childCanvasList,function(b){b.requiredFieldsAreValid()||b.emphasizeMissingField()});var b=m.getThumbnailImage().parent();b.hasClass("active")||b.addClass("error")};
m.containsEmoji=function(){return l.reduce(m.childCanvasList,function(b,a){return b||a.containsEmoji()},!1)};m.enableBuyBox=function(){for(var b=!1,a=0;a<m.childCanvasList.length;a++)if(!0===m.childCanvasList[a].enableBuyBox){b=!0;break}return b};m.getThumbnailImage=function(){return h(".thumbnail-container").find('.thumbnail-image[ac-target="'+m.id+'"]')};m.setPrimaryCanvas=function(){var b;b=u(new g.Canvas("ac-preview-canvas-"+m.id));b.isChild=!1;return b};m.updatePrimaryCanvas=function(b){var a,
f,c,k,d=!1;a=function(){var a={};a.height=m.primaryCanvas.childCanvas[b].canvas.height;a.width=m.primaryCanvas.childCanvas[b].canvas.width;a.top=h("canvas#"+m.id+"-area-"+b).data("top");a.left=h("canvas#"+m.id+"-area-"+b).data("left");a.angle=h("canvas#"+m.id+"-area-"+b).data("angle");return a};if(m.primaryCanvas.childCanvas[b]){var e=m.primaryCanvas.childCanvas[b].canvas,n=e.getObjects(),r=e.getActiveObject();k=m.primaryCanvas.getObjects();for(var t=m.primaryCanvas.canvas.size()-1;0<=t;t--)k[t].areaId!==
v&&k[t].areaId===b&&m.primaryCanvas.canvas.remove(k[t]);if(n.length)if(1!==n.length||"text"!==n[0].type||""!==n[0].text&&" "!==n[0].text){d=!0;c=a();var u=function(b){var a={},f=!1,a={left:-b.width/2,top:-b.height/2,width:b.width,height:b.height};0>b.left?(f=!0,a.left=-b.width/2-b.left,b.width+b.left>c.width&&(a.width=c.width)):b.width+b.left>c.width&&(f=!0,a.left=-b.width/2-(b.width+b.left-c.width));0>b.top?(f=!0,a.top=-b.height/2-b.top,b.height+b.top>c.height&&(a.height=c.height)):b.height+b.top>
c.height&&(f=!0,a.top=-b.height/2-(b.height+b.top-c.height));a.clipNeeded=f;return a};e.deactivateAll();(function(){m.primaryCanvas.canvas.forEachObject(function(a){a.areaId===b&&a.remove()});G?e.forEachObject(function(a){var h=g.util.object.clone(a);if(!G&&"group"===h.type)for(var k=h.getObjects(),d=0;d<k.length;d++)k[d].text&&(a=g.util.object.clone(k[d]),a.top+=h.top,a.top+=h.top,h=a);m.primaryCanvas.canvas.calcOffset();m.primaryCanvas.canvas.add(h);if("image"===h.type){h.sendToBack();try{var e=
{},n,q,r,t;n=h.getBoundingRect();e=u(n);q=new g.Rect({left:c.left,top:c.top,height:c.height,width:c.width,selectable:!1,fill:"none",strokeWidth:0,opacity:0});m.primaryCanvas.canvas.add(q);r=function(b){return Math.PI/180*b};t=function(b,a){a.setCoords();b.save();b.translate(-(a.width/2)+q.strokeWidth,-(a.height/2)+q.strokeWidth);b.rotate(r(-1*a.angle));b.scale(1,1);b.beginPath();b.rect(q.left-a.oCoords.tl.x,q.top-a.oCoords.tl.y,q.width,q.height);b.closePath();b.restore()};h.clipTo=function(b){return t(b,
h)}}catch(F){}}"text"===h.type?""===h.text.replace(/\s/g,"")?m.primaryCanvas.canvas.remove(h):(e={},n=h.getBoundingRect(),e=u(n),e.clipNeeded?(f=h.toDataURL(),g.Image.fromURL(f,function(a){a.set({top:n.top+c.top,left:n.left+c.left,selectable:!1,areaId:b});m.primaryCanvas.canvas.remove(h);h=a;m.primaryCanvas.canvas.add(a);a.clipTo=function(b){b.rect(e.left,e.top,e.width,e.height)};m.primaryCanvas.canvas.renderAll();m.updateThumbnail()})):(h.left+=c.left,h.top+=c.top,h.areaId=b)):(h.left+=c.left,h.top+=
c.top,h.areaId=b);h.setCoords()}):(f=e.toDataURL("png"),g.Image.fromURL(f,function(a){a.set({height:c.height,width:c.width,top:c.top,left:c.left,selectable:!1});a.areaId=b;m.primaryCanvas.canvas.add(a);m.primaryCanvas.canvas.renderAll();m.updateThumbnail()}));m.primaryCanvas.canvas.renderAll()})()}else e.deactivateAll();m.updateThumbnail();r&&e.setActiveObject(r);m.primaryCanvas.childCanvas[b].enableBuyBox=!!d;q.buybox.verify()}};m.updateThumbnail=function(){if(!m.widget.showThumbnail)return null;
try{if("TextPrinting"!==m.customizationType||G){var a,f,c,k,d;a=b.defaults.thumbnailHeight/b.defaults.galHeight;d=m.getThumbnailImage();d.find(".ieThumbnail-bg").length||(f=h("<img />",{"class":"ieThumbnail-bg",src:m.data.preview.url,alt:"Thumbnail Image",height:b.defaults.thumbnailHeight+"px",width:b.defaults.thumbnailWidth="px"}));d.html(f);c=function(b,f){var c,k,d,e,n,q;k=b.position.y*a;d=b.position.x*a;e=b.dimension.height*a;n=b.dimension.width*a;q=b.angle?r.specifications.angle:0;c=document.createElement("canvas");
c.id="thumbnail-"+m.id+"-area-"+f;c.className+="thumbnail-canvasArea";c.height=e;c.width=n;m.getThumbnailImage().append(c);c.getContext("2d");e=new g.Canvas(c.id);q="rotate("+q+"deg)";h(c).parent(".canvas-container").css({position:"absolute",top:k+"px",left:d+"px","-ms-transform":q,"-webkit-transform":q,transform:q});return e};for(f=0;f<m.childCanvasList.length;f++)h("#thumbnail-"+m.id+"-area-"+f).length?(k=m.miniThumbnailCanvas[f],k.clear()):(k=c(m.childCanvasList[f].data.specifications,f),m.miniThumbnailCanvas[f]=
k),"ImagePrinting"===m.customizationType?m.childCanvasList[f].canvas.forEachObject(function(b){var f=g.util.object.clone(b);k.calcOffset();k.add(f);f.top=b.top*a;f.left=b.left*a;f.scaleX*=a;f.scaleY*=a;f.selectable=!1;k.deactivateAll();"text"!==f.type&&f.sendToBack();f.setCoords();k.renderAll()}):"TextPrinting"===m.customizationType&&function(b,f){g.Image.fromURL(b,function(b){f.add(b);b.scaleX=a;b.scaleY=a;b.selectable=!1;f.renderAll()})}(m.childCanvasList[f].canvas.toDataURL("png"),k);if(m.data.mask&&
m.data.mask.url&&!d.find(".ieThumbnail-mask").length){var e=h("<img />",{"class":"ieThumbnail-mask",src:m.data.mask.url,alt:"Thumbnail Mask Image"});h(e).load(function(){var b,f;b=this.naturalHeight;f=this.naturalWidth;h(this).height(b*a).width(f*a)});d.find(".canvas-container").after(e)}}else{var n=m.primaryCanvas.canvas.toDataURL("png");m.getThumbnailImage().html("<img src='"+n+"' class='thumbnail-image "+m.id+"' />")}}catch(q){return console.log(q),null}};m.activateSurface=function(){q.setActiveSurface(m.id);
"ImagePrinting"===m.customizationType&&(m.getActiveArea().resetControls(),m.getActiveArea().controlRenderingHandle());"TextPrinting"===m.customizationType&&h("#ac-simple-text-font-picker",h("div[data-surface='"+m.id+"']")).val(m.font)};m.bindEvents=function(){h(".thumbnail-container .ac-thumbnail.surface-0").addClass("active");h(".thumbnail-container").delegate('[ac-target="'+m.id+'"]',"click",function(){if("block"===h('.ac-preview-container[data-surface="'+m.id+'"]').css("display").toLowerCase())return null;
h(".ac-thumbnail").removeClass("active");h(".ac-thumbnail."+m.id).addClass("active");f.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_LAUNCH_75411")&&h(".ac-thumbnail."+m.id).removeClass("error");h(".ac-preview-container").css("display","none").parent().find('[data-surface="'+m.id+'"]').css("display","block");"ImagePrinting"===m.customizationType?(h(".ac-controls-container").css("display","none").parent().find(".ac-controls-container.ac-image-text-control").css("display","block"),m.data.areas[0].customizationTypeSettings.ImagePrinting.galleries&&
J(),h(".ac-single-text-preview-guideline").css({display:"none"})):(h(".ac-controls-container").css("display","none").parent().find('[data-surface="'+m.id+'"]').css("display","block"),h(".pc-two-column-layout .ac-delete-button").fadeOut(),h(".ac-single-text-preview-guideline").css({display:"block"}));m.activateSurface()});return J};m.notifySubscribers=function(b,a){switch(b){case "colorpicker":m.color=a;for(var f=0;f<m.childCanvasList.length;f++)m.childCanvasList[f].controls.simpleTextInput&&(m.childCanvasList[f].controls.simpleTextInput.changePreview(),
l.trigger("amazon-custom-log-ref-tag","FontColorChange"));break;case "fontpicker":for(m.font=a,f=0;f<m.childCanvasList.length;f++)m.childCanvasList[f].controls.simpleTextInput&&(m.childCanvasList[f].controls.simpleTextInput.changePreview(),l.trigger("amazon-custom-log-ref-tag","FontChange"))}};m.bindControls=function(){var b=h(".ac-surface-control."+m.id),a;l.each(b,function(b){a=h(b).attr("data-control-template");switch(a){case "colorpicker":b=new d(b,m);m.controls.colorPicker=b;break;case "fontpicker":b=
new c(b,m),m.controls.fontPicker=b}})};m.initiateEvents=function(){};m.fulfillmentJSON=function(){var b={},a=[];b.name=m.name;if(h("#amazonCustomUseCaseId").length&&"AC_ImgTxtPersonalization_3"===h("#amazonCustomUseCaseId").val()){b.images={};n.preview&&n.preview.url&&(b.images.previewUrl=n.preview.url);n.mask&&n.mask.url&&(b.images.maskUrl=n.mask.url);if("TextPrinting"===m.customizationType){b.font={};if("ac_"===m.font.substring(0,3)){b.font.isDefault=0;var f=m.data.FontSettings.fonts.filter(function(b){if(b.name===
m.fontName)return!0});1===f.length&&(b.font.fontUrl=f[0].fontURL)}else b.font.isDefault=1;b.font.fontName=m.fontName}b.id=m.id}for(f=0;f<m.childCanvasList.length;f++)a.push(m.childCanvasList[f].fulfillmentJSON());b.areas=a;return b};m.init=function(){m.name=n.name;m.isActive=n.isActive;m.id="surface-"+n.index;m.productImageUrl=n.preview.productImageUrl;m.maskImageUrl=n.preview.maskImageUrl;m.primaryCanvas=m.setPrimaryCanvas();m.childCanvasList=z(m.primaryCanvas);m.bindEvents();m.bindControls();m.initiateEvents()};
m.init();return m}})})();(function(){C.when("A","ac-base","ready").register("ac-utils",function(l,p){var g=l.$,e,a,d,c;e={};a=function(b){var a=null;try{a=l.state(b)?l.state(b):null}catch(f){a=null}finally{return a}};c=function(){for(var b=g(".pc-customization-enabled script"),a=0,f=b.length;a<f;a++)if(!g.data(b[a],"a-eval")){var h=g(b[a]),c=h.attr("data-a-state");c&&(c=l.parseJSON(c),c.key&&(h=l.parseJSON(h.html()),l.state.replace(c.key,h)))}return!0};e.init=function(){c();d=a("wssStringArray")};
e.getState=function(b,k){if(k){var f=!1,f=c();if(!f)return}d||(d=a("wssStringArray"));return a(b)};e.validator=function(){var b={AlphaNumeric:function(b){return!0},Digits:function(b){return/^[\s\d]*$/.test(b)}};return{Validate:function(a,f){return b[f]!==v&&"function"===typeof b[f]?b[f](a):!0}}};e.debounce=function(b,a,f){var h;return function(){var c=this,d=arguments,e=f&&!h;clearTimeout(h);h=setTimeout(function(){h=null;f||b.apply(c,d)},a);e&&b.apply(c,d)}};e.showDialog={show:function(b,a,f){f&&
f.ok?g(".ac-btn.ac-btn-dialog-ok").text(f.ok):null;f&&f.cancel?g(".ac-btn.ac-btn-dialog-cancel").text(f.cancel):null;b?g("#ac-dialog-confirm p").html(b):null;g("#ac-dialog-confirm").fadeIn();g(".ac-image-backdrop").fadeIn();g("#ac-dialog-confirm").undelegate(".ac-btn-dialog-ok","click");g("#ac-dialog-confirm").delegate(".ac-btn-dialog-ok","click",function(){g("#ac-dialog-confirm").fadeOut();g(".ac-image-backdrop").fadeOut();a()});g("#ac-dialog-confirm").undelegate(".ac-btn-dialog-cancel","click");
g("#ac-dialog-confirm").delegate(".ac-btn-dialog-cancel","click",function(){g("#ac-dialog-confirm").fadeOut();g(".ac-image-backdrop").fadeOut();f&&f.cancelCallBack?f.cancelCallBack():null;e.imageLoading.hide()})}};e.imageLoading={show:function(){g(".ac-image-loader").fadeIn();g(".ac-image-backdrop").fadeIn()},hide:function(){g(".ac-image-loader").fadeOut();g(".ac-image-backdrop").fadeOut()}};e.arrFilterUnique=function(b){return b.filter(function(b,a,h){return h.indexOf(b)===a})};e.stringHandler=function(b){return d&&
d[b]?d[b]:""};e.getScaleRatio=function(){var b=1;if(p.isApp()){var a=g(".ac-surface-background-image"),b=a.width();a.height();a=a.get()[0].naturalWidth;b/=a}return b};return e})})();(function(){C.when("A","fabric-js","ac-base","BuyBox","ac-constants","ac-surface","ac-utils","ac-gallery","ac-image-gallery","acc-weblab","ready").register("ac-widget",function(l,p,g,e,a,d,c,b,k,f){var h=l.$;return function(){var k=this,q,r;k.surfaceList=[];k.data={};k.showThumbnail=!0;k.acTempCanvas=new p.Canvas("acTempCanvas");
r=function(){h(".pc-two-column-layout").delegate(".ac-delete-button","click",function(){var b=k.getActiveArea();b.canvas.forEachObject(function(a){var f;if(a&&a.active||a&&a.name&&"galImage"===a.name)a.type&&"text"===a.type&&(f=b.controls.textInput.cleared),a.name&&"cusImage"===a.name&&(f=b.controls.imageUpload.cleared),f&&f(),b.canvas.remove(a)});b.canvas.discardActiveGroup();h(".pc-two-column-layout .ac-delete-button").fadeOut();b.renderAll()})};k.getActiveSurface=function(){for(var b=null,a=0;a<
k.surfaceList.length;a++)!0===k.surfaceList[a].isActive&&(b=k.surfaceList[a]);return b};k.setActiveSurface=function(b){for(var a=0;a<k.surfaceList.length;a++)k.surfaceList[a].isActive=!1,k.surfaceList[a].id===b&&(k.surfaceList[a].isActive=!0)};k.getActiveArea=function(){return k.getActiveSurface().getActiveArea()};k.fulfillmentJSON=function(){var b={},f=[],c=[],d,e;e=k.acTempCanvas;e.setDimensions(a.outputSVGDimention);d=function(b){var f=a.scaleRatio,c,k,d,n;d=parseInt(h(b.lowerCanvasEl).parent(b.wrapperEl).css("top").replace("px",
""),10);n=parseInt(h(b.lowerCanvasEl).parent(b.wrapperEl).css("left").replace("px",""),10);e.clear();b.forEachObject(function(b){b=p.util.object.clone(b);"rect"!==b.type&&(e.calcOffset(),e.add(b),"image"===b.type&&(b.sendToBack(),c=b.getSrc()),"text"===b.type&&""===b.text.replace(/\s/g,"")&&e.remove(b),b.top+=d,b.left+=n,b.scaleX*=f,b.scaleY*=f,b.left*=f,b.top*=f,b.setCoords())});e.renderAll();c&&-1!==c.indexOf("._")&&-1!==c.indexOf("._")?(k=c.split("._")[0]+"."+c.split("_.")[1],b=e.toSVG(null,function(b){return b.replace(new RegExp(/xlink:href=\"\S*\"/),
'xlink:href="'+k+'"').replace(/(<tspan\s(.*?)>)(.*?)(<\/tspan>)/g,"$1<![CDATA[$3]]\x3e$4")})):b=e.toSVG(null,function(b){return b.replace(/(<tspan\s(.*?)>)(.*?)(<\/tspan>)/g,"$1<![CDATA[$3]]\x3e$4")});return b};b.customizationInfo={fulfillmentDetails:k.data.fulfillmentDetails,"version3.0":{surfaces:[]}};b.merchantId=g.getMerchantID();for(var q=0;q<k.surfaceList.length;q++)f.push(k.surfaceList[q].fulfillmentJSON());for(q=0;q<f.length;q++)for(var r=0;r<f[q].areas.length;r++)"SVG"===f[q].areas[r].fulfillmentType?
(f[q].areas[r].svgImage=d(f[q].areas[r].canvas),delete f[q].areas[r].canvas):f[q].areas[r].fulfillmentType||f[q].areas.splice(r,1);for(q=0;q<f.length;q++)f[q].areas.length&&c.push(f[q]);b.customizationInfo["version3.0"].surfaces=c;return b};k.bindControls={galleryImage:function(){l.on("addGalleryImage",function(b){var a,f,h,d=!1;a=k.getActiveSurface();l.trigger("amazon-custom-log-ref-tag","logVendorGalleryTabClick");f=a.getActiveArea();if(1===f.getObjects().length&&"galImage"===f.getObjects()[0].name&&
f.getObjects()[0].getSrc()===b.imageUrl)return null;a=c.stringHandler("pc-clear-custom-msg");h=function(){k.surfaceList.forEach(function(a){a.childCanvasList.forEach(function(a){for(var f=a.getObjects(),h=!1,c=0;c<f.length;c++)f[c].name&&"galImage"===f[c].name&&f[c].getSrc()===b.imageUrl&&(h=!0);h?null:a.clear()})});f.addGalleryImage(b)};for(var e=0;e<k.surfaceList.length;e++){for(var g=0;g<k.surfaceList[e].childCanvasList.length;g++){var q,r=k.surfaceList[e].childCanvasList[g];q=r.getObjects();for(var y=
r.canvas.size()-1;0<=y;y--)if("text"===q[y].type&&!q[y].text.replace(" ","").length)q[y].remove(),r.controls.textInput.isControlActive=!1;else if(q[y].name&&"cusImage"===q[y].name||"text"===q[y].type){d=!0;break}if(d)break}if(d)break}d?c.showDialog.show(a,h,{ok:"Clear"}):h()})},uploadImage:function(){l.off("addCustomerImage");l.on("addCustomerImage",function(b){var a,f,h,d=!1;a=k.getActiveSurface().getActiveArea();a.getObjects();f=c.stringHandler("pc-clear-design-msg");h=function(){k.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var a=
b.getObjects(),f=0;f<a.length;f++)a[f].name&&"galImage"===a[f].name&&b.clear()})});a.addCustomerImage(b)};k.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){b=b.getObjects();for(var a=0;a<b.length;a++)if(b[a].name&&"galImage"===b[a].name){d=!0;break}})});d?c.showDialog.show(f,h,{ok:"Clear"}):h()});h(".ac-image-text-container").delegate(".ac-btn-makeOwn.ac-imageUpload","click",function(){h(".ac-imageUpload-control").addClass("active");h(".ac-btn-makeOwn.ac-imageUpload").addClass("active");
h(".ac-textInput-control").removeClass("active");h(".ac-btn-makeOwn.ac-textInput").removeClass("active");k.getActiveSurface().getActiveArea().setActiveControl("imageUpload");l.trigger("amazon-custom-log-ref-tag","logCustomImageTabClick")})},textOnImage:function(){(function(){h("#pcTextArea").unbind().bind("keyup",function(b){b=h(this).val().replace('"',"''");h(this).val(b);if(50<b.length)return b=b.substring(0,50),h(this).val(b),null;k.getActiveArea().controls.textInput.imgText.updateText(b);h(this).val()});
h(".pc-textArea-fontStyle-li").unbind().bind("click",function(){h(this).toggleClass("button-active");var b=h(this).attr("data-style"),b=h(this).hasClass("button-active")?b+"on":b+"off";k.getActiveArea().controls.textInput.imgText.toggleStyle(b)});h(".pc-textArea-fontAlign-li").unbind().bind("click",function(){h(".pc-textArea-fontAlign-li").removeClass("button-active");h(this).addClass("button-active");var b=h(this).attr("data-align");k.getActiveArea().controls.textInput.imgText.changeAlign(b)});l.off("a:dropdown:fontPicker:select");
l.on("a:dropdown:fontPicker:select",function(b){k.getActiveArea().controls.textInput.imgText.changeFont(b.value)});h(".pc-textArea-fontColor-li").unbind().bind("click",function(){k.getActiveArea().controls.textInput.imgText.changeTextColor(h(this).find("div").attr("data-color"))});l.off("a:popover:show:text-color");l.on("a:popover:show:text-color",function(b){b.popover.$popover.css("z-index",999999)});l.off("slideUpTextArea");l.on("slideUpTextArea",function(){var b=h(".pc-textArea-overlay");b.parents().is(":hidden")?
b.hide():b.slideUp(100,function(){h("#pcTextArea").focus()})});l.off("slideDownTextArea");l.on("slideDownTextArea",function(){h(".pc-textArea-overlay").slideDown()})})();h(".ac-image-text-container").delegate(".ac-btn-makeOwn.ac-textInput","click",function(){var b;h(".ac-imageUpload-control").removeClass("active");h(".ac-btn-makeOwn.ac-imageUpload").removeClass("active");h(".ac-textInput-control").addClass("active");h(".ac-btn-makeOwn.ac-textInput").addClass("active");b=k.getActiveArea();b.controls.textInput.imgText.updateControl();
b.controls.textInput.imgText.select();b.setActiveControl("textInput");l.trigger("slideUpTextArea");l.trigger("amazon-custom-log-ref-tag","logAddTextTabClick")})}};k.initiateBuyBox=function(){(new e({controller:{getJSON:k.fulfillmentJSON}})).Init()};k.buybox={enable:function(){l.trigger("enableBuybox")},disable:function(){l.trigger("disableBuybox")},block:function(b){l.trigger("blockBuybox",b)},unblock:function(){l.trigger("unblockBuybox")},showMissingCustomization:function(b){l.trigger("showMissingCustomization",
b)},hideMissingCustomization:function(){l.trigger("hideMissingCustomization")},showMissingRequiredFields:function(b){l.trigger("showMissingRequiredFields",b)},hideMissingRequiredFields:function(){l.trigger("hideMissingRequiredFields")},showContainingEmoji:function(b){l.trigger("showContainingEmoji",b)},hideContainingEmoji:function(){l.trigger("hideContainingEmoji")}};f.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_LAUNCH_75411")?k.buybox.verify=function(){var b=!1,a,f,h=[];k.buybox.unblock();k.buybox.hideMissingRequiredFields();
k.buybox.hideMissingCustomization();k.buybox.hideContainingEmoji();if(l.reduce(k.surfaceList,function(b,a){return b||a.hasRequiredField()},!1)){b=!0;for(a=0;a<k.surfaceList.length;a++){f=k.surfaceList[a];var c=f.requiredFieldsAreValid();c||h.push(f);b=b&&c}b=!b;a=function(){l.each(h,function(b){b.emphasizeMissingFields()});k.buybox.showMissingRequiredFields({error:!0})}}else b=!l.reduce(k.surfaceList,function(b,a){return b||a.enableBuyBox()},!1),a=function(){k.buybox.showMissingCustomization({error:!0})};
(f=l.reduce(k.surfaceList,function(b,a){return b||a.containsEmoji()},!1))&&(a=function(){k.buybox.showContainingEmoji({error:!0})});(b||f)&&k.buybox.block({callback:a});k.buybox.enable()}:k.buybox.verify=function(){for(var b=!1,a=0;a<k.surfaceList.length;a++)if(k.surfaceList[a].enableBuyBox()){b=!0;break}b?k.buybox.enable():k.buybox.disable()};k.init=function(){var a,f,e=!1,g=[],F;c.init();f=c.getState("ctsStateData",!0);k.data=f;for(var z=0;z<f.surfaces.length;z++){a=f.surfaces[z];a.index=z;0===
z?a.isActive=!0:a.isActive=!1;a=new d(a,k);0===z&&(a.isActive=!0,"ImagePrinting"===a.customizationType?(h(".ac-single-text-preview-guideline").css({display:"none"}),h(".ac-image-text-preview-guideline").css({display:"block"})):h(".ac-single-text-preview-guideline").css({display:"block"}));if("ImagePrinting"===a.customizationType){var e=!0,J=a.data.areas[0].customizationTypeSettings.ImagePrinting.galleries;J&&J.length&&(g=g.concat(J),!F&&a.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery&&
(F=a.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery))}k.surfaceList.push(a)}1===f.surfaces.length&&"TextPrinting"===f.surfaces[0].areas[0].customizationType&&(h(".thumbnail-container").fadeOut("fast"),h(".ac-image-text-preview-guideline").fadeOut("fast"),h(".pc-two-column-layout .pc-input-controls").addClass("ac-single-text-only"),h(".pc-two-column-layout .ac-controls-container").addClass("ac-single-text-only"),h(".pc-two-column-layout").addClass("ac-single-text-only"),h(".pc-atc-wrapper").addClass("a-button-span12"),
h(".ac-price").addClass("ac-single-text-only"),h(".ac-quantity").addClass("ac-single-text-only"),k.showThumbnail=!1);g=c.arrFilterUnique(g);r();k.initiateBuyBox();!0===e&&(g.length&&(q=new b(null,g,F),q.Fetch()),k.bindControls.galleryImage(),k.bindControls.uploadImage(),k.bindControls.textOnImage())}}})})();C.when("A","ready").execute(function(l){function p(){g("html").hasClass("a-canvas")||(g(".pc-customization-disabled").addClass("active"),g(".pc-customization-enabled").remove())}var g=l.$;l.on("pc-single-text-loaded",
function(){p()});p()});C.when("A","a-modal","ac-utils","ac-widget","ac-base","acc-weblab","ready").execute(function(l,p,g,e,a,d){var c=l.$,b=[],k=function(){if(1<=c(".ac-mobile-app").length){var b=c(".ac-surface-background-image"),a=b.width(),b=b.height();g.getScaleRatio();c(".canvas-container > .ac-parent-canvas").attr({width:a,height:b}).css({width:a+"px",height:b+"px"});c(".canvas-container .canvasArea").each(function(b,a){var f=c(a).attr("data-initial-top"),h=c(a).attr("data-initial-left"),k=
c(a).attr("data-initial-width"),d=c(a).attr("data-initial-height"),e=g.getScaleRatio();f!==v&&h!==v&&(c(a).attr({"data-top":parseInt(f,10)*e,"data-left":parseInt(h,10)*e}),c(a).parent().css({top:parseInt(f,10)*e,left:parseInt(h,10)*e,width:k+"px",height:d+"px"}))});c(".ac-preview-container").css({"min-height":b+10});l.trigger("resize-preview-text")}};if(d.isT1("AMAZON_CUSTOM_BBQ_UPDATES_70086"))var f=function(){var b=c(".ac-surface-background-image"),a=b.width(),b=b.height();g.getScaleRatio();a?(c(".canvas-container > .ac-parent-canvas").attr({width:a,
height:b}).css({width:a+"px",height:b+"px"}),c(".canvas-container .canvasArea").each(function(b,a){var f=c(a).attr("data-initial-top"),h=c(a).attr("data-initial-left"),k=c(a).attr("data-initial-width"),d=c(a).attr("data-initial-height"),e=g.getScaleRatio();f!==v&&h!==v&&(c(a).attr({"data-top":parseInt(f,10)*e,"data-left":parseInt(h,10)*e}),c(a).parent().css({top:parseInt(f,10)*e,left:parseInt(h,10)*e,width:k+"px",height:d+"px"}))}),c(".ac-preview-container").css({"min-height":b+10}),l.trigger("resize-preview-text")):
A.console&&console.log("Will not resize acWidget because .ac-surface-background-image has no size.")},k=l.debounce(function(){if(c(".ac-mobile-app").length){var b=c(".ac-surface-background-image");b.length?b[0].complete?f():b.first().load(k):A.console&&console.log(".ac-surface-background-image not found on page.")}},25);l.on("a:popover:afterShow:pc-buybox-secondary-view",function(b){k();"false"===c("#pc-customize-now-div").attr("data-customization-clicked")&&((new e).init(),c("#pc-customize-now-div").attr("data-customization-clicked",
"true"));l.on("resize-preview",function(){k()})});l.on("a:popover:afterHide:pc-popover-content",function(b){l.trigger("amazon-custom-log-ref-tag","CloseClick");l.trigger("amazon-custom-popup-close",new Date)});d.isT1("AMAZON_CUSTOM_BBQ_UPDATES_70086")&&(l.on("a:popover:beforeShow:pc-popover-content",function(){c(".pc-popover-footer-wrapper").hide()}),l.on("a:popover:afterShow:pc-popover-content",function(){c(".pc-popover-footer-wrapper").show()}));c("html").hasClass("a-canvas")&&(c(".pc-customization-disabled").remove(),
l.declarative("popover-trigger","click",function(a){a=c(".pc-popover-button");var f=p.get(a);l.trigger("amazon-custom-log-ref-tag","CustomizeNowClick");if(null===f){if(0<b.length){for(f=0;f<b.length;f++)p.remove(b[f]);b.length=0}f=p.create(a,{name:"pc-popover-content",header:c(".pc-popover-header").html(),activate:"onclick"});c(".pc-popover-header").remove();f.lock().show();b.push(f);a=c("#ASIN",c(".pc-buy-box",c(".pc-two-column-layout"))).val();c(".pc-two-column-layout").attr("asin",a);(new e).init()}}))});
(function(){C.when("A","fabric-js","ac-utils","ac-base","ac-constants","acc-weblab","ready").register("ac-simple-textInput",function(l,p,g,e,a,d){var c=l.$;return function(b,k,f){var h={},n,q,r;e.isApp()?(h.inputBox=c(b).find(".pc-simple-text-input input"),h.errorClassTarget=c(b).find("div.pc-simple-text-input")):(h.inputBox=c(b).find("input.pc-simple-text-input"),h.errorClassTarget=h.inputBox);h.isRequiredLabel=c(b).find(".isRequiredLabel");h.maxLength=parseInt(h.inputBox.attr("maxLength"),10);h.textLimitElement=
c(b).find(".pc-char-limit-length");h.charType=c(h.inputBox).data("input-type");h.acCanvas=k;h.options=f;h.isEmpty=function(){var b=!1;""===h.inputBox.val().replace(/\s/g,"")&&(b=!0);return b};h.isValid=function(){return g.validator().Validate(h.inputBox.val(),h.charType)&&!h.isEmpty()};h.detectEmoji=function(){return a.emojiMatchPattern.test(h.inputBox.val())};h.cleared=function(){h.inputBox.val("")};h.hasRequiredField=function(){return k.data&&k.data.customizationTypeSettings&&k.data.customizationTypeSettings.TextPrinting&&
!!k.data.customizationTypeSettings.TextPrinting.isRequired};h.requiredFieldsAreValid=function(){return h.hasRequiredField()?h.isValid():!0};h.hideIsRequiredLabel=function(){c(h.isRequiredLabel).hide()};h.emphasizeMissingField=function(){h.addErrorClass();c(h.isRequiredLabel).addClass("a-color-error")};h.containsEmoji=function(){return h.isValid()&&h.detectEmoji()};h.addErrorClass=function(){d.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_LAUNCH_75411")?h.errorClassTarget.addClass("a-form-error"):h.inputBox.addClass("a-form-error")};
h.removeErrorClass=function(){d.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_LAUNCH_75411")?h.errorClassTarget.removeClass("a-form-error"):h.inputBox.removeClass("a-form-error")};h.changePreview=function(b){b?b:b=h.inputBox.val();if(h.acCanvas.canvasObjects[h.acCanvas.id]!==v){var a=h.acCanvas.canvasObjects[h.acCanvas.id];a.forEachObject(function(b){h.acCanvas.canvasObjects[h.acCanvas.id].removeWithUpdate(b)});h.acCanvas.canvas.remove(a)}if(b&&b.replace(/\s+/g,"").length){a={fontFamily:h.acCanvas.surface.font,
fontSize:h.acCanvas.canvas.height,fill:h.acCanvas.surface.color,selectable:!1,textAlign:"center",originX:"center",originY:"center",lockMovementX:!0,lockMovementY:!0,lineHeight:1.3/1.13};e.isApp()&&(a.fontSize=Math.round(h.acCanvas.canvas.height));b=new p.Text(b,a);a={originX:"center",originY:"center",fill:"",opacity:0,width:h.acCanvas.canvas.width,height:h.acCanvas.canvas.height,selectable:!1,lockMovementX:!0,lockMovementY:!0,clipTo:function(b){b.rect(-(h.acCanvas.canvas.width/2),-(h.acCanvas.canvas.height/
2),h.acCanvas.canvas.width,h.acCanvas.canvas.height+5)}};e.isApp()&&(a.width=Math.round(h.acCanvas.canvas.width),a.height=Math.round(h.acCanvas.canvas.height));var a=new p.Rect(a),f={left:0,top:0,width:h.acCanvas.canvas.width,height:h.acCanvas.canvas.height,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,selectable:!1,name:"simple-text"};e.isApp()&&(f.width=Math.round(h.acCanvas.canvas.width),f.height=Math.round(h.acCanvas.canvas.height));f=new p.Group([a,b],f);h.acCanvas.canvasObjects[h.acCanvas.id]=
f;h.acCanvas.canvas.add(f);q(b,a)}else h.acCanvas.renderAll();e.isApp()&&h.acCanvas.surface.updateTickerOnTab()};q=function(b,a){var f,k;c(".parentReferenceDiv").length?f=c(".parentReferenceDiv"):(f=c(document.createElement("div")),c(".ac-image-backdrop").after(c(f)));k=c(".referenceDiv").length?c(".referenceDiv"):c(document.createElement("div"));c(f).addClass("parentReferenceDiv");c(k).addClass("referenceDiv");c(k).css({"font-family":h.acCanvas.surface.font,"font-size":b.getFontSize()});c(k).text(b.text);
for(c(f).html(c(k));b.getWidth()>h.acCanvas.canvas.width-.1*h.acCanvas.canvas.width||c(k).height()>h.acCanvas.canvas.height-.1*h.acCanvas.canvas.height;)if(f=b.getFontSize(),2<f)--f,b.setFontSize(f-1),c(k).css({"font-size":f+"px"}),b.set({top:1.3/1.13*-f*(1-1/1.13)*.5}),b.setCoords();else break;h.acCanvas.renderAll()};r=function(){var b=h.inputBox.val(),a=parseInt(b.length,10),f=parseInt(h.maxLength,10),k=f;0<h.textLimitElement.length&&(k=f-a,0>k?(h.textLimitElement.html(0),h.inputBox.val(b.substring(0,
f))):h.textLimitElement.html(k));h.isValid()?(h.removeErrorClass(),d.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_LAUNCH_75411")&&c(h.isRequiredLabel).removeClass("a-color-error"),h.inputBox.siblings(".pc-input-invalid").removeClass("active"),h.changePreview(b)):(h.isEmpty()&&h.changePreview(b),h.isEmpty()?(h.inputBox.siblings(".pc-input-invalid").removeClass("active"),h.removeErrorClass()):(h.inputBox.siblings(".pc-input-invalid").addClass("active"),h.addErrorClass()),h.changePreview(""))};n=function(){h.inputBox.bind("keyup",
function(b){r()});h.inputBox.bind("change",function(b){r()});h.inputBox.bind("cut",function(b){setTimeout(function(){r()},100)});h.inputBox.bind("paste",function(b){setTimeout(function(){r()},100)})};h.init=function(){n()};h.init();return h}})})();(function(){C.when("A","a-popover","ac-utils","ac-base","ready").register("ac-color-picker",function(l,p,g,e){var a=l.$;return function(d,c){var b={};b.elem=d;b.notify=function(b){c.notifySubscribers("colorpicker",b)};b.bindEvents=function(){a(".ac-color-li",
b.elem).bind("click",function(){var c=a(this).find("div").attr("data-color"),f=p.get(a(".ac-color-picker-trigger",b.elem).parent());a(".ac-simplecolorpicker",b.elem).css("background-color",c);b.notify(c);f.hide()})};b.init=function(){a(".ac-is-single-color").length===a(".ac-controls-container").length?(b.notify(a(".ac-is-single-color").attr("data-color")),e.isApp()&&a(".ac-colorpicker").hide()):(b.bindEvents(),b.notify(a(".ac-color-li",b.elem).find("div").attr("data-color")))};b.init();return b}})})();
(function(){C.when("A","a-dropdown","ac-utils","ready").register("ac-font-picker",function(l,p,g){var e=l.$;return function(a,d){var c={};c.elem=a;c.notify=function(b){d.notifySubscribers("fontpicker",b)};c.init=function(){e(".ac-simple-text-font-picker",a);var b;1<=e(".ac-mobile-app").length&&(b="pcFont"+e("#a",e("#addToCart")).val(),b=p.getSelect(b),b.update({option_prompt:b.getOption(0).info()[0].text}),1===b.getOptions().size()&&(b.update({status:"disabled"}),e(".ac-fontpicker").hide()));e("select",
e(".ac-simple-text-font-picker",e("div[data-surface='"+d.id+"']"))).change(function(){var b=e(this).val();d.fontName=e(this).find("option:selected").text();c.notify(b)});e("select option:first-child",e(".ac-simple-text-font-picker")).click().change()};c.init();return c}})})();(function(){C.when("A","ready").register("ac-constants",function(l){return{AssetType:{IMAGE:"image"},StatusCode:{NON_HTML5_BROWSER:"NON-HTML5-BROWSER",NON_IMAGE_TYPE:"NON-IMAGE-TYPE",INVALID_FILE_TYPE:"INVALID_FILE_TYPE",READ_SUCCESS:"READ-SUCCESS",
READ_NOT_REQUIRED:"READ_NOT_REQUIRED",INVALIDFILESIZE:"INVALID-FILE-SIZE"},defaults:{thumbnailWidth:80,thumbnailHeight:80,thresholdImageWidth:50,thresholdImageHeight:50,galWidth:400,galHeight:400,maskWidth:400,maskHeight:400},scaleRatio:8,outputSVGDimention:{height:3200,width:3200},textDefaults:{fontFamily:"Arial, Helvetica, sans-serif",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",fill:"#FF9900",text:"",angle:0,opacity:1,fontSize:20},emojiMatchPattern:/[\u2600-\u27BF]|\uD83C[\uDDE0-\uDFFF]|\uD83D[\uDC00-\uDE4F]|\uD83E[\uDD00-\uDDFF]|\uD83D[\uDE80-\uDEFF]/}})})();
(function(){C.when("A","ac-utils","ac-gallery-base","ac-constants","ac-error-handling","ready").register("ac-image-gallery",function(l,p,g,e,a){var d=l.$,c=function(){};c.prototype=new g;c.prototype.Init=function(){};d.extend(c.prototype,{getMediaServerUrl:function(){var b="",b="._SL80_";return"https://images-na.ssl-images-amazon.com/images/S/"+this.bucket+"/"+this.getResourcePath()+b+this.extension},isValidFile:function(b,a){var f=e.StatusCode;if("undefined"!==typeof FileReader){var h=b.name.toLowerCase();
if(/(jpg|jpeg|png)$/i.test(h)){var c=new FileReader;c.onload=function(h){var d=new Image,e=b.size/1024;7168<e?a({statusCode:f.INVALIDFILESIZE}):(d.onload=function(){a&&"function"===typeof a&&a({statusCode:f.READ_SUCCESS,imageHeight:d.height,imageWidth:d.width,imageSize:e})},d.onerror=function(){a&&"function"===typeof a&&a({statusCode:f.INVALID_FILE_TYPE})},d.src=c.result)};c.readAsDataURL(b)}else a&&"function"===typeof a&&a({statusCode:f.INVALID_FILE_TYPE})}else a&&"function"===typeof a&&a({statusCode:f.NON_HTML5_BROWSER})},
setKey:function(b){this.resourcePath=this.getResourcePath();this.extension=this.getFileExtension();this.key=this.resourcePath+this.extension},isValidFileType:function(b){return/(jpg|jpeg|png)$/i.test(b.name.toLowerCase())?!0:!1},createResourceStub:function(b,a){var f=d(".ac-custom-image-container").clone();f.find("img").attr("id","ac-custom-image-"+a);b.parent().find("#ac-custom-upload-preview-container").append(f)},updateView:function(b,a){a===e.StatusCode.NON_HTML5_BROWSER?this.validateImage(b):
this.updateImage(b)},displayWarningIfRequired:function(b){var c=e.defaults.thresholdImageWidth,f=e.defaults.thresholdImageHeight,h=b.imageHeight,d=b.imageWidth;b=h>d?h:d;h=h>d?d:h;a.hide();h<c||b<f?a.show("pc-resolution-warning"):a.hide()},updateImage:function(b){var c=this.getMediaServerUrl(),f,h;f=d("<div>").addClass("customer-image-container");h=d("<img>").addClass("a-declarative customer-uploaded-image");h.attr({id:"#ac-custom-image-"+b.resourceIndex,src:c,"data-original-url":b.pcImageUrl,"data-original-width":b.imageWidth,
"data-original-height":b.imageHeight,"data-preview-url":b.pcImageUrl,"data-action":"customer-uploaded-image","data-token":b.imageToken});b=d("<div>").addClass("swatch-arrow");f.append(h);f.append(b);h.load(function(){h.trigger("click");d(".ac-uploaded-image").prepend(f);d(".ac-select-uploaded-image").fadeIn()}).error(function(){h.parent(".customer-image-container").remove();a.show("pc-image-mime-type-incorrect");d(".ac-select-uploaded-image").fadeOut();p.imageLoading.hide()})},validateImage:function(b){var c=
{bucketName:this.getBucket(),fileKey:b.imageToken.split("/")[1]},f=this;p.imageLoading.show();l.ajax("/gp/product/features/callValidateImage.html/ref=dp_pc_val_img",{method:"POST",params:c,success:function(h){"1"===h.result.isValid?(b.imageWidth=h.result.width,b.imageHeight=h.result.height,f.updateImage(b)):(p.imageLoading.hide(),h.result.errorString&&h.result.errorString.length?a.show(null,{type:"error",message:h.result.errorString}):a.show("pc-upload-error-message"))},error:function(){a.show("pc-upload-error-message");
p.imageLoading.hide()}})},populateImageObject:function(b,a){var f={};f.imageUrl=b.attr("data-preview-url");f.isCustomerImage=a;f.element=b;return f},imageSelection:function(){var b=this.populateImageObject,a=this.displayWarningIfRequired;l.declarative.remove("customer-uploaded-image","click");l.declarative("customer-uploaded-image","click",function(f){var h=b(f.$currentTarget,!0);d(".selected.customer-image-container").removeClass("selected");f.$currentTarget.parent().addClass("selected");l.trigger("addCustomerImage",
h);a({imageWidth:f.$currentTarget.attr("data-original-width"),imageHeight:f.$currentTarget.attr("data-original-height")});p.imageLoading.show()})}});return c})})();(function(){C.when("A","ac-base").register("ac-gallery",function(l,p){var g=l.$,e;e=function(a,d,c){var b=this;this.options=g.extend({thumbnailWidth:80,thumbnailHeight:80,pageSize:100,categoryContainerSelector:"#ac-gallery",enableLazyLoading:!0,confineToContainerSelector:"body"},a);var k=g(b.options.confineToContainerSelector),f,h={checkIfCategoryAlreadyLoaded:function(b){var a=
!1,f="";0<g('.theme-image-container[data-theme="'+b+'"]').length?(f=g('.theme-image-container[data-theme="'+b+'"]'),a=!0):f=g("<div>").addClass("theme-image-container").attr({"data-theme":b});return{container:f,isEmpty:!a}},checkIfCategoryExistsInObject:function(b){for(var a=f.contentLibraryList.length,h=0,c=!1,h=0;h<a;h+=1)if(f.contentLibraryList[h].title===b||f.contentLibraryList[h].contentLibraryId===b){c=!0;break}return c},formatResponseObject:function(b){b.inlineData!==v&&(b.contentLibraryList=
b.inlineData.contentLibraryList,b.contentLibraryIds=b.inlineData.contentLibraryIds);for(var a=0;a<b.contentLibraryIds.length;a++){var f=b.contentLibraryIds[a];b.contentLibraryIds[a]=h.getFormattedName(f)}for(a=0;a<b.contentLibraryList.length;a++){var c=b.contentLibraryList[a],f=c.title;c.title=h.getFormattedName(f)}b.defaultLibrary=h.getFormattedName(b.defaultLibrary);return b},formatNewResponseObject:function(b){b.contentList.length&&(b.contentLibraryList=[b],b.contentLibraryIds="/"+b.title);for(var a=
0;a<b.contentLibraryIds.length;a++){var f=b.contentLibraryIds[a];b.contentLibraryIds[a]=h.getFormattedName(f)}for(a=0;a<b.contentLibraryList.length;a++){var c=b.contentLibraryList[a],f=c.title;c.title=h.getFormattedName(f)}b.defaultLibrary=h.getFormattedName(b.defaultLibrary);return b},getFormattedName:function(b){if(!b)return null;var a=b;"/"===b.charAt(0)&&(a=b.substr(1,b.length));return a},getGalleryInputData:function(b){var a={};p.getOfferListingID()!==v&&(a.url="/gp/product/features/getContentLibrary.html",
a.data={merchantId:p.getMerchantID(),contentLibraryName:String(b)});return a},getContentLibraryObject:function(b){if(f===v)return v;b=h.getIndexOfCategory(f.contentLibraryList,b);return-1===b?v:f.contentLibraryList[b]},getIndexOfCategory:function(b,a){var f=b.length,h;for(h=0;h<f;h+=1)if(b[h].title.toLowerCase()===a.toLowerCase())return h;return-1},lazyload:function(){var b=g(".ac-gallery-container"),a=g(".pc-lazyload-error-message");return{success:function(){a.removeClass("active");b.show()},error:function(){b.hide();
a.addClass("active");h.loading.hide()}}}(),loading:function(){var b=g(".pc-lazyload-image");return{show:function(){b.addClass("active")},hide:function(){b.removeClass("active")}}}(),populateImageObject:function(b,a){var f={},h=b.data("original-url"),h=h.substr(h.lastIndexOf("."),h.length);f.imageUrl=b.data("preview-url");f.isCustomerImage=a;f.token=g(".pc-category-name.active").attr("data-themename")+"/"+b.attr("data-token")+h;return f}},e=v,q=function(){var a={categorySelection:function(){l.declarative.remove("category-selection",
"click");l.declarative("category-selection","click",function(a){var f=a.$currentTarget.attr("data-themename"),h=a.$currentTarget.attr("data-categoryid");m.BuildGallery(f);g(".ac-selected-gallery-name").html(f).attr({"data-contentId":h,title:f});g("a",g(b.options.categoryContainerSelector)).removeClass("active");a.$currentTarget.addClass("active");g(".vendor-category",g(b.options.categoryContainerSelector)).removeClass("a-active");a.$currentTarget.parent(".vendor-category").addClass("a-active");e!==
v&&e.hide()})},imageContainerScroll:function(){if(b.options.enableLazyLoading){var a=g(".ac-gallery-container");a.scroll(function(b){b.preventDefault();if(a.scrollTop()>=g(".ac-gallery-content").height()-a.height()){b=g("a.active",g(".vendor-categories")).attr("data-themename");var f=h.checkIfCategoryAlreadyLoaded(b);m.AppendImages(b,f,!1)}})}},imageSelection:function(){l.declarative.remove("ac-gallery-content-image","click");l.declarative("ac-gallery-content-image","click",function(b){var a=h.populateImageObject(b.$currentTarget,
!1);a.vendorGalleryFileId=g(b.$target).attr("data-contentid");a.vendorGalleryId=g(".vendor-category .pc-category-name.active").attr("data-categoryid");a.originalURL=g(b.$target).attr("data-original-url");g(".selected.ac-gallery-content-container").removeClass("selected");b.$currentTarget.parent().addClass("selected");l.trigger("hideWarningMessage");l.trigger("addGalleryImage",a);g("a.active",g(".vendor-category")).attr("data-themename")})},popover:function(){l.off("a:popover:show:vendor-categories");
l.on("a:popover:show:vendor-categories",function(b){e=b.popover})}};return{Init:function(){a.categorySelection();a.imageSelection();a.imageContainerScroll();a.popover()}}}(),r=function(){function a(b,f,h){var c=g("<li>"),k=g("<a>");k.attr({"data-themename":b,"data-action":"category-selection","data-categoryId":f?f:b,title:b});c.addClass("a-tab-heading vendor-category");k.addClass(" a-declarative ");k.attr("href","#").addClass("pc-category-name").html(b);c.append(k);h.append(c)}var c={defaultCategory:function(){g(".pc-category-name").each(function(b,
a){if(g(a).attr("data-themename")===f.defaultLibrary||g(a).attr("data-categoyid")===f.defaultLibraryId)return setTimeout(function(){g(a).trigger("click");g("#gallerySpinner").css("display","none")},2E3),!1});g(".ac-selected-gallery-name").text(f.defaultLibrary).attr({"data-categoryid":f.defaultLibraryId,title:f.defaultLibrary})}};return{Build:function(){var d;h.loading.hide();try{for(var e=f.contentLibraryIds.length,n=g("<div>"),m,r=0;r<f.contentLibraryList.length;r++)f.contentLibraryList[r].contentLibraryId=
h.getFormattedName(f.contentLibraryList[r].contentLibraryId),f.contentLibraryList[r].contentLibraryId&&f.contentLibraryList[r].contentLibraryId===f.defaultLibrary&&(f.defaultLibraryId=f.contentLibraryList[r].contentLibraryId,f.defaultLibrary=f.contentLibraryList[r].title),f.contentLibraryList[r].contentLibraryId||(f.contentLibraryList[r].contentLibraryId=f.contentLibraryList[r].title);f.defaultLibraryId||(f.defaultLibraryId=f.defaultLibrary);h.checkIfCategoryExistsInObject(f.defaultLibrary)&&a(f.defaultLibrary,
f.defaultLibraryId,n);for(m=0;m<e;m+=1)d=f.contentLibraryList[m].title,d!==f.defaultLibrary&&h.checkIfCategoryExistsInObject(f.defaultLibrary)&&a(d,f.contentLibraryList[m].contentLibraryId,n);g(b.options.categoryContainerSelector,k).append(n.html());q.Init();c.defaultCategory()}catch(u){h.lazyload.error()}}}}(),m=function(){function a(f,c,k){var d=h.getContentLibraryObject(f);f=d.contentList;var d=d.contentList.length,e=g("<div>"),n;if(b.options.enableLazyLoading||k){b.options.enableLazyLoading?k?
(n=0,k=d<b.options.pageSize?d:b.options.pageSize):(k=c.container.data("endIndex"),n=k+1,k=d<k+b.options.pageSize?d:k+b.options.pageSize):(n=0,k=d);for(;n<k;n+=1){var m=f[n],q=g("<div>").addClass("ac-gallery-content-container"),r=g("<img>"),t=g("<div>").addClass("swatch-arrow");m.status&&"Active"!==m.status||!m.isActive||!m.info||(r.attr({src:m.info.thumbnailURL,"data-original-url":m.info.url,alt:m.description,"data-original-width":m.width?m.width:2500,"data-original-height":m.height?m.height:3500,
"data-preview-url":m.info.previewURL,"data-thumbnail-url":m.info.thumbnailURL,"data-action":"ac-gallery-content-image","data-token":m.title,"data-contentId":m.ContentId?m.ContentId:m.title,isExclusive:1}),r.addClass("ac-gallery-content-image a-declarative"),q.append(r),q.append(t),e.append(q))}f=e.html();c.isEmpty?(g(".ac-gallery-content").append(c.container.append(f)),c.container.data("endIndex",k),c.container.data("length",d)):(c.container.data("endIndex",k),c.container.append(f))}}return{AppendImages:a,
BuildGallery:function(b){var f=h.checkIfCategoryAlreadyLoaded(b);g(".theme-image-container",k).hide();g(".ac-gallery-container").scrollTop(0);f.isEmpty?a(b,f,!0):(g(".ac-gallery-container").scrollTop(0),g('.theme-image-container[data-theme="'+b+'"]',k).show())}}}(),u=function(b,a){var c=h.getGalleryInputData(b),k=g.Deferred();c.data.contentLibraryName="/"+c.data.contentLibraryName.replace("/","");g.ajax({type:"GET",url:c.url,dataType:"json",data:c.data,success:function(b){h.lazyload.success();f=g.parseJSON(b.result);
if(null===f||"Error"===f.Status)h.lazyload.error();else return k.resolve(f,a)},error:function(b){return k.reject(b,a)}});return k.promise()};return{Fetch:function(){var b=[],a={},k=0,e;e=function(){++k;if(k===d.length){for(var e=0;e<b.length;e++)b[e]||(b.splice(e,1),d.splice(e,1));a.inlineData={contentLibraryList:b,contentLibraryIds:d};e=!1;if(c)for(var n=0;n<a.inlineData.contentLibraryList.length;n++)if(a.inlineData.contentLibraryList[n].contentLibraryId===c||a.inlineData.contentLibraryList[n].title===
c){e=!0;break}a.defaultLibrary=e?c:d[0];f=h.formatResponseObject(a);r.Build()}};for(var n=0;n<d.length;n++)g.when(u(d[n],n)).then(function(a,f){b[f]=a.status&&"Active"===a.status&&a.contentList||a.isActive&&a.contentList?a:null;e()},function(a,f){b[f]=null;e()})}}};e.prototype=p;return e})})();(function(){C.when("A","ac-utils","ac-constants","ac-image-gallery","ac-error-handling","ready").register("AssetUploader",function(l,p,g,e,a){var d=l.$,c=function(b){this.assetType=b.assetType;this.$form=b.$form;
this.mediaServer=b.mediaServer;this.index=0};c.prototype.getComponentName=function(){return"AssetUploader"};c.prototype.getUploadTypeObject=function(b){var a;"image"===b&&(a=new e);a.index=this.index++;return a};c.prototype.Init=function(){var b=this.$form,c=this.getUploadTypeObject(this.assetType);b.find("input[type='file']").attr("multiple",!1);c.imageSelection();b.fileupload({autoUpload:!0,url:d(".ac-custom-upload-form").attr("action"),dataType:"json",type:"POST",add:function(f,h){var e=h.files[0];
h.resourceIndex=c.index;c.isValidFile(e,function(f){d.extend(h,f);h.statusCode===g.StatusCode.INVALID_FILE_TYPE?a.show("pc-image-mime-type-incorrect",{timeOut:"6000"}):h.statusCode===g.StatusCode.INVALIDFILESIZE?a.show("pc-image-size-incorrect",{timeOut:"6000"}):(c.createResourceStub(b,h.resourceIndex),l.post("/gp/features/fetch-imageUpload-s3post-parameters.html",{dataType:"json",params:{contentType:"image",csrfToken:d(".ac-custom-upload-form").attr("data-csrf"),uid:c.getResourcePath(),extension:"."+
h.fileInput.val().split(".").pop().toLowerCase(),isDPX:1},success:function(a){h.uploadObject=c;c.setBucket(a.imageToken.split("/")[0]);c.setFileName(e.name);c.setKey(h.resourceIndex);c.setResourcePath(a.key.split(".")[0]);c.getKey();b.attr("action",a.action);d("#key",b).val(a.key);d("#AWSAccessKeyId",b).val(a.AWSAccessKeyId);d("#policy",b).val(a.policy);d("#signature",b).val(a.signature);d("#success_action_status",b).val(a.statusCode);d("#expires",b).val(a.expires);h.pcImageUrl=a.thumbnailUrl;h.imageName=
a.key;h.imageToken=a.imageToken;h.submit()},error:function(b){a.show("pc-upload-error-message",{timeOut:"6000"});l.trigger("amazon-custom-log-ref-tag","logS3TextUploadError")}}))})},send:function(b,a){d(".ac-upload-progress").text("0%");p.imageLoading.show()},fail:function(b,h){p.imageLoading.hide();a.show("pc-upload-error-message",{timeOut:"6000"});d(".ac-upload-progress").text("");l.trigger("amazon-custom-log-ref-tag","logS3ImageUploadError")},done:function(b,a){d(".ac-upload-progress").text("100%");
p.imageLoading.hide();a.uploadObject.updateView(a,a.statusCode);d(".ac-upload-progress").text("")},progress:function(b,a){var c=parseInt(a.loaded/a.total*100,10);d(".ac-upload-progress").text(c+"%")}})};return c});C.when("A","AssetUploader","ac-constants","ready").execute(function(l,p,g){l.declarative("asset-upload","click",function(e){var a;e.$target.data("asset-upload")===v&&(a=new p({$form:e.$target.parentsUntil(".ac-custom-upload-container","form"),assetType:"image",uploadType:e.data["upload-type"],
mediaServer:"https://images-na.ssl-images-amazon.com/images/S/"}),a.Init(),e.$target.data("asset-upload",a))})})})();(function(){C.when("A","ready").register("ac-gallery-base",function(l){l=function(){};l.prototype={generateUUID:function(){function l(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return l()+l()+"-"+l()+"-"+l()+"-"+l()+"-"+l()+l()+l()},getTimeStamp:function(){var l=new Date;return l.getUTCFullYear()+"-"+l.getUTCMonth()+"-"+l.getUTCDate()+"-"+l.getUTCHours()+
"-"+l.getUTCMinutes()},getFileExtension:function(){var l=/^.+\.([^.]+)$/.exec(this.fileName);return null===l?"":"."+l[1].toLowerCase()},getFileNameWithoutExtension:function(){var l=this.fileName.split(".")[0];return null===l?"":l.toLowerCase()},getKey:function(){return this.key},isValidFile:function(){console.log("No Implementation - isValidFile")},setBucket:function(l){this.bucket=l},getBucket:function(){return this.bucket},setFileName:function(l){this.fileName=l},updateView:function(){console.log("No Implementation - ValidateAndUpdate")},
setResourcePath:function(l){this.ResourcePath=l},getResourcePath:function(){return this.ResourcePath}};return l})})();(function(){C.when("A","ac-base","ac-utils","ready").register("ac-error-handling",function(l,p,g){var e=l.$,a,d,c,b,k;a=function(){return e(".ac-error-container")};d=function(){return e(".ac-error-container .a-alert-heading")};c=function(){return e(".ac-error-container .a-alert-content")};b=function(b){var a;a={type:b.type?b.type:"error",message:b.message};-1!==k.indexOf(b.id)&&(a.type=
"warning");return a};k=["pc-error-generic-text","pc-resolution-warning","pc-scale-warning-message","pc-generic-warning-text"];return{show:function(f,h){var k={};f?k=b({id:f,message:g.stringHandler(f)}):(k.type=h.type,k.message=h.message);a().removeClass("a-alert-warning a-alert-error a-alert-success a-alert-info").addClass("a-alert-"+k.type);d().text(k.type.charAt(0).toUpperCase()+k.type.slice(1)+" Message");c().html(k.message);a().addClass("active");h&&h.timeOut&&setTimeout(function(){a().removeClass("active")},
parseInt(h.timeOut,10))},hide:function(){a().removeClass("active")}}})})();(function(){C.when("A","a-dropdown","ac-base","ac-utils","fabric-js","ac-constants","ready").register("ac-text-image",function(l,p,g,e,a,d){var c=l.$;return function(b,k){var f=this,h,n,g={},r;r=function(){g=c.extend({},d.textDefaults);n&&n.setText("")};f.isInitialized=!1;f.changeFont=function(b){f.updateText({fontFamily:b})};f.toggleStyle=function(b){var a={};switch(b){case "boldoff":a.fontWeight="normal";f.updateText(a);
break;case "boldon":a.fontWeight="bold";f.updateText(a);break;case "italicson":a.fontStyle="italic";f.updateText(a);break;case "italicsoff":a.fontStyle="normal";f.updateText(a);break;case "underlineon":a.textDecoration="underline";f.updateText(a);break;case "underlineoff":a.textDecoration="normal",f.updateText(a)}};f.style=function(b){};f.changeAlign=function(b){var a={};switch(b){case "left":a.textAlign="left";f.updateText(a);break;case "center":a.textAlign="center";f.updateText(a);break;case "right":a.textAlign=
"right",f.updateText(a)}};f.changeTextColor=function(b){c(".simplecolorpicker.icon").css("background-color",b);f.updateText({fill:b})};f.editText=function(b){n.setText(b);f.updateText(null)};f.resetControl=function(){c("#pcTextArea").val("");c(".pc-textArea-fontStyle-li").removeClass("button-active");c(".pc-textArea-fontAlign-li").removeClass("button-active");c('.pc-textArea-fontAlign-li[data-align="left"]').addClass("button-active");p.getSelect("fontPicker").setValue("Arial");c(".simplecolorpicker.icon").css({"background-color":c("ul.pc-textArea-fontColor-ul li.pc-textArea-fontColor-li:first-child div").css("background-color")})};
f.updateControl=function(){if(f.isInitialized){f.resetControl();var a=b.getObjects();g.text="";for(var h=0;h<a.length;h++)"text"===a[h].type&&(g.text=a[h].text);c("#pcTextArea").val(g.text);"bold"===g.fontWeight&&c('.pc-textArea-fontStyle-li[data-style="bold"]').addClass("button-active");"underline"===g.textDecoration&&c('.pc-textArea-fontStyle-li[data-style="underline"]').addClass("button-active");"italic"===g.fontStyle&&c('.pc-textArea-fontStyle-li[data-style="italics"]').addClass("button-active");
"right"===g.textAlign?(c(".pc-textArea-fontAlign-li").removeClass("button-active"),c('.pc-textArea-fontAlign-li[data-align="right"]').addClass("button-active")):"center"===g.textAlign&&(c(".pc-textArea-fontAlign-li").removeClass("button-active"),c('.pc-textArea-fontAlign-li[data-align="center"]').addClass("button-active"));p.getSelect(c("#fontPicker")).setValue(g.fontFamily);c(".simplecolorpicker.icon").css({"background-color":g.fill})}else f.init(),f.resetControl()};f.select=function(){l.each(b.getObjects(),
function(a){"text"===a.type&&b.canvas.setActiveObject(a)})};h=function(h){for(var k,e=b.getObjects(),n=b.canvas.size()-1;0<=n;n--)if(e[n].id&&e[n].id===h.id)return null;k=function(a){b.canvas.add(a);a.bringToFront();b.canvas.calcOffset();a.setCoords();b.canvas.setActiveObject(a);b.renderAll()};h=function(a){var f={};c.extend(f,a,d.textDefaults);f.id="text-"+b.id;return g=f}(h?h:{});h.fontSize=b.canvas.width/5;h.fill=b.surface.data.FontSettings.colors[0].value;c("#pcTextArea").val("");f.updateText(null);
return function(){var f=new a.Text(h.text,{angle:h.angle,opacity:h.opacity,fontFamily:h.fontFamily,fontSize:h.fontSize,fontWeight:h.fontWeight,fontStyle:h.fontStyle,id:h.id,cursorColor:"#ffffff",fill:h.fill,transparentCorners:!1,centeredRotation:!0,centeredScaling:!0,padding:5,originX:"left",originY:"top",selectable:!0,textAlign:h.textAlign});f.set({left:20,top:b.canvas.height/2-h.fontSize/2});k(f);return f}()};var m=function(a){for(var f=b.getObjects(),h=f.length-1;0<=h;h--)f[h].name&&"galImage"===
f[h].name&&b.canvas.remove(f[h]);n&&(n.bringToFront(),b.canvas.calcOffset(),"object"===typeof a?(n.set(a),c.extend(g,g,a)):"string"===typeof a&&(n.setText(a),g.text=a,c("#pcTextArea").val(a)),n.setCoords(),b.canvas.setActiveObject(n),""===g.text?c(".pc-two-column-layout .ac-delete-button").fadeOut():c(".pc-two-column-layout .ac-delete-button").fadeIn());b.renderAll()};f.updateText=function(a){var h,c,k,d,n=!1;h=b.getObjects();c=e.stringHandler("pc-clear-design-msg");k=function(){b.surface.widget.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var a=
b.getObjects(),f=0;f<a.length;f++)a[f].name&&"galImage"===a[f].name&&b.clear()})});m(a)};d=function(){for(var a=b.canvas.size()-1;0<=a;a--)if("text"===h[a].type){h[a].remove();break}f.cleared();b.controls.textInput.isControlActive=!1};b.surface.widget.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){b=b.getObjects();for(var a=0;a<b.length;a++)if(b[a].name&&"galImage"===b[a].name){n=!0;break}})});n?e.showDialog.show(c,k,{ok:"Clear",cancelCallBack:d}):k()};f.cleared=function(){f.resetControl();
r();f.isInitialized=!1};f.hasRequiredField=function(){return!1};f.requiredFieldsAreValid=function(){return!0};f.containsEmoji=function(){var b=c("#pcTextArea").val();return d.emojiMatchPattern.test(b)};f.init=function(){f.isInitialized=!0;n=h()}}})})()});
(function(C){var A=window.AmazonUIPageJS||window.P,v=A._namespace||A.attributeErrors,l=v?v("ProductCustomizationFileUploadAssets"):A;l.guardFatal?l.guardFatal(C)(l,window):l.execute(function(){C(l,window)})})(function(C,A,v){C.when("A","jQuery").register("jq-ui-widget",function(l,p){(function(g){g(p)})(function(g,e){var a=0,d=Array.prototype.slice,c=g.cleanData;g.cleanData=function(b){for(var a=0,f;null!=(f=b[a]);a++)try{g(f).triggerHandler("remove")}catch(h){}c(b)};g.widget=function(b,a,f){var h,
c,d,e,m={},u=b.split(".")[0];b=b.split(".")[1];h=u+"-"+b;f||(f=a,a=g.Widget);g.expr[":"][h.toLowerCase()]=function(b){return!!g.data(b,h)};g[u]=g[u]||{};c=g[u][b];d=g[u][b]=function(b,a){if(!this._createWidget)return new d(b,a);arguments.length&&this._createWidget(b,a)};g.extend(d,c,{version:f.version,_proto:g.extend({},f),_childConstructors:[]});e=new a;e.options=g.widget.extend({},e.options);g.each(f,function(b,f){g.isFunction(f)?m[b]=function(){var h=function(){return a.prototype[b].apply(this,
arguments)},c=function(f){return a.prototype[b].apply(this,f)};return function(){var b=this._super,a=this._superApply,k;this._super=h;this._superApply=c;k=f.apply(this,arguments);this._super=b;this._superApply=a;return k}}():m[b]=f});d.prototype=g.widget.extend(e,{widgetEventPrefix:c?e.widgetEventPrefix||b:b},m,{constructor:d,namespace:u,widgetName:b,widgetFullName:h});c?(g.each(c._childConstructors,function(b,a){var f=a.prototype;g.widget(f.namespace+"."+f.widgetName,d,a._proto)}),delete c._childConstructors):
a._childConstructors.push(d);g.widget.bridge(b,d)};g.widget.extend=function(b){for(var a=d.call(arguments,1),f=0,h=a.length,c,q;f<h;f++)for(c in a[f])q=a[f][c],a[f].hasOwnProperty(c)&&q!==e&&(g.isPlainObject(q)?b[c]=g.isPlainObject(b[c])?g.widget.extend({},b[c],q):g.widget.extend({},q):b[c]=q);return b};g.widget.bridge=function(b,a){var f=a.prototype.widgetFullName||b;g.fn[b]=function(h){var c="string"===typeof h,q=d.call(arguments,1),r=this;h=!c&&q.length?g.widget.extend.apply(null,[h].concat(q)):
h;c?this.each(function(){var a,c=g.data(this,f);if(!c)return g.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+h+"'");if(!g.isFunction(c[h])||"_"===h.charAt(0))return g.error("no such method '"+h+"' for "+b+" widget instance");a=c[h].apply(c,q);if(a!==c&&a!==e)return r=a&&a.jquery?r.pushStack(a.get()):a,!1}):this.each(function(){var b=g.data(this,f);b?b.option(h||{})._init():g.data(this,f,new a(h,this))});return r}};g.Widget=function(){};g.Widget._childConstructors=
[];g.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,c){c=g(c||this.defaultElement||this)[0];this.element=g(c);this.uuid=a++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=g.widget.extend({},this.options,this._getCreateOptions(),b);this.bindings=g();this.hoverable=g();this.focusable=g();c!==this&&(g.data(c,this.widgetFullName,this),this._on(!0,this.element,{remove:function(b){b.target===c&&
this.destroy()}}),this.document=g(c.style?c.ownerDocument:c.document||c),this.window=g(this.document[0].defaultView||this.document[0].parentWindow));this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:g.noop,_getCreateEventData:g.noop,_create:g.noop,_init:g.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(g.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+
"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:g.noop,widget:function(){return this.element},option:function(b,a){var f=b,h,c,d;if(0===arguments.length)return g.widget.extend({},this.options);if("string"===typeof b)if(f={},h=b.split("."),b=h.shift(),h.length){c=f[b]=g.widget.extend({},this.options[b]);for(d=0;d<h.length-1;d++)c[h[d]]=c[h[d]]||{},c=c[h[d]];b=h.pop();if(1===
arguments.length)return c[b]===e?null:c[b];c[b]=a}else{if(1===arguments.length)return this.options[b]===e?null:this.options[b];f[b]=a}this._setOptions(f);return this},_setOptions:function(b){for(var a in b)this._setOption(a,b[a]);return this},_setOption:function(b,a){this.options[b]=a;"disabled"===b&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!a).attr("aria-disabled",a),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"));return this},
enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,a,f){var h,c=this;"boolean"!==typeof b&&(f=a,a=b,b=!1);f?(a=h=g(a),this.bindings=this.bindings.add(a)):(f=a,a=this.element,h=this.widget());g.each(f,function(f,d){function e(){if(b||!0!==c.options.disabled&&!g(this).hasClass("ui-state-disabled"))return("string"===typeof d?c[d]:d).apply(c,arguments)}"string"!==typeof d&&(e.guid=d.guid=d.guid||e.guid||g.guid++);var u=f.match(/^(\w+)\s*(.*)$/),
t=u[1]+c.eventNamespace;(u=u[2])?h.delegate(u,t,e):a.bind(t,e)})},_off:function(b,a){a=(a||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;b.unbind(a).undelegate(a)},_delay:function(b,a){var f=this;return setTimeout(function(){return("string"===typeof b?f[b]:b).apply(f,arguments)},a||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b);this._on(b,{mouseenter:function(b){g(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){g(b.currentTarget).removeClass("ui-state-hover")}})},
_focusable:function(b){this.focusable=this.focusable.add(b);this._on(b,{focusin:function(b){g(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){g(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,a,f){var h,c=this.options[b];f=f||{};a=g.Event(a);a.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase();a.target=this.element[0];if(b=a.originalEvent)for(h in b)h in a||(a[h]=b[h]);this.element.trigger(a,f);return!(g.isFunction(c)&&!1===c.apply(this.element[0],
[a].concat(f))||a.isDefaultPrevented())}};g.each({show:"fadeIn",hide:"fadeOut"},function(b,a){g.Widget.prototype["_"+b]=function(f,h,c){"string"===typeof h&&(h={effect:h});var d,e=h?!0===h||"number"===typeof h?a:h.effect||a:b;h=h||{};"number"===typeof h&&(h={duration:h});d=!g.isEmptyObject(h);h.complete=c;h.delay&&f.delay(h.delay);if(d&&g.effects&&g.effects.effect[e])f[b](h);else if(e!==b&&f[e])f[e](h.duration,h.easing,c);else f.queue(function(a){g(this)[b]();c&&c.call(f[0]);a()})}})})});C.when("A",
"jQuery").register("jq-IframeTransport",function(l,p){(function(g){g(p)})(function(g){var e=0;g.ajaxTransport("iframe",function(a){if(a.async){var d=a.initialIframeSrc||"javascript:false;",c,b,k;return{send:function(f,h){c=g('<form style="display:none;"></form>');c.attr("accept-charset",a.formAcceptCharset);k=/\?/.test(a.url)?"&":"?";"DELETE"===a.type?(a.url=a.url+k+"_method=DELETE",a.type="POST"):"PUT"===a.type?(a.url=a.url+k+"_method=PUT",a.type="POST"):"PATCH"===a.type&&(a.url=a.url+k+"_method=PATCH",
a.type="POST");e+=1;b=g('<iframe src="'+d+'" name="iframe-transport-'+e+'"></iframe>').bind("load",function(){var f,k=g.isArray(a.paramName)?a.paramName:[a.paramName];b.unbind("load").bind("load",function(){var a;try{if(a=b.contents(),!a.length||!a[0].firstChild)throw Error();}catch(f){a=v}h(200,"success",{iframe:a});g('<iframe src="'+d+'"></iframe>').appendTo(c);A.setTimeout(function(){c.remove()},0)});c.prop("target",b.prop("name")).prop("action",a.url).prop("method",a.type);a.formData&&g.each(a.formData,
function(b,a){"file"!==a.name&&g('<input type="hidden"/>').prop("name",a.name).val(a.value).appendTo(c)});a.fileInput&&a.fileInput.length&&"POST"===a.type&&(f=a.fileInput.clone(),a.fileInput.after(function(b){return f[b]}),a.paramName&&a.fileInput.each(function(b){g(this).prop("name",k[b]||a.paramName)}),c.append(a.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),a.fileInput.removeAttr("form"));c.submit();f&&f.length&&a.fileInput.each(function(b,a){var h=g(f[b]);
g(a).prop("name",h.prop("name")).attr("form",h.attr("form"));h.replaceWith(a)})});c.append(b).appendTo(document.body)},abort:function(){b&&b.unbind("load").prop("src",d);c&&c.remove()}}}});g.ajaxSetup({converters:{"iframe text":function(a){return a&&g(a[0].body).text()},"iframe json":function(a){return a&&g.parseJSON(g(a[0].body).text())},"iframe html":function(a){return a&&g(a[0].body).html()},"iframe xml":function(a){return(a=a&&a[0])&&g.isXMLDoc(a)?a:g.parseXML(a.XMLDocument&&a.XMLDocument.xml||
g(a.body).html())},"iframe script":function(a){return a&&g.globalEval(g(a[0].body).text())}}})})});C.when("A","jQuery","jq-ui-widget").register("jq-fileupload",function(l,p,g){(function(e){e(p)})(function(e){e.support.fileInput=!(/(Android (1\.[0156]|2\.[01]))|(Windows Phone (OS 7|8\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1\.0|2\.[05]|3\.0))/.test(A.navigator.userAgent)||e('<input type="file">').prop("disabled"));e.support.xhrFileUpload=!(!A.ProgressEvent||!A.FileReader);
e.support.xhrFormDataFileUpload=!!A.FormData;e.support.blobSlice=A.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:e(document),fileInput:v,replaceFileInput:!0,paramName:v,singleFileUploads:!0,limitMultiFileUploads:v,limitMultiFileUploadSize:v,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:v,forceIframeTransport:!1,redirect:v,redirectParamName:v,postMessage:v,multipart:!0,
maxChunkSize:v,uploadedBytes:v,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(a,d){a=this.messages[a]||a.toString();d&&e.each(d,function(c,b){a=a.replace("{"+c+"}",b)});return a},formData:function(a){return a.serializeArray()},add:function(a,d){if(a.isDefaultPrevented())return!1;(d.autoUpload||!1!==d.autoUpload&&e(this).fileupload("option","autoUpload"))&&d.process().done(function(){d.submit()})},
processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.bitrate=this.loaded=0;this.getBitrate=function(a,d,c){var b=a-this.timestamp;if(!this.bitrate||!c||b>c)this.bitrate=1E3/b*(d-this.loaded)*8,this.loaded=d,this.timestamp=
a;return this.bitrate}},_isXHRUpload:function(a){return!a.forceIframeTransport&&(!a.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(a){var d;return"function"===e.type(a.formData)?a.formData(a.form):e.isArray(a.formData)?a.formData:"object"===e.type(a.formData)?(d=[],e.each(a.formData,function(a,b){d.push({name:a,value:b})}),d):[]},_getTotal:function(a){var d=0;e.each(a,function(a,b){d+=b.size||1});return d},_initProgressObject:function(a){var d={loaded:0,
total:0,bitrate:0};a._progress?e.extend(a._progress,d):a._progress=d},_initResponseObject:function(a){var d;if(a._response)for(d in a._response)a._response.hasOwnProperty(d)&&delete a._response[d];else a._response={}},_onProgress:function(a,d){if(a.lengthComputable){var c=Date.now?Date.now():(new Date).getTime(),b;d._time&&d.progressInterval&&c-d._time<d.progressInterval&&a.loaded!==a.total||(d._time=c,b=Math.floor(a.loaded/a.total*(d.chunkSize||d._progress.total))+(d.uploadedBytes||0),this._progress.loaded+=
b-d._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(c,this._progress.loaded,d.bitrateInterval),d._progress.loaded=d.loaded=b,d._progress.bitrate=d.bitrate=d._bitrateTimer.getBitrate(c,b,d.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:a}),d),this._trigger("progressall",e.Event("progressall",{delegatedEvent:a}),this._progress))}},_initProgressListener:function(a){var d=this,c=a.xhr?a.xhr():e.ajaxSettings.xhr();c.upload&&(e(c.upload).bind("progress",
function(b){var c=b.originalEvent;b.lengthComputable=c.lengthComputable;b.loaded=c.loaded;b.total=c.total;d._onProgress(b,a)}),a.xhr=function(){return c})},_isInstanceOf:function(a,d){return Object.prototype.toString.call(d)==="[object "+a+"]"},_initXHRData:function(a){var d=this,c,b=a.files[0],k=a.multipart||!e.support.xhrFileUpload,f="array"===e.type(a.paramName)?a.paramName[0]:a.paramName;a.headers=e.extend({},a.headers);a.contentRange&&(a.headers["Content-Range"]=a.contentRange);k&&!a.blob&&this._isInstanceOf("File",
b)||(a.headers["Content-Disposition"]='attachment; filename="'+encodeURI(b.name)+'"');k?e.support.xhrFormDataFileUpload&&(a.postMessage?(c=this._getFormData(a),a.blob?c.push({name:f,value:a.blob}):e.each(a.files,function(b,k){c.push({name:"array"===e.type(a.paramName)&&a.paramName[b]||f,value:k})})):(d._isInstanceOf("FormData",a.formData)?c=a.formData:(c=new FormData,e.each(this._getFormData(a),function(b,a){c.append(a.name,a.value)})),a.blob?c.append(f,a.blob,b.name):e.each(a.files,function(b,k){(d._isInstanceOf("File",
k)||d._isInstanceOf("Blob",k))&&c.append("array"===e.type(a.paramName)&&a.paramName[b]||f,k,k.uploadName||k.name)})),a.data=c):(a.contentType=b.type||"application/octet-stream",a.data=a.blob||b);a.blob=null},_initIframeSettings:function(a){var d=e("<a></a>").prop("href",a.url).prop("host");a.dataType="iframe "+(a.dataType||"");a.formData=this._getFormData(a);a.redirect&&d&&d!==location.host&&a.formData.push({name:a.redirectParamName||"redirect",value:a.redirect})},_initDataSettings:function(a){this._isXHRUpload(a)?
(this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),this._initProgressListener(a)),a.postMessage&&(a.dataType="postmessage "+(a.dataType||""))):this._initIframeSettings(a)},_getParamName:function(a){var d=e(a.fileInput),c=a.paramName;c?e.isArray(c)||(c=[c]):(c=[],d.each(function(){for(var b=e(this),a=b.prop("name")||"files[]",b=(b.prop("files")||[1]).length;b;)c.push(a),--b}),c.length||(c=[d.prop("name")||"files[]"]));return c},_initFormSettings:function(a){a.form&&a.form.length||(a.form=e(a.fileInput.prop("form")),
a.form.length||(a.form=e(this.options.fileInput.prop("form"))));a.paramName=this._getParamName(a);a.url||(a.url=a.form.prop("action")||location.href);a.type=(a.type||"string"===e.type(a.form.prop("method"))&&a.form.prop("method")||"").toUpperCase();"POST"!==a.type&&"PUT"!==a.type&&"PATCH"!==a.type&&(a.type="POST");a.formAcceptCharset||(a.formAcceptCharset=a.form.attr("accept-charset"))},_getAJAXSettings:function(a){a=e.extend({},this.options,a);this._initFormSettings(a);this._initDataSettings(a);
return a},_getDeferredState:function(a){return a.state?a.state():a.isResolved()?"resolved":a.isRejected()?"rejected":"pending"},_enhancePromise:function(a){a.success=a.done;a.error=a.fail;a.complete=a.always;return a},_getXHRPromise:function(a,d,c){var b=e.Deferred(),k=b.promise();d=d||this.options.context||k;!0===a?b.resolveWith(d,c):!1===a&&b.rejectWith(d,c);k.abort=b.promise;return this._enhancePromise(k)},_addConvenienceMethods:function(a,d){var c=this,b=function(b){return e.Deferred().resolveWith(c,
b).promise()};d.process=function(a,f){if(a||f)d._processQueue=this._processQueue=(this._processQueue||b([this])).pipe(function(){return d.errorThrown?e.Deferred().rejectWith(c,[d]).promise():b(arguments)}).pipe(a,f);return this._processQueue||b([this])};d.submit=function(){"pending"!==this.state()&&(d.jqXHR=this.jqXHR=!1!==c._trigger("submit",e.Event("submit",{delegatedEvent:a}),this)&&c._onSend(a,this));return this.jqXHR||c._getXHRPromise()};d.abort=function(){if(this.jqXHR)return this.jqXHR.abort();
this.errorThrown="abort";c._trigger("fail",null,this);return c._getXHRPromise(!1)};d.state=function(){if(this.jqXHR)return c._getDeferredState(this.jqXHR);if(this._processQueue)return c._getDeferredState(this._processQueue)};d.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===c._getDeferredState(this._processQueue)};d.progress=function(){return this._progress};d.response=function(){return this._response}},_getUploadedBytes:function(a){return(a=(a=(a=a.getResponseHeader("Range"))&&
a.split("-"))&&1<a.length&&parseInt(a[1],10))&&a+1},_chunkedUpload:function(a,d){a.uploadedBytes=a.uploadedBytes||0;var c=this,b=a.files[0],k=b.size,f=a.uploadedBytes,h=a.maxChunkSize||k,n=this._blobSlice,g=e.Deferred(),r=g.promise(),m,u;if(!(this._isXHRUpload(a)&&n&&(f||h<k))||a.data)return!1;if(d)return!0;if(f>=k)return b.error=a.i18n("uploadedBytes"),this._getXHRPromise(!1,a.context,[null,"error",b.error]);u=function(){var d=e.extend({},a),r=d._progress.loaded;d.blob=n.call(b,f,f+h,b.type);d.chunkSize=
d.blob.size;d.contentRange="bytes "+f+"-"+(f+d.chunkSize-1)+"/"+k;c._initXHRData(d);c._initProgressListener(d);m=(!1!==c._trigger("chunksend",null,d)&&e.ajax(d)||c._getXHRPromise(!1,d.context)).done(function(b,h,n){f=c._getUploadedBytes(n)||f+d.chunkSize;r+d.chunkSize-d._progress.loaded&&c._onProgress(e.Event("progress",{lengthComputable:!0,loaded:f-d.uploadedBytes,total:f-d.uploadedBytes}),d);a.uploadedBytes=d.uploadedBytes=f;d.result=b;d.textStatus=h;d.jqXHR=n;c._trigger("chunkdone",null,d);c._trigger("chunkalways",
null,d);f<k?u():g.resolveWith(d.context,[b,h,n])}).fail(function(b,a,f){d.jqXHR=b;d.textStatus=a;d.errorThrown=f;c._trigger("chunkfail",null,d);c._trigger("chunkalways",null,d);g.rejectWith(d.context,[b,a,f])})};this._enhancePromise(r);r.abort=function(){return m.abort()};u();return r},_beforeSend:function(a,d){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0);this._initResponseObject(d);this._initProgressObject(d);
d._progress.loaded=d.loaded=d.uploadedBytes||0;d._progress.total=d.total=this._getTotal(d.files)||1;d._progress.bitrate=d.bitrate=0;this._active+=1;this._progress.loaded+=d.loaded;this._progress.total+=d.total},_onDone:function(a,d,c,b){var k=b._progress.total,f=b._response;b._progress.loaded<k&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:k,total:k}),b);f.result=b.result=a;f.textStatus=b.textStatus=d;f.jqXHR=b.jqXHR=c;this._trigger("done",null,b)},_onFail:function(a,d,c,b){var k=
b._response;b.recalculateProgress&&(this._progress.loaded-=b._progress.loaded,this._progress.total-=b._progress.total);k.jqXHR=b.jqXHR=a;k.textStatus=b.textStatus=d;k.errorThrown=b.errorThrown=c;this._trigger("fail",null,b)},_onAlways:function(a,d,c,b){this._trigger("always",null,b)},_onSend:function(a,d){d.submit||this._addConvenienceMethods(a,d);var c=this,b,k,f,h,n=c._getAJAXSettings(d),g=function(){c._sending+=1;n._bitrateTimer=new c._BitrateTimer;return b=b||((k||!1===c._trigger("send",e.Event("send",
{delegatedEvent:a}),n))&&c._getXHRPromise(!1,n.context,k)||c._chunkedUpload(n)||e.ajax(n)).done(function(b,a,f){c._onDone(b,a,f,n)}).fail(function(b,a,f){c._onFail(b,a,f,n)}).always(function(b,a,f){c._onAlways(b,a,f,n);--c._sending;--c._active;if(n.limitConcurrentUploads&&n.limitConcurrentUploads>c._sending)for(b=c._slots.shift();b;){if("pending"===c._getDeferredState(b)){b.resolve();break}b=c._slots.shift()}0===c._active&&c._trigger("stop")})};this._beforeSend(a,n);return this.options.sequentialUploads||
this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(1<this.options.limitConcurrentUploads?(f=e.Deferred(),this._slots.push(f),h=f.pipe(g)):h=this._sequence=this._sequence.pipe(g,g),h.abort=function(){k=[v,"abort","abort"];return b?b.abort():(f&&f.rejectWith(n.context,k),g())},this._enhancePromise(h)):g()},_onAdd:function(a,d){var c=this,b=!0,k=e.extend({},this.options,d),f=d.files,h=f.length,n=k.limitMultiFileUploads,g=k.limitMultiFileUploadSize,r=k.limitMultiFileUploadSizeOverhead,
m=0,u=this._getParamName(k),t,H,F=0;!g||h&&f[0].size!==v||(g=v);if((k.singleFileUploads||n||g)&&this._isXHRUpload(k))if(k.singleFileUploads||g||!n)if(!k.singleFileUploads&&g)for(H=[],t=[],k=0;k<h;k+=1){if(m+=f[k].size+r,k+1===h||m+f[k+1].size+r>g||n&&k+1-F>=n)H.push(f.slice(F,k+1)),m=u.slice(F,k+1),m.length||(m=u),t.push(m),F=k+1,m=0}else t=u;else for(H=[],t=[],k=0;k<h;k+=n)H.push(f.slice(k,k+n)),m=u.slice(k,k+n),m.length||(m=u),t.push(m);else H=[f],t=[u];d.originalFiles=f;e.each(H||f,function(f,
h){var k=e.extend({},d);k.files=H?h:[h];k.paramName=t[f];c._initResponseObject(k);c._initProgressObject(k);c._addConvenienceMethods(a,k);return b=c._trigger("add",e.Event("add",{delegatedEvent:a}),k)});return b},_replaceFileInput:function(a){var d=a.clone(!0);e("<form></form>").append(d)[0].reset();a.after(d).detach();e.cleanData(a.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(c,b){return b===a[0]?d[0]:b});a[0]===this.element[0]&&(this.element=d)},_handleFileTreeEntry:function(a,
d){var c=this,b=e.Deferred(),k=function(f){f&&!f.entry&&(f.entry=a);b.resolve([f])},f;d=d||"";a.isFile?a._file?(a._file.relativePath=d,b.resolve(a._file)):a.file(function(a){a.relativePath=d;b.resolve(a)},k):a.isDirectory?(f=a.createReader(),f.readEntries(function(f){c._handleFileTreeEntries(f,d+a.name+"/").done(function(a){b.resolve(a)}).fail(k)},k)):b.resolve([]);return b.promise()},_handleFileTreeEntries:function(a,d){var c=this;return e.when.apply(e,e.map(a,function(b){return c._handleFileTreeEntry(b,
d)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(a){a=a||{};var d=a.items;return d&&d.length&&(d[0].webkitGetAsEntry||d[0].getAsEntry)?this._handleFileTreeEntries(e.map(d,function(a){var b;if(a.webkitGetAsEntry){if(b=a.webkitGetAsEntry())b._file=a.getAsFile();return b}return a.getAsEntry()})):e.Deferred().resolve(e.makeArray(a.files)).promise()},_getSingleFileInputFiles:function(a){a=e(a);var d=a.prop("webkitEntries")||a.prop("entries");if(d&&d.length)return this._handleFileTreeEntries(d);
d=e.makeArray(a.prop("files"));if(d.length)d[0].name===v&&d[0].fileName&&e.each(d,function(a,b){b.name=b.fileName;b.size=b.fileSize});else{a=a.prop("value");if(!a)return e.Deferred().resolve([]).promise();d=[{name:a.replace(/^.*\\/,"")}]}return e.Deferred().resolve(d).promise()},_getFileInputFiles:function(a){return a instanceof e&&1!==a.length?e.when.apply(e,e.map(a,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(a)},
_onChange:function(a){var d=this,c={fileInput:e(a.target),form:e(a.target.form)};this._getFileInputFiles(c.fileInput).always(function(b){c.files=b;d.options.replaceFileInput&&d._replaceFileInput(c.fileInput);!1!==d._trigger("change",e.Event("change",{delegatedEvent:a}),c)&&d._onAdd(a,c)})},_onPaste:function(a){var d=a.originalEvent&&a.originalEvent.clipboardData&&a.originalEvent.clipboardData.items,c={files:[]};d&&d.length&&(e.each(d,function(b,a){var f=a.getAsFile&&a.getAsFile();f&&c.files.push(f)}),
!1!==this._trigger("paste",e.Event("paste",{delegatedEvent:a}),c)&&this._onAdd(a,c))},_onDrop:function(a){a.dataTransfer=a.originalEvent&&a.originalEvent.dataTransfer;var d=this,c=a.dataTransfer,b={};c&&c.files&&c.files.length&&(a.preventDefault(),this._getDroppedFiles(c).always(function(c){b.files=c;!1!==d._trigger("drop",e.Event("drop",{delegatedEvent:a}),b)&&d._onAdd(a,b)}))},_onDragOver:function(a){a.dataTransfer=a.originalEvent&&a.originalEvent.dataTransfer;var d=a.dataTransfer;d&&-1!==e.inArray("Files",
d.types)&&!1!==this._trigger("dragover",e.Event("dragover",{delegatedEvent:a}))&&(a.preventDefault(),d.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste}));e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop");this._off(this.options.pasteZone,
"paste");this._off(this.options.fileInput,"change")},_setOption:function(a,d){var c=-1!==e.inArray(a,this._specialOptions);c&&this._destroyEventHandlers();this._super(a,d);c&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var a=this.options;a.fileInput===v?a.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):a.fileInput instanceof e||(a.fileInput=e(a.fileInput));a.dropZone instanceof e||(a.dropZone=e(a.dropZone));
a.pasteZone instanceof e||(a.pasteZone=e(a.pasteZone))},_getRegExp:function(a){a=a.split("/");var d=a.pop();a.shift();return new RegExp(a.join("/"),d)},_isRegExpOption:function(a,d){return"url"!==a&&"string"===e.type(d)&&/^\/.*\/[igm]{0,3}$/.test(d)},_initDataAttributes:function(){var a=this,d=this.options,c=e(this.element[0].cloneNode(!1));e.each(c.data(),function(b,k){var f="data-"+b.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();c.attr(f)&&(a._isRegExpOption(b,k)&&(k=a._getRegExp(k)),d[b]=k)})},
_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(a){var d=this;a&&!this.options.disabled&&(a.fileInput&&!a.files?this._getFileInputFiles(a.fileInput).always(function(c){a.files=c;d._onAdd(null,a)}):(a.files=e.makeArray(a.files),this._onAdd(null,
a)))},send:function(a){if(a&&!this.options.disabled){if(a.fileInput&&!a.files){var d=this,c=e.Deferred(),b=c.promise(),k,f;b.abort=function(){f=!0;if(k)return k.abort();c.reject(null,"abort","abort");return b};this._getFileInputFiles(a.fileInput).always(function(b){f||(b.length?(a.files=b,k=d._onSend(null,a).then(function(b,a,f){c.resolve(b,a,f)},function(b,a,f){c.reject(b,a,f)})):c.reject())});return this._enhancePromise(b)}a.files=e.makeArray(a.files);if(a.files.length)return this._onSend(null,
a)}return this._getXHRPromise(!1,a&&a.context)}})})})});
(function(C){var A=window.AmazonUIPageJS||window.P,v=A._namespace||A.attributeErrors,l=v?v("AmazonCustomFabricJS"):A;l.guardFatal?l.guardFatal(C)(l,window):l.execute(function(){C(l,window)})})(function(C,A,v){C.when("A").register("fabric-js",function(l){var p=p||{};if(!l.capabilities.canvas)return{};var g=g||{version:"1.6.0"};"undefined"!==typeof p&&(p.fabric=g);"undefined"!==typeof document&&"undefined"!==typeof A?(g.document=document,g.window=A,A.fabric=g):(g.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),
g.window=g.document.createWindow?g.document.createWindow():g.document.parentWindow);g.isTouchSupported="ontouchstart"in g.document.documentElement;g.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof A;g.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width id".split(" ");g.DPI=96;g.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";g.fontPaths={};g.devicePixelRatio=
g.window.devicePixelRatio||g.window.webkitDevicePixelRatio||g.window.mozDevicePixelRatio||1;"object"!==typeof JSON&&(JSON={});(function(){function e(b){return 10>b?"0"+b:b}function a(a){b.lastIndex=0;return b.test(a)?'"'+a.replace(b,function(b){var a=h[b];return"string"===typeof a?a:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(b,h){var c,e,g,H,F=k,z,J=h[b];J&&"object"===typeof J&&"function"===typeof J.toJSON&&(J=J.toJSON(b));"function"===typeof n&&(J=n.call(h,b,
J));switch(typeof J){case "string":return a(J);case "number":return isFinite(J)?String(J):"null";case "boolean":case "null":return String(J);case "object":if(!J)return"null";k+=f;z=[];if("[object Array]"===Object.prototype.toString.apply(J)){H=J.length;for(c=0;c<H;c+=1)z[c]=d(c,J)||"null";g=0===z.length?"[]":k?"[\n"+k+z.join(",\n"+k)+"\n"+F+"]":"["+z.join(",")+"]";k=F;return g}if(n&&"object"===typeof n)for(H=n.length,c=0;c<H;c+=1)"string"===typeof n[c]&&(e=n[c],(g=d(e,J))&&z.push(a(e)+(k?": ":":")+
g));else for(e in J)Object.prototype.hasOwnProperty.call(J,e)&&(g=d(e,J))&&z.push(a(e)+(k?": ":":")+g);g=0===z.length?"{}":k?"{\n"+k+z.join(",\n"+k)+"\n"+F+"}":"{"+z.join(",")+"}";k=F;return g}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=
Boolean.prototype.toJSON=function(){return this.valueOf()});var c,b,k,f,h,n;"function"!==typeof JSON.stringify&&(b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(b,a,h){var c;f=k="";if("number"===typeof h)for(c=0;c<h;c+=1)f+=" ";else"string"===typeof h&&(f=h);if((n=a)&&"function"!==typeof a&&("object"!==typeof a||"number"!==
typeof a.length))throw Error("JSON.stringify");return d("",{"":b})});"function"!==typeof JSON.parse&&(c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(b,a){function f(b,h){var c,k,d=b[h];if(d&&"object"===typeof d)for(c in d)Object.prototype.hasOwnProperty.call(d,c)&&(k=f(d,c),k!==v?d[c]=k:delete d[c]);return a.call(b,h,d)}var h;b=String(b);c.lastIndex=0;c.test(b)&&(b=b.replace(c,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));
if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return h=eval("("+b+")"),"function"===typeof a?f({"":h},""):h;throw new SyntaxError("JSON.parse");})})();(function(){function e(b,a){this.__eventListeners[b]&&(a?g.util.removeFromArray(this.__eventListeners[b],a):this.__eventListeners[b].length=0)}function a(b,a){this.__eventListeners||(this.__eventListeners=
{});if(1===arguments.length)for(var f in b)this.on(f,b[f]);else this.__eventListeners[b]||(this.__eventListeners[b]=[]),this.__eventListeners[b].push(a);return this}function d(b,a){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===typeof arguments[0])for(var f in b)e.call(this,f,b[f]);else e.call(this,b,a);return this}}function c(b,a){if(this.__eventListeners){var f=this.__eventListeners[b];if(f){for(var h=0,c=f.length;h<c;h++)f[h].call(this,
a||{});return this}}}g.Observable={observe:a,stopObserving:d,fire:c,on:a,off:d,trigger:c}})();g.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var e=0,a=arguments.length;e<a;e++)this._onObjectAdded(arguments[e]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(e,a,d){var c=this.getObjects();d?c[a]=e:c.splice(a,0,e);this._onObjectAdded(e);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var e=this.getObjects(),a,d=
0,c=arguments.length;d<c;d++)a=e.indexOf(arguments[d]),-1!==a&&(e.splice(a,1),this._onObjectRemoved(arguments[d]));this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(e,a){for(var d=this.getObjects(),c=d.length;c--;)e.call(a,d[c],c,d);return this},getObjects:function(e){return"undefined"===typeof e?this._objects:this._objects.filter(function(a){return a.type===e})},item:function(e){return this.getObjects()[e]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},
contains:function(e){return-1<this.getObjects().indexOf(e)},complexity:function(){return this.getObjects().reduce(function(e,a){return e+=a.complexity?a.complexity():0},0)}};(function(e){var a=Math.sqrt,d=Math.atan2,c=Math.pow,b=Math.abs,k=Math.PI/180;g.util={removeFromArray:function(b,a){var c=b.indexOf(a);-1!==c&&b.splice(c,1);return b},getRandomInt:function(b,a){return Math.floor(Math.random()*(a-b+1))+b},degreesToRadians:function(b){return b*k},radiansToDegrees:function(b){return b/k},rotatePoint:function(b,
a,c){b.subtractEquals(a);b=g.util.rotateVector(b,c);return(new g.Point(b.x,b.y)).addEquals(a)},rotateVector:function(b,a){var c=Math.sin(a),k=Math.cos(a);return{x:b.x*k-b.y*c,y:b.x*c+b.y*k}},transformPoint:function(b,a,c){return c?new g.Point(a[0]*b.x+a[2]*b.y,a[1]*b.x+a[3]*b.y):new g.Point(a[0]*b.x+a[2]*b.y+a[4],a[1]*b.x+a[3]*b.y+a[5])},makeBoundingBoxFromPoints:function(b){var a=[b[0].x,b[1].x,b[2].x,b[3].x],c=g.util.array.min(a),a=g.util.array.max(a),a=Math.abs(c-a),k=[b[0].y,b[1].y,b[2].y,b[3].y];
b=g.util.array.min(k);k=g.util.array.max(k);k=Math.abs(b-k);return{left:c,top:b,width:a,height:k}},invertTransform:function(b){var a=1/(b[0]*b[3]-b[1]*b[2]),a=[a*b[3],-a*b[1],-a*b[2],a*b[0]];b=g.util.transformPoint({x:b[4],y:b[5]},a,!0);a[4]=-b.x;a[5]=-b.y;return a},toFixed:function(b,a){return parseFloat(Number(b).toFixed(a))},parseUnit:function(b,a){var c=/\D{0,2}$/.exec(b),k=parseFloat(b);a||(a=g.Text.DEFAULT_SVG_FONT_SIZE);switch(c[0]){case "mm":return k*g.DPI/25.4;case "cm":return k*g.DPI/2.54;
case "in":return k*g.DPI;case "pt":return k*g.DPI/72;case "pc":return k*g.DPI/72*12;case "em":return k*a;default:return k}},falseFunction:function(){return!1},getKlass:function(b,a){b=g.util.string.camelize(b.charAt(0).toUpperCase()+b.slice(1));return g.util.resolveNamespace(a)[b]},resolveNamespace:function(b){if(!b)return g;b=b.split(".");for(var a=b.length,c=e||g.window,k=0;k<a;++k)c=c[b[k]];return c},loadImage:function(b,a,c,k){if(b){var d=g.util.createImage();d.onload=function(){a&&a.call(c,d);
d=d.onload=d.onerror=null};d.onerror=function(){g.log("Error loading "+d.src);a&&a.call(c,null,!0);d=d.onload=d.onerror=null};0!==b.indexOf("data")&&k&&(d.crossOrigin=k);d.src=b}else a&&a.call(c,b)},enlivenObjects:function(b,a,c,k){function d(){++u===t&&a&&a(e)}b=b||[];var e=[],u=0,t=b.length;t?b.forEach(function(b,a){if(b&&b.type){var f=g.util.getKlass(b.type,c);f.async?f.fromObject(b,function(f,c){c||(e[a]=f,k&&k(b,e[a]));d()}):(e[a]=f.fromObject(b),k&&k(b,e[a]),d())}else d()}):a&&a(e)},groupSVGElements:function(b,
a,c){b=new g.PathGroup(b,a);"undefined"!==typeof c&&b.setSourcePath(c);return b},populateWithProperties:function(b,a,c){if(c&&"[object Array]"===Object.prototype.toString.call(c))for(var k=0,d=c.length;k<d;k++)c[k]in b&&(a[c[k]]=b[c[k]])},drawDashedLine:function(b,c,k,e,g,m){e-=c;var u=g-k;g=a(e*e+u*u);e=d(u,e);var u=m.length,t=0,H=!0;b.save();b.translate(c,k);b.moveTo(0,0);b.rotate(e);for(c=0;g>c;)c+=m[t++%u],c>g&&(c=g),b[H?"lineTo":"moveTo"](c,0),H=!H;b.restore()},createCanvasElement:function(b){b||
(b=g.document.createElement("canvas"));b.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(b);return b},createImage:function(){return g.isLikelyNode?new (require("canvas").Image):g.document.createElement("img")},createAccessors:function(b){b=b.prototype;for(var a=b.stateProperties.length;a--;){var c=b.stateProperties[a],k=c.charAt(0).toUpperCase()+c.slice(1),d="set"+k,k="get"+k;b[k]||(b[k]=new Function('return this.get("'+c+'")'));b[d]||(b[d]=new Function("value",
'return this.set("'+c+'", value)'))}},clipContext:function(b,a){a.save();a.beginPath();b.clipTo(a);a.clip()},multiplyTransformMatrices:function(b,a,c){return[b[0]*a[0]+b[2]*a[1],b[1]*a[0]+b[3]*a[1],b[0]*a[2]+b[2]*a[3],b[1]*a[2]+b[3]*a[3],c?0:b[0]*a[4]+b[2]*a[5]+b[4],c?0:b[1]*a[4]+b[3]*a[5]+b[5]]},qrDecompose:function(b){var h=d(b[1],b[0]),e=c(b[0],2)+c(b[1],2),g=a(e),r=(b[0]*b[3]-b[2]*b[1])/g,e=d(b[0]*b[2]+b[1]*b[3],e);return{angle:h/k,scaleX:g,scaleY:r,skewX:e/k,skewY:0,translateX:b[4],translateY:b[5]}},
customTransformMatrix:function(a,c,d){d=[1,0,b(Math.tan(d*k)),1];a=[b(a),0,0,b(c)];return g.util.multiplyTransformMatrices(a,d,!0)},resetObjectTransform:function(b){b.scaleX=1;b.scaleY=1;b.skewX=0;b.skewY=0;b.flipX=!1;b.flipY=!1;b.setAngle(0)},getFunctionBody:function(b){return(String(b).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(b,a,c,k){0<k&&(a=a>k?a-k:0,c=c>k?c-k:0);var d=!0;b=b.getImageData(a,c,2*k||1,2*k||1);a=3;for(c=b.data.length;a<c&&(d=0>=b.data[a],!1!==d);a+=4);
return d},parsePreserveAspectRatioAttribute:function(b){var a="meet",c="Mid",k="Mid";b=b.split(" ");var d;b&&b.length&&(a=b.pop(),"meet"!==a&&"slice"!==a?(d=a,a="meet"):b.length&&(d=b.pop()));c="none"!==d?d.slice(1,4):"none";k="none"!==d?d.slice(5,8):"none";return{meetOrSlice:a,alignX:c,alignY:k}}}})("undefined"!==typeof p?p:this);(function(){function e(f,c,k,e,g,t,H){var F=h.call(arguments);if(b[F])return b[F];var z=Math.PI,J=H*z/180,l=Math.sin(J),J=Math.cos(J),D=0,y=0;k=Math.abs(k);e=Math.abs(e);
var B=-J*f*.5-l*c*.5,x=-J*c*.5+l*f*.5,w=k*k,p=e*e,K=x*x,E=B*B,L=w*p-w*K-p*E,M=0;0>L?(w=Math.sqrt(1-L/(w*p)),k*=w,e*=w):M=(g===t?-1:1)*Math.sqrt(L/(w*K+p*E));K=M*k*x/e;E=-M*e*B/k;M=J*K-l*E+.5*f;w=l*K+J*E+.5*c;p=d(1,0,(B-K)/k,(x-E)/e);x=d((B-K)/k,(x-E)/e,(-B-K)/k,(-x-E)/e);0===t&&0<x?x-=2*z:1===t&&0>x&&(x+=2*z);z=Math.ceil(Math.abs(x/z*2));B=[];x/=z;K=8/3*Math.sin(x/4)*Math.sin(x/4)/Math.sin(x/2);E=p+x;for(L=0;L<z;L++)B[L]=a(p,E,J,l,k,e,M,w,K,D,y),D=B[L][4],y=B[L][5],p=E,E+=x;return b[F]=B}function a(b,
a,f,c,d,e,g,F,z,J,l){var D=h.call(arguments);if(k[D])return k[D];var y=Math.cos(b),B=Math.sin(b),x=Math.cos(a),w=Math.sin(a),p=f*d*x-c*e*w+g,K=c*d*x+f*e*w+F;k[D]=[J+z*(-f*d*B-c*e*y),l+z*(-c*d*B+f*e*y),p+z*(f*d*w+c*e*x),K+z*(c*d*w-f*e*x),p,K];return k[D]}function d(b,a,f,c){b=Math.atan2(a,b);f=Math.atan2(c,f);return f>=b?f-b:2*Math.PI-(b-f)}function c(b,a,c,k,d,e,g,F){var z=h.call(arguments);if(f[z])return f[z];var J=Math.sqrt,l=Math.min,D=Math.max,y=Math.abs,B=[],x=[[],[]],w,p,K,E,L;p=6*b-12*c+6*
d;w=-3*b+9*c-9*d+3*g;K=3*c-3*b;for(var M=0;2>M;++M)0<M&&(p=6*a-12*k+6*e,w=-3*a+9*k-9*e+3*F,K=3*k-3*a),1E-12>y(w)?1E-12>y(p)||(E=-K/p,0<E&&1>E&&B.push(E)):(E=p*p-4*K*w,0>E||(L=J(E),E=(-p+L)/(2*w),0<E&&1>E&&B.push(E),E=(-p-L)/(2*w),0<E&&1>E&&B.push(E)));for(y=J=B.length;J--;)E=B[J],p=1-E,w=p*p*p*b+3*p*p*E*c+3*p*E*E*d+E*E*E*g,x[0][J]=w,w=p*p*p*a+3*p*p*E*k+3*p*E*E*e+E*E*E*F,x[1][J]=w;x[0][y]=b;x[1][y]=a;x[0][y+1]=g;x[1][y+1]=F;l=[{x:l.apply(null,x[0]),y:l.apply(null,x[1])},{x:D.apply(null,x[0]),y:D.apply(null,
x[1])}];return f[z]=l}var b={},k={},f={},h=Array.prototype.join;g.util.drawArc=function(b,a,f,c){var h=[[],[],[],[]];c=e(c[5]-a,c[6]-f,c[0],c[1],c[3],c[4],c[2]);for(var k=0,d=c.length;k<d;k++)h[k][0]=c[k][0]+a,h[k][1]=c[k][1]+f,h[k][2]=c[k][2]+a,h[k][3]=c[k][3]+f,h[k][4]=c[k][4]+a,h[k][5]=c[k][5]+f,b.bezierCurveTo.apply(b,h[k])};g.util.getBoundsOfArc=function(b,a,f,h,k,d,g,F,z){var J=0,l=0,D=[],y=[];f=e(F-b,z-a,f,h,d,g,k);h=[[],[]];k=0;for(d=f.length;k<d;k++)D=c(J,l,f[k][0],f[k][1],f[k][2],f[k][3],
f[k][4],f[k][5]),h[0].x=D[0].x+b,h[0].y=D[0].y+a,h[1].x=D[1].x+b,h[1].y=D[1].y+a,y.push(h[0]),y.push(h[1]),J=f[k][4],l=f[k][5];return y};g.util.getBoundsOfCurve=c})();(function(){function e(a,c,b){if(a&&0!==a.length){var k=a.length-1,f=c?a[k][c]:a[k];if(c)for(;k--;)b(a[k][c],f)&&(f=a[k][c]);else for(;k--;)b(a[k],f)&&(f=a[k]);return f}}var a=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var c=Object(this),b=c.length>>>
0;if(0===b)return-1;var k=0;0<arguments.length&&(k=Number(arguments[1]),k!==k?k=0:0!==k&&k!==Number.POSITIVE_INFINITY&&k!==Number.NEGATIVE_INFINITY&&(k=(0<k||-1)*Math.floor(Math.abs(k))));if(k>=b)return-1;for(k=0<=k?k:Math.max(b-Math.abs(k),0);k<b;k++)if(k in c&&c[k]===a)return k;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(a,c){for(var b=0,k=this.length>>>0;b<k;b++)b in this&&a.call(c,this[b],b,this)});Array.prototype.map||(Array.prototype.map=function(a,c){for(var b=[],
k=0,f=this.length>>>0;k<f;k++)k in this&&(b[k]=a.call(c,this[k],k,this));return b});Array.prototype.every||(Array.prototype.every=function(a,c){for(var b=0,k=this.length>>>0;b<k;b++)if(b in this&&!a.call(c,this[b],b,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(a,c){for(var b=0,k=this.length>>>0;b<k;b++)if(b in this&&a.call(c,this[b],b,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(a,c){for(var b=[],k,f=0,h=this.length>>>0;f<h;f++)f in
this&&(k=this[f],a.call(c,k,f,this)&&b.push(k));return b});Array.prototype.reduce||(Array.prototype.reduce=function(a){var c=this.length>>>0,b=0,k;if(1<arguments.length)k=arguments[1];else{do{if(b in this){k=this[b++];break}if(++b>=c)throw new TypeError;}while(1)}for(;b<c;b++)b in this&&(k=a.call(null,k,this[b],b,this));return k});g.util.array={invoke:function(d,c){for(var b=a.call(arguments,2),k=[],f=0,h=d.length;f<h;f++)k[f]=b.length?d[f][c].apply(d[f],b):d[f][c].call(d[f]);return k},min:function(a,
c){return e(a,c,function(b,a){return b<a})},max:function(a,c){return e(a,c,function(b,a){return b>=a})}}})();(function(){function e(a,d){for(var c in d)a[c]=d[c];return a}g.util.object={extend:e,clone:function(a){return e({},a)}}})();(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});g.util.string={camelize:function(e){return e.replace(/-+(.)?/g,function(a,d){return d?d.toUpperCase():""})},capitalize:function(e,a){return e.charAt(0).toUpperCase()+
(a?e.slice(1):e.slice(1).toLowerCase())},escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();(function(){var e=Array.prototype.slice,a=Function.prototype.apply,d=function(){};Function.prototype.bind||(Function.prototype.bind=function(c){var b=this,k=e.call(arguments,1),f;f=k.length?function(){return a.call(b,this instanceof d?this:c,k.concat(e.call(arguments)))}:function(){return a.call(b,this instanceof
d?this:c,arguments)};d.prototype=this.prototype;f.prototype=new d;return f})})();(function(){function e(){}function a(b){var a=this.constructor.superclass.prototype[b];return 1<arguments.length?a.apply(this,d.call(arguments,1)):a.call(this)}var d=Array.prototype.slice,c=function(){},b=function(){for(var b in{toString:1})if("toString"===b)return!1;return!0}(),k=function(a,c,k){for(var d in c)d in a.prototype&&"function"===typeof a.prototype[d]&&-1<(c[d]+"").indexOf("callSuper")?a.prototype[d]=function(b){return function(){var a=
this.constructor.superclass;this.constructor.superclass=k;var f=c[b].apply(this,arguments);this.constructor.superclass=a;if("initialize"!==b)return f}}(d):a.prototype[d]=c[d],b&&(c.toString!==Object.prototype.toString&&(a.prototype.toString=c.toString),c.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=c.valueOf))};g.util.createClass=function(){function b(){this.initialize.apply(this,arguments)}var h=null,n=d.call(arguments,0);"function"===typeof n[0]&&(h=n.shift());b.superclass=h;b.subclasses=
[];h&&(e.prototype=h.prototype,b.prototype=new e,h.subclasses.push(b));for(var g=0,r=n.length;g<r;g++)k(b,n[g],h);b.prototype.initialize||(b.prototype.initialize=c);b.prototype.constructor=b;b.prototype.callSuper=a;return b}})();(function(){function e(b){var a=Array.prototype.slice.call(arguments,1),f,c,h=a.length;for(c=0;c<h;c++)if(f=typeof b[a[c]],!/^(?:function|object|unknown)$/.test(f))return!1;return!0}function a(a,f){return function(c){f.call(b(a),c||g.window.event)}}function d(b,a){return function(f){if(r[b]&&
r[b][a])for(var c=r[b][a],h=0,k=c.length;h<k;h++)c[h].call(this,f||g.window.event)}}function c(b,a,f){var c="touchend"===b.type?"changedTouches":"touches";return b[c]&&b[c][0]?b[c][0][a]-(b[c][0][a]-b[c][0][f])||b[f]:b[f]}var b,k,f=function(){var b=0;return function(a){return a.__uniqueID||(a.__uniqueID="uniqueID__"+b++)}}();(function(){var a={};b=function(b){return a[b]};k=function(b,f){a[b]=f}})();var h=e(g.document.documentElement,"addEventListener","removeEventListener")&&e(g.window,"addEventListener",
"removeEventListener"),n=e(g.document.documentElement,"attachEvent","detachEvent")&&e(g.window,"attachEvent","detachEvent"),q={},r={};h?(h=function(b,a,f){b.addEventListener(a,f,!1)},n=function(b,a,f){b.removeEventListener(a,f,!1)}):n?(h=function(b,c,h){var d=f(b);k(d,b);q[d]||(q[d]={});q[d][c]||(q[d][c]=[]);h={handler:h,wrappedHandler:a(d,h)};q[d][c].push(h);b.attachEvent("on"+c,h.wrappedHandler)},n=function(b,a,c){var h=f(b),k;if(q[h]&&q[h][a])for(var d=0,e=q[h][a].length;d<e;d++)(k=q[h][a][d])&&
k.handler===c&&(b.detachEvent("on"+a,k.wrappedHandler),q[h][a][d]=null)}):(h=function(b,a,c){var h=f(b);r[h]||(r[h]={});if(!r[h][a]){r[h][a]=[];var k=b["on"+a];k&&r[h][a].push(k);b["on"+a]=d(h,a)}r[h][a].push(c)},n=function(b,a,c){b=f(b);if(r[b]&&r[b][a]){a=r[b][a];b=0;for(var h=a.length;b<h;b++)a[b]===c&&a.splice(b,1)}});g.util.addListener=h;g.util.removeListener=n;var m=function(b){return"unknown"!==typeof b.clientX?b.clientX:0},u=function(b){return"unknown"!==typeof b.clientY?b.clientY:0};g.isTouchSupported&&
(m=function(b){return c(b,"pageX","clientX")},u=function(b){return c(b,"pageY","clientY")});g.util.getPointer=function(b){b||(b=g.window.event);var a=g.util.getScrollLeftTop(b.target||("unknown"!==typeof b.srcElement?b.srcElement:null));return{x:m(b)+a.left,y:u(b)+a.top}};g.util.object.extend(g.util,g.Observable)})();(function(){var e=g.document.createElement("div"),a="string"===typeof e.style.filter,d=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,c=function(b){return b};"string"===typeof e.style.opacity?
c=function(b,a){b.style.opacity=a;return b}:a&&(c=function(b,a){var f=b.style;b.currentStyle&&!b.currentStyle.hasLayout&&(f.zoom=1);d.test(f.filter)?f.filter=f.filter.replace(d,.9999<=a?"":"alpha(opacity="+100*a+")"):f.filter+=" alpha(opacity="+100*a+")";return b});g.util.setStyle=function(b,a){var f=b.style;if(!f)return b;if("string"===typeof a)return b.style.cssText+=";"+a,-1<a.indexOf("opacity")?c(b,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):b;for(var h in a)"opacity"===h?c(b,a[h]):f["float"===h||"cssFloat"===
h?"undefined"===typeof f.styleFloat?"cssFloat":"styleFloat":h]=a[h];return b}})();(function(){function e(b,a){var f=g.document.createElement(b),c;for(c in a)"class"===c?f.className=a[c]:"for"===c?f.htmlFor=a[c]:f.setAttribute(c,a[c]);return f}function a(b){for(var a=0,f=0,c=g.document.documentElement,k=g.document.body||{scrollLeft:0,scrollTop:0};b&&(b.parentNode||b.host)&&(b=b.parentNode||b.host,b===g.document?(a=k.scrollLeft||c.scrollLeft||0,f=k.scrollTop||c.scrollTop||0):(a+=b.scrollLeft||0,f+=
b.scrollTop||0),1!==b.nodeType||"fixed"!==g.util.getElementStyle(b,"position")););return{left:a,top:f}}var d=Array.prototype.slice,c,b=function(b){return d.call(b,0)};try{c=b(g.document.childNodes)instanceof Array}catch(k){}c||(b=function(b){for(var a=Array(b.length),f=b.length;f--;)a[f]=b[f];return a});var f;f=g.document.defaultView&&g.document.defaultView.getComputedStyle?function(b,a){var f=g.document.defaultView.getComputedStyle(b,null);return f?f[a]:v}:function(b,a){var f=b.style[a];!f&&b.currentStyle&&
(f=b.currentStyle[a]);return f};(function(){var b=g.document.documentElement.style,a="userSelect"in b?"userSelect":"MozUserSelect"in b?"MozUserSelect":"WebkitUserSelect"in b?"WebkitUserSelect":"KhtmlUserSelect"in b?"KhtmlUserSelect":"";g.util.makeElementUnselectable=function(b){"undefined"!==typeof b.onselectstart&&(b.onselectstart=g.util.falseFunction);a?b.style[a]="none":"string"===typeof b.unselectable&&(b.unselectable="on");return b};g.util.makeElementSelectable=function(b){"undefined"!==typeof b.onselectstart&&
(b.onselectstart=null);a?b.style[a]="":"string"===typeof b.unselectable&&(b.unselectable="");return b}})();(function(){g.util.getScript=function(b,a){var f=g.document.getElementsByTagName("head")[0],c=g.document.createElement("script"),k=!0;c.onload=c.onreadystatechange=function(b){!k||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(k=!1,a(b||g.window.event),c=c.onload=c.onreadystatechange=null)};c.src=b;f.appendChild(c)}})();g.util.getById=function(b){return"string"===
typeof b?g.document.getElementById(b):b};g.util.toArray=b;g.util.makeElement=e;g.util.addClass=function(b,a){b&&-1===(" "+b.className+" ").indexOf(" "+a+" ")&&(b.className+=(b.className?" ":"")+a)};g.util.wrapElement=function(b,a,f){"string"===typeof a&&(a=e(a,f));b.parentNode&&b.parentNode.replaceChild(a,b);a.appendChild(b);return a};g.util.getScrollLeftTop=a;g.util.getElementOffset=function(b){var c;c=b&&b.ownerDocument;var k={left:0,top:0},d={left:0,top:0},e={borderLeftWidth:"left",borderTopWidth:"top",
paddingLeft:"left",paddingTop:"top"};if(!c)return d;for(var g in e)d[e[g]]+=parseInt(f(b,g),10)||0;c=c.documentElement;"undefined"!==typeof b.getBoundingClientRect&&(k=b.getBoundingClientRect());b=a(b);return{left:k.left+b.left-(c.clientLeft||0)+d.left,top:k.top+b.top-(c.clientTop||0)+d.top}};g.util.getElementStyle=f})();(function(){function e(a,b){return a+(/\?/.test(a)?"&":"?")+b}function a(){}var d=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},
function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=a.length;b--;)try{if(a[b]())return a[b]}catch(k){}}();g.util.request=function(c,b){b||(b={});var k=b.method?b.method.toUpperCase():"GET",f=b.onComplete||function(){},h=d(),n;h.onreadystatechange=function(){4===h.readyState&&(f(h),h.onreadystatechange=a)};"GET"===k&&(n=null,"string"===typeof b.parameters&&(c=e(c,b.parameters)));h.open(k,c,!0);"POST"!==k&&"PUT"!==k||h.setRequestHeader("Content-Type",
"application/x-www-form-urlencoded");h.send(n);return h}})();g.log=function(){};g.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(e){"undefined"!==typeof console[e]&&"function"===typeof console[e].apply&&(g[e]=function(){return console[e].apply(console,arguments)})});(function(){function e(){return a.apply(g.window,arguments)}var a=g.window.requestAnimationFrame||g.window.webkitRequestAnimationFrame||g.window.mozRequestAnimationFrame||g.window.oRequestAnimationFrame||
g.window.msRequestAnimationFrame||function(a){g.window.setTimeout(a,1E3/60)};g.util.animate=function(a){e(function(c){a||(a={});var b=c||+new Date,k=a.duration||500,f=b+k,h,n=a.onChange||function(){},g=a.abort||function(){return!1},r=a.easing||function(b,a,f,c){return-f*Math.cos(b/c*(Math.PI/2))+f+a},m="startValue"in a?a.startValue:0;c="endValue"in a?a.endValue:100;var u=a.byValue||c-m;a.onStart&&a.onStart();(function H(c){h=c||+new Date;c=h>f?k:h-b;g()?a.onComplete&&a.onComplete():(n(r(c,m,u,k)),
h>f?a.onComplete&&a.onComplete():e(H))})(b)})};g.util.requestAnimFrame=e})();(function(){function e(b,a,f,c){b<Math.abs(a)?(b=a,c=f/4):c=f/(2*Math.PI)*Math.asin(a/b);return{a:b,c:a,p:f,s:c}}function a(b,a,f){return b.a*Math.pow(2,10*--a)*Math.sin(2*(a*f-b.s)*Math.PI/b.p)}function d(b,a,f,h){return f-c(h-b,0,f,h)+a}function c(b,a,f,c){return(b/=c)<1/2.75?7.5625*f*b*b+a:b<2/2.75?f*(7.5625*(b-=1.5/2.75)*b+.75)+a:b<2.5/2.75?f*(7.5625*(b-=2.25/2.75)*b+.9375)+a:f*(7.5625*(b-=2.625/2.75)*b+.984375)+a}g.util.ease=
{easeInQuad:function(b,a,f,c){return f*(b/=c)*b+a},easeOutQuad:function(b,a,f,c){return-f*(b/=c)*(b-2)+a},easeInOutQuad:function(b,a,f,c){b/=c/2;return 1>b?f/2*b*b+a:-f/2*(--b*(b-2)-1)+a},easeInCubic:function(b,a,f,c){return f*(b/=c)*b*b+a},easeOutCubic:function(b,a,f,c){return f*((b=b/c-1)*b*b+1)+a},easeInOutCubic:function(b,a,f,c){b/=c/2;return 1>b?f/2*b*b*b+a:f/2*((b-=2)*b*b+2)+a},easeInQuart:function(b,a,f,c){return f*(b/=c)*b*b*b+a},easeOutQuart:function(b,a,f,c){return-f*((b=b/c-1)*b*b*b-1)+
a},easeInOutQuart:function(b,a,f,c){b/=c/2;return 1>b?f/2*b*b*b*b+a:-f/2*((b-=2)*b*b*b-2)+a},easeInQuint:function(b,a,f,c){return f*(b/=c)*b*b*b*b+a},easeOutQuint:function(b,a,f,c){return f*((b=b/c-1)*b*b*b*b+1)+a},easeInOutQuint:function(b,a,f,c){b/=c/2;return 1>b?f/2*b*b*b*b*b+a:f/2*((b-=2)*b*b*b*b+2)+a},easeInSine:function(b,a,f,c){return-f*Math.cos(b/c*(Math.PI/2))+f+a},easeOutSine:function(b,a,f,c){return f*Math.sin(b/c*(Math.PI/2))+a},easeInOutSine:function(b,a,f,c){return-f/2*(Math.cos(Math.PI*
b/c)-1)+a},easeInExpo:function(b,a,f,c){return 0===b?a:f*Math.pow(2,10*(b/c-1))+a},easeOutExpo:function(b,a,f,c){return b===c?a+f:f*(-Math.pow(2,-10*b/c)+1)+a},easeInOutExpo:function(b,a,f,c){if(0===b)return a;if(b===c)return a+f;b/=c/2;return 1>b?f/2*Math.pow(2,10*(b-1))+a:f/2*(-Math.pow(2,-10*--b)+2)+a},easeInCirc:function(b,a,f,c){return-f*(Math.sqrt(1-(b/=c)*b)-1)+a},easeOutCirc:function(b,a,f,c){return f*Math.sqrt(1-(b=b/c-1)*b)+a},easeInOutCirc:function(b,a,f,c){b/=c/2;return 1>b?-f/2*(Math.sqrt(1-
b*b)-1)+a:f/2*(Math.sqrt(1-(b-=2)*b)+1)+a},easeInElastic:function(b,c,f,h){var d=0;if(0===b)return c;b/=h;if(1===b)return c+f;d||(d=.3*h);f=e(f,f,d,1.70158);return-a(f,b,h)+c},easeOutElastic:function(b,a,f,c){var d=0;if(0===b)return a;b/=c;if(1===b)return a+f;d||(d=.3*c);f=e(f,f,d,1.70158);return f.a*Math.pow(2,-10*b)*Math.sin(2*(b*c-f.s)*Math.PI/f.p)+f.c+a},easeInOutElastic:function(b,c,f,h){var d=0;if(0===b)return c;b/=h/2;if(2===b)return c+f;d||(d=.3*h*1.5);f=e(f,f,d,1.70158);return 1>b?-.5*a(f,
b,h)+c:f.a*Math.pow(2,-10*--b)*Math.sin(2*(b*h-f.s)*Math.PI/f.p)*.5+f.c+c},easeInBack:function(b,a,f,c,d){d===v&&(d=1.70158);return f*(b/=c)*b*((d+1)*b-d)+a},easeOutBack:function(b,a,f,c,d){d===v&&(d=1.70158);return f*((b=b/c-1)*b*((d+1)*b+d)+1)+a},easeInOutBack:function(b,a,f,c,d){d===v&&(d=1.70158);b/=c/2;return 1>b?f/2*b*b*(((d*=1.525)+1)*b-d)+a:f/2*((b-=2)*b*(((d*=1.525)+1)*b+d)+2)+a},easeInBounce:d,easeOutBounce:c,easeInOutBounce:function(b,a,f,h){return b<h/2?.5*d(2*b,0,f,h)+a:.5*c(2*b-h,0,
f,h)+.5*f+a}}})();(function(e){function a(b){return b in x?x[b]:b}function d(b,a,f,c){var h="[object Array]"===Object.prototype.toString.call(a),k;"fill"!==b&&"stroke"!==b||"none"!==a?"strokeDashArray"===b?a=a.replace(/,/g," ").split(/\s+/).map(function(b){return parseFloat(b)}):"transformMatrix"===b?a=f&&f.transformMatrix?J(f.transformMatrix,m.parseTransformAttribute(a)):m.parseTransformAttribute(a):"visible"===b?(a="none"===a||"hidden"===a?!1:!0,f&&!1===f.visible&&(a=!1)):"originX"===b?a="start"===
a?"left":"end"===a?"right":"center":k=h?a.map(z):z(a,c):a="";return!h&&isNaN(k)?a:k}function c(b){for(var a in w)if("undefined"!==typeof b[w[a]]){if(!b[a]){if(!m.Object.prototype[a])continue;b[a]=m.Object.prototype[a]}if(0!==b[a].indexOf("url(")){var f=new m.Color(b[a]);b[a]=f.setAlpha(F(f.getAlpha()*b[w[a]],2)).toRgba()}}return b}function b(b,f){var c,h;b.replace(/;\s*$/,"").split(";").forEach(function(b){b=b.split(":");c=a(b[0].trim().toLowerCase());h=d(c,b[1].trim());f[c]=h})}function k(b,a){var c=
{},h;for(h in m.cssRules[a]){var k=b,d=h.split(" "),e=void 0,n=!0;if((e=f(k,d.pop()))&&d.length){for(var n=d,g=void 0,q=!0;k.parentNode&&1===k.parentNode.nodeType&&n.length;)q&&(g=n.pop()),k=k.parentNode,q=f(k,g);n=0===n.length}if(e&&n&&0===d.length)for(var r in m.cssRules[a][h])c[r]=m.cssRules[a][h][r]}return c}function f(b,a){var f=b.nodeName,c=b.getAttribute("class"),h=b.getAttribute("id"),f=new RegExp("^"+f,"i");a=a.replace(f,"");h&&a.length&&(f=new RegExp("#"+h+"(?![a-zA-Z\\-]+)","i"),a=a.replace(f,
""));if(c&&a.length)for(c=c.split(" "),h=c.length;h--;)f=new RegExp("\\."+c[h]+"(?![a-zA-Z\\-]+)","i"),a=a.replace(f,"");return 0===a.length}function h(b){for(var a=b.getElementsByTagName("use"),f=0;a.length&&f<a.length;){var c=a[f],h=c.getAttribute("xlink:href").substr(1),k=c.getAttribute("x")||0,d=c.getAttribute("y")||0,e;a:{e=b;var m=void 0;e.getElementById&&(m=e.getElementById(h));if(m)e=m;else{var g=m=void 0;e=e.getElementsByTagName("*");for(g=0;g<e.length;g++)if(m=e[g],h===m.getAttribute("id")){e=
m;break a}e=void 0}}e=e.cloneNode(!0);var k=(e.getAttribute("transform")||"")+" translate("+k+", "+d+")",d=a.length,q;n(e);if(/^svg$/i.test(e.nodeName)){var r=e.ownerDocument.createElement("g"),m=0,g=e.attributes;for(q=g.length;m<q;m++)h=g.item(m),r.setAttribute(h.nodeName,h.nodeValue);for(;null!=e.firstChild;)r.appendChild(e.firstChild);e=r}m=0;g=c.attributes;for(q=g.length;m<q;m++)h=g.item(m),"x"!==h.nodeName&&"y"!==h.nodeName&&"xlink:href"!==h.nodeName&&("transform"===h.nodeName?k=h.nodeValue+
" "+k:e.setAttribute(h.nodeName,h.nodeValue));e.setAttribute("transform",k);e.setAttribute("instantiated_by_use","1");e.removeAttribute("id");c.parentNode.replaceChild(e,c);a.length===d&&f++}}function n(b){var a=b.getAttribute("viewBox"),f=1,c=1,h=0,k=0,d,e=b.getAttribute("width"),n=b.getAttribute("height"),g=b.getAttribute("x")||0,q=b.getAttribute("y")||0,r=b.getAttribute("preserveAspectRatio")||"",h=!a||!D.test(b.tagName)||!(a=a.match(p)),t=!e||!n||"100%"===e||"100%"===n,k=h&&t,u={},F="";u.width=
0;u.height=0;if(u.toBeParsed=k)return u;if(h)return u.width=z(e),u.height=z(n),u;h=-parseFloat(a[1]);k=-parseFloat(a[2]);d=parseFloat(a[3]);a=parseFloat(a[4]);t?(u.width=d,u.height=a):(u.width=z(e),u.height=z(n),f=u.width/d,c=u.height/a);r=m.util.parsePreserveAspectRatioAttribute(r);"none"!==r.alignX&&(c=f=f>c?c:f);if(1===f&&1===c&&0===h&&0===k&&0===g&&0===q)return u;if(g||q)F=" translate("+z(g)+" "+z(q)+") ";f=F+" matrix("+f+" 0 0 "+c+" "+h*f+" "+k*c+") ";if("svg"===b.tagName){for(c=b.ownerDocument.createElement("g");null!=
b.firstChild;)c.appendChild(b.firstChild);b.appendChild(c)}else c=b,f=c.getAttribute("transform")+f;c.setAttribute("transform",f);return u}function g(b){var a=b.objects;b=b.options;a=a.map(function(b){return m[t(b.type)].fromObject(b)});return{objects:a,options:b}}function r(b,a,f){a[f]&&a[f].toSVG&&b.push('\t<pattern x="0" y="0" id="',f,'Pattern" ','width="',a[f].source.width,'" height="',a[f].source.height,'" patternUnits="userSpaceOnUse">\n','\t\t<image x="0" y="0" ','width="',a[f].source.width,
'" height="',a[f].source.height,'" xlink:href="',a[f].source.src,'"></image>\n\t</pattern>\n')}var m=e.fabric||(e.fabric={}),u=m.util.object.extend,t=m.util.string.capitalize,H=m.util.object.clone,F=m.util.toFixed,z=m.util.parseUnit,J=m.util.multiplyTransformMatrices,l=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,D=/^(symbol|image|marker|pattern|view|svg)$/i,y=/^(?:pattern|defs|symbol|metadata)$/i,B=/^(symbol|g|a|svg)$/i,x={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",
visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},w={stroke:"strokeOpacity",fill:"fillOpacity"};
m.cssRules={};m.gradientDefs={};m.parseTransformAttribute=function(){function b(a,f){var c=f[0],h=3===f.length?f[1]:0,k=3===f.length?f[2]:0;a[0]=Math.cos(c);a[1]=Math.sin(c);a[2]=-Math.sin(c);a[3]=Math.cos(c);a[4]=h-(a[0]*h+a[2]*k);a[5]=k-(a[1]*h+a[3]*k)}function a(b,f){var c=2===f.length?f[1]:f[0];b[0]=f[0];b[3]=c}function f(b,a){b[4]=a[0];2===a.length&&(b[5]=a[1])}var c=[1,0,0,1,0,0],h=m.reNum,k="(?:"+("(?:(matrix)\\s*\\(\\s*("+h+")(?:\\s+,?\\s*|,\\s*)("+h+")(?:\\s+,?\\s*|,\\s*)("+h+")(?:\\s+,?\\s*|,\\s*)("+
h+")(?:\\s+,?\\s*|,\\s*)("+h+")(?:\\s+,?\\s*|,\\s*)("+h+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+h+")(?:(?:\\s+,?\\s*|,\\s*)("+h+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+h+")(?:(?:\\s+,?\\s*|,\\s*)("+h+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+h+")(?:(?:\\s+,?\\s*|,\\s*)("+h+")(?:\\s+,?\\s*|,\\s*)("+h+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+h+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+h+")\\s*\\))")+")",d=new RegExp("^\\s*(?:"+("(?:"+k+"(?:(?:\\s+,?\\s*|,\\s*)*"+k+")*)")+"?)\\s*$"),
e=new RegExp(k,"g");return function(h){var n=c.concat(),g=[];if(!h||h&&!d.test(h))return n;h.replace(e,function(h){var d=(new RegExp(k)).exec(h).filter(function(b){return""!==b&&null!=b});h=d[1];d=d.slice(2).map(parseFloat);switch(h){case "translate":f(n,d);break;case "rotate":d[0]=m.util.degreesToRadians(d[0]);b(n,d);break;case "scale":a(n,d);break;case "skewX":n[2]=Math.tan(m.util.degreesToRadians(d[0]));break;case "skewY":n[1]=Math.tan(m.util.degreesToRadians(d[0]));break;case "matrix":n=d}g.push(n.concat());
n=c.concat()});for(h=g[0];1<g.length;)g.shift(),h=m.util.multiplyTransformMatrices(h,g[0]);return h}}();var p=new RegExp("^\\s*("+m.reNum+"+)\\s*,?\\s*("+m.reNum+"+)\\s*,?\\s*("+m.reNum+"+)\\s*,?\\s*("+m.reNum+"+)\\s*$");m.parseSVGDocument=function(){return function(b,a,f){if(b){h(b);var c=new Date,k=m.Object.__uid++,d=n(b),e=m.util.toArray(b.getElementsByTagName("*"));d.svgUid=k;if(0===e.length&&m.isLikelyNode){for(var e=b.selectNodes('//*[name(.)!="svg"]'),g=[],q=0,r=e.length;q<r;q++)g[q]=e[q];
e=g}e=e.filter(function(b){n(b);var a;if(a=l.test(b.tagName)){a:{for(;b&&(b=b.parentNode);)if(y.test(b.nodeName)&&!b.getAttribute("instantiated_by_use")){b=!0;break a}b=!1}a=!b}return a});!e||e&&!e.length?a&&a([],{}):(m.gradientDefs[k]=m.getGradientDefs(b),m.cssRules[k]=m.getCSSRules(b),m.parseElements(e,function(b){m.documentParsingTime=new Date-c;a&&a(b,d)},H(d),f))}}}();var K={has:function(b,a){a(!1)},get:function(){},set:function(){}},E=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+
m.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+m.reNum+"))?\\s+(.*)");u(m,{parseFontDeclaration:function(b,a){var f=b.match(E);if(f){var c=f[1],h=f[3],k=f[4],d=f[5],f=f[6];c&&(a.fontStyle=c);h&&(a.fontWeight=isNaN(parseFloat(h))?h:parseFloat(h));k&&(a.fontSize=z(k));f&&(a.fontFamily=f);d&&(a.lineHeight="normal"===d?1:d)}},getGradientDefs:function(b){var a=b.getElementsByTagName("linearGradient"),f=b.getElementsByTagName("radialGradient"),c,h=0,k,d=[];b={};var e={};d.length=a.length+f.length;for(c=
a.length;c--;)d[h++]=a[c];for(c=f.length;c--;)d[h++]=f[c];for(;h--;)a=d[h],f=a.getAttribute("xlink:href"),k=a.getAttribute("id"),f&&(e[k]=f.substr(1)),b[k]=a;for(k in e)for(h=b[e[k]].cloneNode(!0),a=b[k];h.firstChild;)a.appendChild(h.firstChild);return b},parseAttributes:function(b,f,h){if(b){var e,n={},g;"undefined"===typeof h&&(h=b.getAttribute("svgUid"));b.parentNode&&B.test(b.parentNode.nodeName)&&(n=m.parseAttributes(b.parentNode,f,h));g=n&&n.fontSize||b.getAttribute("font-size")||m.Text.DEFAULT_SVG_FONT_SIZE;
f=f.reduce(function(f,c){if(e=b.getAttribute(c))c=a(c),e=d(c,e,n,g),f[c]=e;return f},{});f=u(f,u(k(b,h),m.parseStyleAttribute(b)));f.font&&m.parseFontDeclaration(f.font,f);return c(u(n,f))}},parseElements:function(b,a,f,c){(new m.ElementsParser(b,a,f,c)).parse()},parseStyleAttribute:function(f){var c={};f=f.getAttribute("style");if(!f)return c;if("string"===typeof f)b(f,c);else{var h,k,e;for(e in f)"undefined"!==typeof f[e]&&(h=a(e.toLowerCase()),k=d(h,f[e]),c[h]=k)}return c},parsePointsAttribute:function(b){if(!b)return null;
b=b.replace(/,/g," ").trim();b=b.split(/\s+/);var a=[],f,c;f=0;for(c=b.length;f<c;f+=2)a.push({x:parseFloat(b[f]),y:parseFloat(b[f+1])});return a},getCSSRules:function(b){b=b.getElementsByTagName("style");for(var f={},c,h=0,k=b.length;h<k;h++)c=b[h].textContent||b[h].text,c=c.replace(/\/\*[\s\S]*?\*\//g,""),""!==c.trim()&&(c=c.match(/[^{]*\{[\s\S]*?\}/g),c=c.map(function(b){return b.trim()}),c.forEach(function(b){b=b.match(/([\s\S]*?)\s*\{([^}]*)\}/);for(var c={},h=b[2].trim().replace(/;$/,"").split(/\s*;\s*/),
k=0,e=h.length;k<e;k++){var n=h[k].split(/\s*:\s*/),g=a(n[0]),n=d(g,n[1],n[0]);c[g]=n}b=b[1];b.split(",").forEach(function(b){b=b.replace(/^svg/i,"").trim();""!==b&&(f[b]=m.util.object.clone(c))})}));return f},loadSVGFromURL:function(b,a,f){function c(h){var k=h.responseXML;k&&!k.documentElement&&m.window.ActiveXObject&&h.responseText&&(k=new ActiveXObject("Microsoft.XMLDOM"),k.async="false",k.loadXML(h.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));k&&k.documentElement&&m.parseSVGDocument(k.documentElement,
function(f,c){K.set(b,{objects:m.util.array.invoke(f,"toObject"),options:c});a(f,c)},f)}b=b.replace(/^\n\s*/,"").trim();K.has(b,function(f){f?K.get(b,function(b){b=g(b);a(b.objects,b.options)}):new m.util.request(b,{method:"get",onComplete:c})})},loadSVGFromString:function(b,a,f){b=b.trim();var c;if("undefined"!==typeof DOMParser){var h=new DOMParser;h&&h.parseFromString&&(c=h.parseFromString(b,"text/xml"))}else m.window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,
"")));m.parseSVGDocument(c.documentElement,function(b,f){a(b,f)},f)},createSVGFontFacesMarkup:function(b){for(var a="",f={},c,h,k,d,e=m.fontPaths,n=0,g=b.length;n<g;n++)if(c=b[n],h=c.fontFamily,-1!==c.type.indexOf("text")&&!f[h]&&e[h]&&(f[h]=!0,c.styles))for(k in c=c.styles,c)for(d in void 0)c=(void 0)[d],h=c.fontFamily,!f[h]&&e[h]&&(f[h]=!0);for(var q in f)a+=["\t\t@font-face {\n\t\t\tfont-family: '",q,"';\n\t\t\tsrc: url('",e[q],"');\n\t\t}\n"].join("");a&&(a=['\t<style type="text/css"><![CDATA[\n',
a,"]]\x3e</style>\n"].join(""));return a},createSVGRefElementsMarkup:function(b){var a=[];r(a,b,"backgroundColor");r(a,b,"overlayColor");return a.join("")}})})("undefined"!==typeof p?p:this);g.ElementsParser=function(e,a,d,c){this.elements=e;this.callback=a;this.options=d;this.reviver=c;this.svgUid=d&&d.svgUid||0};g.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};g.ElementsParser.prototype.createObjects=
function(){for(var e=0,a=this.elements.length;e<a;e++)this.elements[e].setAttribute("svgUid",this.svgUid),function(a,c){setTimeout(function(){a.createObject(a.elements[c],c)},0)}(this,e)};g.ElementsParser.prototype.createObject=function(e,a){var d=g[g.util.string.capitalize(e.tagName)];if(d&&d.fromElement)try{this._createObject(d,e,a)}catch(c){g.log(c)}else this.checkIfDone()};g.ElementsParser.prototype._createObject=function(e,a,d){e.async?e.fromElement(a,this.createCallback(d,a),this.options):(e=
e.fromElement(a,this.options),this.resolveGradient(e,"fill"),this.resolveGradient(e,"stroke"),this.reviver&&this.reviver(a,e),this.instances[d]=e,this.checkIfDone())};g.ElementsParser.prototype.createCallback=function(e,a){var d=this;return function(c){d.resolveGradient(c,"fill");d.resolveGradient(c,"stroke");d.reviver&&d.reviver(a,c);d.instances[e]=c;d.checkIfDone()}};g.ElementsParser.prototype.resolveGradient=function(e,a){var d=e.get(a);/^url\(/.test(d)&&(d=d.slice(5,d.length-1),g.gradientDefs[this.svgUid][d]&&
e.set(a,g.Gradient.fromElement(g.gradientDefs[this.svgUid][d],e)))};g.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(e){return null!=e}),this.callback(this.instances))};(function(e){function a(a,c){this.x=a;this.y=c}e=e.fabric||(e.fabric={});e.Point?e.warn("fabric.Point is already defined"):(e.Point=a,a.prototype={constructor:a,add:function(d){return new a(this.x+d.x,this.y+d.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;
return this},scalarAdd:function(d){return new a(this.x+d,this.y+d)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(d){return new a(this.x-d.x,this.y-d.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},scalarSubtract:function(d){return new a(this.x-d,this.y-d)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(d){return new a(this.x*d,this.y*d)},multiplyEquals:function(a){this.x*=a;this.y*=a;return this},divide:function(d){return new a(this.x/
d,this.y/d)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(d,c){return new a(this.x+(d.x-this.x)*c,this.y+(d.y-this.y)*c)},distanceFrom:function(a){var c=this.x-a.x;a=this.y-a.y;return Math.sqrt(c*c+a*a)},midPointFrom:function(d){return new a(this.x+
(d.x-this.x)/2,this.y+(d.y-this.y)/2)},min:function(d){return new a(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new a(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(a,c){this.x=a;this.y=c},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(a){var c=this.x,b=this.y;this.x=a.x;this.y=a.y;a.x=c;a.y=b}})})("undefined"!==typeof p?p:this);(function(e){function a(a){this.status=a;this.points=[]}var d=e.fabric||(e.fabric=
{});d.Intersection?d.warn("fabric.Intersection is already defined"):(d.Intersection=a,d.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},d.Intersection.intersectLineLine=function(c,b,k,f){var h,e=(f.x-k.x)*(c.y-k.y)-(f.y-k.y)*(c.x-k.x);h=(b.x-c.x)*(c.y-k.y)-(b.y-c.y)*(c.x-k.x);k=(f.y-k.y)*(b.x-c.x)-(f.x-k.x)*(b.y-c.y);0!==k?(e/=k,h/=k,0<=e&&1>=e&&0<=h&&1>=h?(h=new a("Intersection"),h.points.push(new d.Point(c.x+e*(b.x-
c.x),c.y+e*(b.y-c.y)))):h=new a):h=0===e||0===h?new a("Coincident"):new a("Parallel");return h},d.Intersection.intersectLinePolygon=function(c,b,k){for(var f=new a,h=k.length,d=0;d<h;d++){var e=a.intersectLineLine(c,b,k[d],k[(d+1)%h]);f.appendPoints(e.points)}0<f.points.length&&(f.status="Intersection");return f},d.Intersection.intersectPolygonPolygon=function(c,b){for(var k=new a,f=c.length,h=0;h<f;h++){var d=a.intersectLinePolygon(c[h],c[(h+1)%f],b);k.appendPoints(d.points)}0<k.points.length&&(k.status=
"Intersection");return k},d.Intersection.intersectPolygonRectangle=function(c,b,k){var f=b.min(k),h=b.max(k);k=new d.Point(h.x,f.y);var e=new d.Point(f.x,h.y);b=a.intersectLinePolygon(f,k,c);k=a.intersectLinePolygon(k,h,c);h=a.intersectLinePolygon(h,e,c);c=a.intersectLinePolygon(e,f,c);f=new a;f.appendPoints(b.points);f.appendPoints(k.points);f.appendPoints(h.points);f.appendPoints(c.points);0<f.points.length&&(f.status="Intersection");return f})})("undefined"!==typeof p?p:this);(function(e){function a(b){b?
this._tryParsingColor(b):this.setSource([0,0,0,1])}function d(b,a,f){0>f&&(f+=1);1<f&&--f;return f<1/6?b+6*(a-b)*f:.5>f?a:f<2/3?b+(a-b)*(2/3-f)*6:b}var c=e.fabric||(e.fabric={});c.Color?c.warn("fabric.Color is already defined."):(c.Color=a,c.Color.prototype={_tryParsingColor:function(b){var c;b in a.colorNameMap&&(b=a.colorNameMap[b]);"transparent"===b?this.setSource([255,255,255,0]):((c=a.sourceFromHex(b))||(c=a.sourceFromRgb(b)),c||(c=a.sourceFromHsl(b)),c&&this.setSource(c))},_rgbToHsl:function(b,
a,f){b/=255;a/=255;f/=255;var h,d,e,g=c.util.array.max([b,a,f]);d=c.util.array.min([b,a,f]);e=(g+d)/2;if(g===d)h=d=0;else{var m=g-d;d=.5<e?m/(2-g-d):m/(g+d);switch(g){case b:h=(a-f)/m+(a<f?6:0);break;case a:h=(f-b)/m+2;break;case f:h=(b-a)/m+4}h/=6}return[Math.round(360*h),Math.round(100*d),Math.round(100*e)]},getSource:function(){return this._source},setSource:function(b){this._source=b},toRgb:function(){var b=this.getSource();return"rgb("+b[0]+","+b[1]+","+b[2]+")"},toRgba:function(){var b=this.getSource();
return"rgba("+b[0]+","+b[1]+","+b[2]+","+b[3]+")"},toHsl:function(){var b=this.getSource(),b=this._rgbToHsl(b[0],b[1],b[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var b=this.getSource(),a=this._rgbToHsl(b[0],b[1],b[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+b[3]+")"},toHex:function(){var b=this.getSource(),a,f;a=b[0].toString(16);a=1===a.length?"0"+a:a;f=b[1].toString(16);f=1===f.length?"0"+f:f;b=b[2].toString(16);b=1===b.length?"0"+b:b;return a.toUpperCase()+f.toUpperCase()+
b.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(b){var a=this.getSource();a[3]=b;this.setSource(a);return this},toGrayscale:function(){var b=this.getSource(),a=parseInt((.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),10);this.setSource([a,a,a,b[3]]);return this},toBlackWhite:function(b){var a=this.getSource(),f=(.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),a=a[3],f=Number(f)<Number(b||127)?0:255;this.setSource([f,f,f,a]);return this},overlayWith:function(b){b instanceof a||(b=new a(b));
var c=[],f=this.getAlpha(),h=this.getSource();b=b.getSource();for(var d=0;3>d;d++)c.push(Math.round(.5*h[d]+.5*b[d]));c[3]=f;this.setSource(c);return this}},c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",
blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},c.Color.fromRgb=function(b){return a.fromSource(a.sourceFromRgb(b))},c.Color.sourceFromRgb=function(b){if(b=b.match(a.reRGBa)){var c=parseInt(b[1],10)/(/%$/.test(b[1])?100:1)*(/%$/.test(b[1])?255:1),f=parseInt(b[2],10)/(/%$/.test(b[2])?100:1)*(/%$/.test(b[2])?
255:1),h=parseInt(b[3],10)/(/%$/.test(b[3])?100:1)*(/%$/.test(b[3])?255:1);return[parseInt(c,10),parseInt(f,10),parseInt(h,10),b[4]?parseFloat(b[4]):1]}},c.Color.fromRgba=a.fromRgb,c.Color.fromHsl=function(b){return a.fromSource(a.sourceFromHsl(b))},c.Color.sourceFromHsl=function(b){if(b=b.match(a.reHSLa)){var c=(parseFloat(b[1])%360+360)%360/360,f=parseFloat(b[2])/(/%$/.test(b[2])?100:1),h=parseFloat(b[3])/(/%$/.test(b[3])?100:1);if(0===f)h=f=c=h;else var e=.5>=h?h*(f+1):h+f-h*f,g=2*h-e,h=d(g,e,
c+1/3),f=d(g,e,c),c=d(g,e,c-1/3);return[Math.round(255*h),Math.round(255*f),Math.round(255*c),b[4]?parseFloat(b[4]):1]}},c.Color.fromHsla=a.fromHsl,c.Color.fromHex=function(b){return a.fromSource(a.sourceFromHex(b))},c.Color.sourceFromHex=function(b){if(b.match(a.reHex)){var c=b.slice(b.indexOf("#")+1),f=3===c.length;b=f?c.charAt(0)+c.charAt(0):c.substring(0,2);var h=f?c.charAt(1)+c.charAt(1):c.substring(2,4),c=f?c.charAt(2)+c.charAt(2):c.substring(4,6);return[parseInt(b,16),parseInt(h,16),parseInt(c,
16),1]}},c.Color.fromSource=function(b){var c=new a;c.setSource(b);return c})})("undefined"!==typeof p?p:this);(function(){function e(a){var c=a.getAttribute("style"),b=a.getAttribute("offset")||0,k,f,b=parseFloat(b)/(/%$/.test(b)?100:1),b=0>b?0:1<b?1:b;if(c){c=c.split(/\s*;\s*/);""===c[c.length-1]&&c.pop();for(var h=c.length;h--;){var e=c[h].split(/\s*:\s*/),q=e[0].trim(),e=e[1].trim();"stop-color"===q?k=e:"stop-opacity"===q&&(f=e)}}k||(k=a.getAttribute("stop-color")||"rgb(0,0,0)");f||(f=a.getAttribute("stop-opacity"));
k=new g.Color(k);a=k.getAlpha();f=isNaN(parseFloat(f))?1:parseFloat(f);f*=a;return{offset:b,color:k.toRgb(),opacity:f}}function a(a,c,b){var k,f=0,h=1,e="",g;for(g in c){k=parseFloat(c[g],10);h="string"===typeof c[g]&&/^\d+%$/.test(c[g])?.01:1;if("x1"===g||"x2"===g||"r2"===g)h*="objectBoundingBox"===b?a.width:1,f="objectBoundingBox"===b?a.left||0:0;else if("y1"===g||"y2"===g)h*="objectBoundingBox"===b?a.height:1,f="objectBoundingBox"===b?a.top||0:0;c[g]=k*h+f}"ellipse"===a.type&&null!==c.r2&&"objectBoundingBox"===
b&&a.rx!==a.ry&&(a=a.ry/a.rx,e=" scale(1, "+a+")",c.y1&&(c.y1/=a),c.y2&&(c.y2/=a));return e}g.Gradient=g.util.createClass({offsetX:0,offsetY:0,initialize:function(a){a||(a={});var c={};this.id=g.Object.__uid++;this.type=a.type||"linear";c={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0};"radial"===this.type&&(c.r1=a.coords.r1||0,c.r2=a.coords.r2||0);this.coords=c;this.colorStops=a.colorStops.slice();a.gradientTransform&&(this.gradientTransform=a.gradientTransform);this.offsetX=
a.offsetX||this.offsetX;this.offsetY=a.offsetY||this.offsetY},addColorStop:function(a){for(var c in a){var b=new g.Color(a[c]);this.colorStops.push({offset:c,color:b.toRgb(),opacity:b.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform}},toSVG:function(a){var c=g.util.object.clone(this.coords),b;this.colorStops.sort(function(b,
a){return b.offset-a.offset});if(!a.group||"path-group"!==a.group.type)for(var k in c)if("x1"===k||"x2"===k||"r2"===k)c[k]+=this.offsetX-a.width/2;else if("y1"===k||"y2"===k)c[k]+=this.offsetY-a.height/2;a='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';this.gradientTransform&&(a+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" ');"linear"===this.type?b=["<linearGradient ",a,' x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'">\n']:"radial"===this.type&&(b=["<radialGradient ",
a,' cx="',c.x2,'" cy="',c.y2,'" r="',c.r2,'" fx="',c.x1,'" fy="',c.y1,'">\n']);for(c=0;c<this.colorStops.length;c++)b.push("<stop ",'offset="',100*this.colorStops[c].offset+"%",'" style="stop-color:',this.colorStops[c].color,null!=this.colorStops[c].opacity?";stop-opacity: "+this.colorStops[c].opacity:";",'"/>\n');b.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n");return b.join("")},toLive:function(a,c){var b,k,f=g.util.object.clone(this.coords);if(this.type){if(c.group&&"path-group"===
c.group.type)for(k in f)if("x1"===k||"x2"===k)f[k]+=-this.offsetX+c.width/2;else if("y1"===k||"y2"===k)f[k]+=-this.offsetY+c.height/2;"linear"===this.type?b=a.createLinearGradient(f.x1,f.y1,f.x2,f.y2):"radial"===this.type&&(b=a.createRadialGradient(f.x1,f.y1,f.r1,f.x2,f.y2,f.r2));k=0;for(f=this.colorStops.length;k<f;k++){var h=this.colorStops[k].color,e=this.colorStops[k].opacity,q=this.colorStops[k].offset;"undefined"!==typeof e&&(h=(new g.Color(h)).setAlpha(e).toRgba());b.addColorStop(parseFloat(q),
h)}return b}}});g.util.object.extend(g.Gradient,{fromElement:function(d,c){var b=d.getElementsByTagName("stop"),k="linearGradient"===d.nodeName?"linear":"radial",f=d.getAttribute("gradientUnits")||"objectBoundingBox",h=d.getAttribute("gradientTransform"),n=[],q={};"linear"===k?q={x1:d.getAttribute("x1")||0,y1:d.getAttribute("y1")||0,x2:d.getAttribute("x2")||"100%",y2:d.getAttribute("y2")||0}:"radial"===k&&(q={x1:d.getAttribute("fx")||d.getAttribute("cx")||"50%",y1:d.getAttribute("fy")||d.getAttribute("cy")||
"50%",r1:0,x2:d.getAttribute("cx")||"50%",y2:d.getAttribute("cy")||"50%",r2:d.getAttribute("r")||"50%"});for(var r=b.length;r--;)n.push(e(b[r]));b=a(c,q,f);k=new g.Gradient({type:k,coords:q,colorStops:n,offsetX:-c.left,offsetY:-c.top});if(h||""!==b)k.gradientTransform=g.parseTransformAttribute((h||"")+b);return k},forObject:function(d,c){c||(c={});a(d,c.coords,"userSpaceOnUse");return new g.Gradient(c)}})})();g.Pattern=g.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(e){e||
(e={});this.id=g.Object.__uid++;if(e.source)if("string"===typeof e.source)if("undefined"!==typeof g.util.getFunctionBody(e.source))this.source=new Function(g.util.getFunctionBody(e.source));else{var a=this;this.source=g.util.createImage();g.util.loadImage(e.source,function(d){a.source=d})}else this.source=e.source;e.repeat&&(this.repeat=e.repeat);e.offsetX&&(this.offsetX=e.offsetX);e.offsetY&&(this.offsetY=e.offsetY)},toObject:function(){var e;"function"===typeof this.source?e=String(this.source):
"string"===typeof this.source.src?e=this.source.src:"object"===typeof this.source&&this.source.toDataURL&&(e=this.source.toDataURL());return{source:e,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(e){var a="function"===typeof this.source?this.source():this.source,d=a.width/e.getWidth(),c=a.height/e.getHeight(),b=this.offsetX/e.getWidth();e=this.offsetY/e.getHeight();var k="";if("repeat-x"===this.repeat||"no-repeat"===this.repeat)c=1;if("repeat-y"===this.repeat||"no-repeat"===
this.repeat)d=1;a.src?k=a.src:a.toDataURL&&(k=a.toDataURL());return'<pattern id="SVGID_'+this.id+'" x="'+b+'" y="'+e+'" width="'+d+'" height="'+c+'">\n<image x="0" y="0" width="'+a.width+'" height="'+a.height+'" xlink:href="'+k+'"></image>\n</pattern>\n'},toLive:function(e){var a="function"===typeof this.source?this.source():this.source;return a&&("undefined"===typeof a.src||a.complete&&0!==a.naturalWidth&&0!==a.naturalHeight)?e.createPattern(a,this.repeat):""}});(function(e){var a=e.fabric||(e.fabric=
{}),d=a.util.toFixed;a.Shadow?a.warn("fabric.Shadow is already defined."):(a.Shadow=a.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(c){"string"===typeof c&&(c=this._parseShadow(c));for(var b in c)this[b]=c[b];this.id=a.Object.__uid++},_parseShadow:function(c){c=c.trim();var b=a.Shadow.reOffsetsAndBlur.exec(c)||[];return{color:(c.replace(a.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(b[1],10)||0,offsetY:parseInt(b[2],
10)||0,blur:parseInt(b[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(c){var b=40,k=40,f=a.Object.NUM_FRACTION_DIGITS,h=a.util.rotateVector({x:this.offsetX,y:this.offsetY},a.util.degreesToRadians(-c.angle));c.width&&c.height&&(b=100*d((Math.abs(h.x)+this.blur)/c.width,f)+20,k=100*d((Math.abs(h.y)+this.blur)/c.height,f)+20);c.flipX&&(h.x*=-1);c.flipY&&(h.y*=-1);return'<filter id="SVGID_'+this.id+'" y="-'+k+'%" height="'+(100+2*k)+
'%" x="-'+b+'%" width="'+(100+2*b)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+d(this.blur?this.blur/2:0,f)+'"></feGaussianBlur>\n\t<feOffset dx="'+d(h.x,f)+'" dy="'+d(h.y,f)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,
blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var c={},b=a.Shadow.prototype;["color","blur","offsetX","offsetY","affectStroke"].forEach(function(a){this[a]!==b[a]&&(c[a]=this[a])},this);return c}}),a.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})("undefined"!==typeof p?p:this);(function(){if(g.StaticCanvas)g.warn("fabric.StaticCanvas is already defined.");else{var e=g.util.object.extend,
a=g.util.getElementOffset,d=g.util.removeFromArray,c=g.util.toFixed,b=Error("Could not initialize `canvas` element");g.StaticCanvas=g.util.createClass({initialize:function(b,a){a||(a={});this._initStatic(b,a)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},
enableRetinaScaling:!0,_initStatic:function(b,a){this._objects=[];this._createLowerCanvas(b);this._initOptions(a);this._setImageSmoothing();this.interactive||this._initRetinaScaling();a.overlayImage&&this.setOverlayImage(a.overlayImage,this.renderAll.bind(this));a.backgroundImage&&this.setBackgroundImage(a.backgroundImage,this.renderAll.bind(this));a.backgroundColor&&this.setBackgroundColor(a.backgroundColor,this.renderAll.bind(this));a.overlayColor&&this.setOverlayColor(a.overlayColor,this.renderAll.bind(this));
this.calcOffset()},_isRetinaScaling:function(){return 1!==g.devicePixelRatio&&this.enableRetinaScaling},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*g.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*g.devicePixelRatio),this.contextContainer.scale(g.devicePixelRatio,g.devicePixelRatio))},calcOffset:function(){this._offset=a(this.lowerCanvasEl);return this},setOverlayImage:function(b,a,c){return this.__setBgOverlayImage("overlayImage",
b,a,c)},setBackgroundImage:function(b,a,c){return this.__setBgOverlayImage("backgroundImage",b,a,c)},setOverlayColor:function(b,a){return this.__setBgOverlayColor("overlayColor",b,a)},setBackgroundColor:function(b,a){return this.__setBgOverlayColor("backgroundColor",b,a)},_setImageSmoothing:function(){var b=this.getContext();"undefined"!==typeof b.imageSmoothingEnabled?b.imageSmoothingEnabled=this.imageSmoothingEnabled:(b.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,b.mozImageSmoothingEnabled=
this.imageSmoothingEnabled,b.msImageSmoothingEnabled=this.imageSmoothingEnabled,b.oImageSmoothingEnabled=this.imageSmoothingEnabled)},__setBgOverlayImage:function(b,a,c,d){"string"===typeof a?g.util.loadImage(a,function(a){this[b]=new g.Image(a,d);c&&c(a)},this,d&&d.crossOrigin):(d&&a.setOptions(d),this[b]=a,c&&c(a));return this},__setBgOverlayColor:function(b,a,c){if(a&&a.source){var d=this;g.util.loadImage(a.source,function(e){d[b]=new g.Pattern({source:e,repeat:a.repeat,offsetX:a.offsetX,offsetY:a.offsetY});
c&&c()})}else this[b]=a,c&&c();return this},_createCanvasElement:function(){var a=g.document.createElement("canvas");a.style||(a.style={});if(!a)throw b;this._initCanvasElement(a);return a},_initCanvasElement:function(a){g.util.createCanvasElement(a);if("undefined"===typeof a.getContext)throw b;},_initOptions:function(b){for(var a in b)this[a]=b[a];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&
(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(b){this.lowerCanvasEl=g.util.getById(b)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);g.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=
this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(b,a){return this.setDimensions({width:b},a)},setHeight:function(b,a){return this.setDimensions({height:b},a)},setDimensions:function(b,a){var c;a=a||{};for(var d in b)c=b[d],a.cssOnly||(this._setBackstoreDimension(d,b[d]),c+="px"),a.backstoreOnly||this._setCssDimension(d,c);this._initRetinaScaling();this._setImageSmoothing();this.calcOffset();a.cssOnly||this.renderAll();
return this},_setBackstoreDimension:function(b,a){this.lowerCanvasEl[b]=a;this.upperCanvasEl&&(this.upperCanvasEl[b]=a);this.cacheCanvasEl&&(this.cacheCanvasEl[b]=a);this[b]=a;return this},_setCssDimension:function(b,a){this.lowerCanvasEl.style[b]=a;this.upperCanvasEl&&(this.upperCanvasEl.style[b]=a);this.wrapperEl&&(this.wrapperEl.style[b]=a);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(b){var a=this.getActiveGroup();
this.viewportTransform=b;this.renderAll();b=0;for(var c=this._objects.length;b<c;b++)this._objects[b].setCoords();a&&a.setCoords();return this},zoomToPoint:function(b,a){var c=b;b=g.util.transformPoint(b,g.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=a;this.viewportTransform[3]=a;var d=g.util.transformPoint(b,this.viewportTransform);this.viewportTransform[4]+=c.x-d.x;this.viewportTransform[5]+=c.y-d.y;this.renderAll();c=0;for(d=this._objects.length;c<d;c++)this._objects[c].setCoords();
return this},setZoom:function(b){this.zoomToPoint(new g.Point(0,0),b);return this},absolutePan:function(b){this.viewportTransform[4]=-b.x;this.viewportTransform[5]=-b.y;this.renderAll();b=0;for(var a=this._objects.length;b<a;b++)this._objects[b].setCoords();return this},relativePan:function(b){return this.absolutePan(new g.Point(-b.x-this.viewportTransform[4],-b.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},
_onObjectAdded:function(b){this.stateful&&b.setupState();b._set("canvas",this);b.setCoords();this.fire("object:added",{target:b});b.fire("added")},_onObjectRemoved:function(b){this.getActiveObject()===b&&(this.fire("before:selection:cleared",{target:b}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:b});b.fire("removed")},clearContext:function(b){b.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},
clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},_chooseObjectsToRender:function(){var b=this.getActiveGroup(),a,c=[],d=[];if(b&&!this.preserveObjectStacking){for(var e=0,g=this._objects.length;e<g;e++)a=this._objects[e],b.contains(a)?d.push(a):c.push(a);
b._set("_objects",d)}else c=this._objects;return c},renderAll:function(){var b=this.contextContainer,a;this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);this.clearContext(b);this.fire("before:render");this.clipTo&&g.util.clipContext(this,b);this._renderBackground(b);b.save();a=this._chooseObjectsToRender();b.transform.apply(b,this.viewportTransform);this._renderObjects(b,a);this.preserveObjectStacking||this._renderObjects(b,[this.getActiveGroup()]);b.restore();
!this.controlsAboveOverlay&&this.interactive&&this.drawControls(b);this.clipTo&&b.restore();this._renderOverlay(b);this.controlsAboveOverlay&&this.interactive&&this.drawControls(b);this.fire("after:render");return this},_renderObjects:function(b,a){for(var c=0,d=a.length;c<d;++c)a[c]&&a[c].render(b)},_renderBackgroundOrOverlay:function(b,a){var c=this[a+"Color"];c&&(b.fillStyle=c.toLive?c.toLive(b):c,b.fillRect(c.offsetX||0,c.offsetY||0,this.width,this.height));(c=this[a+"Image"])&&c.render(b)},_renderBackground:function(b){this._renderBackgroundOrOverlay(b,
"background")},_renderOverlay:function(b){this._renderBackgroundOrOverlay(b,"overlay")},renderTop:function(){this.clearContext(this.contextTop||this.contextContainer);this.selection&&this._groupSelector&&this._drawSelection();this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(b){this._centerObject(b,new g.Point(this.getCenter().left,b.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(b){this._centerObject(b,
new g.Point(b.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(b){var a=this.getCenter();this._centerObject(b,new g.Point(a.left,a.top));this.renderAll();return this},_centerObject:function(b,a){b.setPositionByOrigin(a,"center","center");return this},toDatalessJSON:function(b){return this.toDatalessObject(b)},toObject:function(b){return this._toObjectMethod("toObject",b)},toDatalessObject:function(b){return this._toObjectMethod("toDatalessObject",b)},_toObjectMethod:function(b,
a){var c={objects:this._toObjects(b,a)};e(c,this.__serializeBgOverlay());g.util.populateWithProperties(this,c,a);return c},_toObjects:function(b,a){return this.getObjects().map(function(c){return this._toObject(c,b,a)},this)},_toObject:function(b,a,c){var d;this.includeDefaultValues||(d=b.includeDefaultValues,b.includeDefaultValues=!1);var e=this._realizeGroupTransformOnObject(b);a=b[a](c);this.includeDefaultValues||(b.includeDefaultValues=d);this._unwindGroupTransformOnObject(b,e);return a},_realizeGroupTransformOnObject:function(b){var a=
"angle flipX flipY height left scaleX scaleY top width".split(" ");if(b.group&&b.group===this.getActiveGroup()){var c={};a.forEach(function(a){c[a]=b[a]});this.getActiveGroup().realizeTransform(b);return c}return null},_unwindGroupTransformOnObject:function(b,a){a&&b.set(a)},__serializeBgOverlay:function(){var b={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(b.overlay=this.overlayColor.toObject?this.overlayColor.toObject():
this.overlayColor);this.backgroundImage&&(b.backgroundImage=this.backgroundImage.toObject());this.overlayImage&&(b.overlayImage=this.overlayImage.toObject());return b},svgViewportTransformation:!0,toSVG:function(b,a){b||(b={});var c=[];this._setSVGPreamble(c,b);this._setSVGHeader(c,b);this._setSVGBgOverlayColor(c,"backgroundColor");this._setSVGBgOverlayImage(c,"backgroundImage");this._setSVGObjects(c,a);this._setSVGBgOverlayColor(c,"overlayColor");this._setSVGBgOverlayImage(c,"overlayImage");c.push("</svg>");
return c.join("")},_setSVGPreamble:function(b,a){a.suppressPreamble||b.push('<?xml version="1.0" encoding="',a.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(b,a){var h=a.width||this.width,d=a.height||this.height,e;e='viewBox="0 0 '+this.width+" "+this.height+'" ';var r=g.Object.NUM_FRACTION_DIGITS;a.viewBox?e='viewBox="'+a.viewBox.x+" "+a.viewBox.y+" "+a.viewBox.width+" "+
a.viewBox.height+'" ':this.svgViewportTransformation&&(e=this.viewportTransform,e='viewBox="'+c(-e[4]/e[0],r)+" "+c(-e[5]/e[3],r)+" "+c(this.width/e[0],r)+" "+c(this.height/e[3],r)+'" ');b.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',h,'" ','height="',d,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,e,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",
g.version,"</desc>\n","<defs>",g.createSVGFontFacesMarkup(this.getObjects()),g.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(b,a){for(var c=0,d=this.getObjects(),e=d.length;c<e;c++){var g=d[c],m=this._realizeGroupTransformOnObject(g);b.push(g.toSVG(a));this._unwindGroupTransformOnObject(g,m)}},_setSVGBgOverlayImage:function(b,a){this[a]&&this[a].toSVG&&b.push(this[a].toSVG())},_setSVGBgOverlayColor:function(b,a){this[a]&&this[a].source?b.push('<rect x="',this[a].offsetX,'" y="',
this[a].offsetY,'" ','width="',"repeat-y"===this[a].repeat||"no-repeat"===this[a].repeat?this[a].source.width:this.width,'" height="',"repeat-x"===this[a].repeat||"no-repeat"===this[a].repeat?this[a].source.height:this.height,'" fill="url(#'+a+'Pattern)"',"></rect>\n"):this[a]&&"overlayColor"===a&&b.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[a],'"',"></rect>\n")},sendToBack:function(b){d(this._objects,b);this._objects.unshift(b);return this.renderAll&&
this.renderAll()},bringToFront:function(b){d(this._objects,b);this._objects.push(b);return this.renderAll&&this.renderAll()},sendBackwards:function(b,a){var c=this._objects.indexOf(b);0!==c&&(c=this._findNewLowerIndex(b,c,a),d(this._objects,b),this._objects.splice(c,0,b),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(b,a,c){if(c)for(c=a,--a;0<=a;--a){if(b.intersectsWithObject(this._objects[a])||b.isContainedWithinObject(this._objects[a])||this._objects[a].isContainedWithinObject(b)){c=
a;break}}else c=a-1;return c},bringForward:function(b,a){var c=this._objects.indexOf(b);c!==this._objects.length-1&&(c=this._findNewUpperIndex(b,c,a),d(this._objects,b),this._objects.splice(c,0,b),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(b,a,c){if(c)for(c=a,a+=1;a<this._objects.length;++a){if(b.intersectsWithObject(this._objects[a])||b.isContainedWithinObject(this._objects[a])||this._objects[a].isContainedWithinObject(b)){c=a;break}}else c=a+1;return c},moveTo:function(b,
a){d(this._objects,b);this._objects.splice(a,0,b);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});e(g.StaticCanvas.prototype,g.Observable);e(g.StaticCanvas.prototype,g.Collection);e(g.StaticCanvas.prototype,g.DataURLExporter);e(g.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(b){var a=g.util.createCanvasElement();
if(!a||!a.getContext)return null;var c=a.getContext("2d");if(!c)return null;switch(b){case "getImageData":return"undefined"!==typeof c.getImageData;case "setLineDash":return"undefined"!==typeof c.setLineDash;case "toDataURL":return"undefined"!==typeof a.toDataURL;case "toDataURLWithQuality":try{return a.toDataURL("image/jpeg",0),!0}catch(d){}return!1;default:return null}}});g.StaticCanvas.prototype.toJSON=g.StaticCanvas.prototype.toObject}})();g.BaseBrush=g.util.createClass({color:"rgb(0, 0, 0)",
width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(e){this.shadow=new g.Shadow(e);return this},_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color;e.lineWidth=this.width;e.lineCap=this.strokeLineCap;e.lineJoin=this.strokeLineJoin;this.strokeDashArray&&g.StaticCanvas.supports("setLineDash")&&e.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var e=this.canvas.contextTop;e.shadowColor=this.shadow.color;
e.shadowBlur=this.shadow.blur;e.shadowOffsetX=this.shadow.offsetX;e.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="";e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}});(function(){g.PencilBrush=g.util.createClass(g.BaseBrush,{initialize:function(e){this.canvas=e;this._points=[]},onMouseDown:function(e){this._prepareForDrawing(e);this._captureDrawingPath(e);this._render()},onMouseMove:function(e){this._captureDrawingPath(e);this.canvas.clearContext(this.canvas.contextTop);
this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(e){e=new g.Point(e.x,e.y);this._reset();this._addPoint(e);this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(e){this._points.push(e)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(e){e=new g.Point(e.x,e.y);this._addPoint(e)},_render:function(){var e=this.canvas.contextTop,a=this.canvas.viewportTransform,d=this._points[0],c=this._points[1];
e.save();e.transform(a[0],a[1],a[2],a[3],a[4],a[5]);e.beginPath();2===this._points.length&&d.x===c.x&&d.y===c.y&&(d.x-=.5,c.x+=.5);e.moveTo(d.x,d.y);for(var a=1,b=this._points.length;a<b;a++)c=d.midPointFrom(c),e.quadraticCurveTo(d.x,d.y,c.x,c.y),d=this._points[a],c=this._points[a+1];e.lineTo(d.x,d.y);e.stroke();e.restore()},convertPointsToSVGPath:function(e){var a=[],d=new g.Point(e[0].x,e[0].y),c=new g.Point(e[1].x,e[1].y);a.push("M ",e[0].x," ",e[0].y," ");for(var b=1,k=e.length;b<k;b++){var f=
d.midPointFrom(c);a.push("Q ",d.x," ",d.y," ",f.x," ",f.y," ");d=new g.Point(e[b].x,e[b].y);b+1<e.length&&(c=new g.Point(e[b+1].x,e[b+1].y))}a.push("L ",d.x," ",d.y," ");return a},createPath:function(e){e=new g.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow));return e},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();
var e=this.convertPointsToSVGPath(this._points).join("");"M 0 0 Q 0 0 0 0 L 0 0"===e?this.canvas.renderAll():(e=this.createPath(e),this.canvas.add(e),e.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:e}))}})})();g.CircleBrush=g.util.createClass(g.BaseBrush,{width:10,initialize:function(e){this.canvas=e;this.points=[]},drawDot:function(e){e=this.addPoint(e);var a=this.canvas.contextTop,d=this.canvas.viewportTransform;
a.save();a.transform(d[0],d[1],d[2],d[3],d[4],d[5]);a.fillStyle=e.fill;a.beginPath();a.arc(e.x,e.y,e.radius,0,2*Math.PI,!1);a.closePath();a.fill();a.restore()},onMouseDown:function(e){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(e)},onMouseMove:function(e){this.drawDot(e)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var a=[],d=0,c=this.points.length;d<c;d++){var b=this.points[d],b=new g.Circle({radius:b.radius,
left:b.x,top:b.y,originX:"center",originY:"center",fill:b.fill});this.shadow&&b.setShadow(this.shadow);a.push(b)}a=new g.Group(a,{originX:"center",originY:"center"});a.canvas=this.canvas;this.canvas.add(a);this.canvas.fire("path:created",{path:a});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},addPoint:function(e){e=new g.Point(e.x,e.y);var a=g.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,d=(new g.Color(this.color)).setAlpha(g.util.getRandomInt(0,
100)/100).toRgba();e.radius=a;e.fill=d;this.points.push(e);return e}});g.SprayBrush=g.util.createClass(g.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e;this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(e);this.render()},onMouseMove:function(e){this.addSprayChunk(e);this.render()},onMouseUp:function(){var e=
this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var a=[],d=0,c=this.sprayChunks.length;d<c;d++)for(var b=this.sprayChunks[d],k=0,f=b.length;k<f;k++){var h=new g.Rect({width:b[k].width,height:b[k].width,left:b[k].x+1,top:b[k].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&h.setShadow(this.shadow);a.push(h)}this.optimizeOverlapping&&(a=this._getOptimizedRects(a));a=new g.Group(a,{originX:"center",originY:"center"});a.canvas=this.canvas;this.canvas.add(a);this.canvas.fire("path:created",
{path:a});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},_getOptimizedRects:function(e){for(var a={},d,c=0,b=e.length;c<b;c++)d=e[c].left+""+e[c].top,a[d]||(a[d]=e[c]);e=[];for(d in a)e.push(a[d]);return e},render:function(){var e=this.canvas.contextTop;e.fillStyle=this.color;var a=this.canvas.viewportTransform;e.save();e.transform(a[0],a[1],a[2],a[3],a[4],a[5]);for(var a=0,d=this.sprayChunkPoints.length;a<d;a++){var c=
this.sprayChunkPoints[a];"undefined"!==typeof c.opacity&&(e.globalAlpha=c.opacity);e.fillRect(c.x,c.y,c.width,c.width)}e.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];for(var a,d,c,b=this.width/2,k=0;k<this.density;k++)a=g.util.getRandomInt(e.x-b,e.x+b),d=g.util.getRandomInt(e.y-b,e.y+b),c=this.dotWidthVariance?g.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,a=new g.Point(a,d),a.width=c,this.randomOpacity&&(a.opacity=
g.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(a);this.sprayChunks.push(this.sprayChunkPoints)}});g.PatternBrush=g.util.createClass(g.PencilBrush,{getPatternSrc:function(){var e=g.document.createElement("canvas"),a=e.getContext("2d");e.width=e.height=25;a.fillStyle=this.color;a.beginPath();a.arc(10,10,10,0,2*Math.PI,!1);a.closePath();a.fill();return e},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||
this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){e=this.callSuper("createPath",e);e.stroke=new g.Pattern({source:this.source||this.getPatternSrcFunction()});return e}});(function(){var e=g.util.getPointer,a=g.util.degreesToRadians,d=g.util.radiansToDegrees,c=Math.atan2,b=Math.abs;g.Canvas=g.util.createClass(g.StaticCanvas,{initialize:function(b,a){a||(a={});this._initStatic(b,a);
this._initInteractive();this._createCacheCanvas()},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,
_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=g.PencilBrush&&new g.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(){var b=this._currentTransform;b.target.set({scaleX:b.original.scaleX,scaleY:b.original.scaleY,skewX:b.original.skewX,skewY:b.original.skewY,left:b.original.left,top:b.original.top});this._shouldCenterTransform(b.target)?
"rotate"===b.action?this._setOriginToCenter(b.target):("center"!==b.originX&&(b.mouseXSign="right"===b.originX?-1:1),"center"!==b.originY&&(b.mouseYSign="bottom"===b.originY?-1:1),b.originX="center",b.originY="center"):(b.originX=b.original.originX,b.originY=b.original.originY)},containsPoint:function(b,a){var c=this.getPointer(b,!0),k=this._normalizePointer(a,c);return a.containsPoint(k)||a._findTargetCorner(c)},_normalizePointer:function(b,a){var c=this.getActiveGroup(),k;c&&"group"!==b.type&&c.contains(b)&&
(k=g.util.multiplyTransformMatrices(this.viewportTransform,c.calcTransformMatrix()),k=g.util.invertTransform(k),a=g.util.transformPoint(a,k,!1),c=g.util.transformPoint(c.getCenterPoint(),k,!1),a.x-=c.x,a.y-=c.y);return{x:a.x,y:a.y}},isTargetTransparent:function(b,a,c){var k=b.hasBorders,d=b.transparentCorners;b.hasBorders=b.transparentCorners=!1;b.render(this.contextCache);b._renderControls(this.contextCache);b.hasBorders=k;b.transparentCorners=d;b=g.util.isTransparent(this.contextCache,a,c,this.targetFindTolerance);
this.clearContext(this.contextCache);return b},_shouldClearSelection:function(b,a){var c=this.getActiveGroup(),k=this.getActiveObject();return!a||a&&c&&!c.contains(a)&&c!==a&&!b.shiftKey||a&&!a.evented||a&&!a.selectable&&k&&k!==a},_shouldCenterTransform:function(b){if(b){var a=this._currentTransform,c;"scale"===a.action||"scaleX"===a.action||"scaleY"===a.action?c=this.centeredScaling||b.centeredScaling:"rotate"===a.action&&(c=this.centeredRotation||b.centeredRotation);return c?!a.altKey:a.altKey}},
_getOriginFromCorner:function(b,a){var c={x:b.originX,y:b.originY};if("ml"===a||"tl"===a||"bl"===a)c.x="right";else if("mr"===a||"tr"===a||"br"===a)c.x="left";if("tl"===a||"mt"===a||"tr"===a)c.y="bottom";else if("bl"===a||"mb"===a||"br"===a)c.y="top";return c},_getActionFromCorner:function(b,a,c){if(!a)return"drag";switch(a){case "mtr":return"rotate";case "ml":case "mr":return c.shiftKey?"skewY":"scaleX";case "mt":case "mb":return c.shiftKey?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(b,
c){if(c){var k=this.getPointer(b),d=c._findTargetCorner(this.getPointer(b,!0)),e=this._getActionFromCorner(c,d,b),m=this._getOriginFromCorner(c,d);this._currentTransform={target:c,action:e,corner:d,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,offsetX:k.x-c.left,offsetY:k.y-c.top,originX:m.x,originY:m.y,ex:k.x,ey:k.y,lastX:k.x,lastY:k.y,left:c.left,top:c.top,theta:a(c.angle),width:c.width*c.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:b.shiftKey,altKey:b.altKey};this._currentTransform.original=
{left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,originX:m.x,originY:m.y};this._resetCurrentTransform()}},_translateObject:function(b,a){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",b-this._currentTransform.offsetX);c.get("lockMovementY")||c.set("top",a-this._currentTransform.offsetY)},_changeSkewTransformOrigin:function(b,a,c){var k="originX",d={0:"center"},e=a.target.skewX,g="left",t="right",H="mt"===a.corner||"ml"===a.corner?1:-1,F=
1;b=0<b?1:-1;"y"===c&&(e=a.target.skewY,g="top",t="bottom",k="originY");d[-1]=g;d[1]=t;a.target.flipX&&(F*=-1);a.target.flipY&&(F*=-1);0===e?(a.skewSign=-H*b*F,a[k]=d[-b]):(e=0<e?1:-1,a.skewSign=e,a[k]=d[e*H*F])},_skewObject:function(b,a,c){var k=this._currentTransform,d=k.target,e=d.get("lockSkewingX"),u=d.get("lockSkewingY");if(!(e&&"x"===c||u&&"y"===c)){var u=d.getCenterPoint(),t=d.toLocalPoint(new g.Point(b,a),"center","center")[c],H=d.toLocalPoint(new g.Point(k.lastX,k.lastY),"center","center")[c],
e=d._getTransformedDimensions();this._changeSkewTransformOrigin(t-H,k,c);t=d.toLocalPoint(new g.Point(b,a),k.originX,k.originY)[c];u=d.translateToOriginPoint(u,k.originX,k.originY);this._setObjectSkew(t,k,c,e);k.lastX=b;k.lastY=a;d.setPositionByOrigin(u,k.originX,k.originY)}},_setObjectSkew:function(b,a,c,k){var d=a.target,e=a.skewSign,u,t,H,F;"x"===c?(a="y",H="Y",u="X",t=0,F=d.skewY):(a="x",H="X",u="Y",t=d.skewX,F=0);t=d._getTransformedDimensions(t,F);b=2*Math.abs(b)-t[c];2>=b?b=0:(b=e*Math.atan(b/
d["scale"+u]/(t[a]/d["scale"+H])),b=g.util.radiansToDegrees(b));d.set("skew"+u,b);0!==d["skew"+H]&&(u=d._getTransformedDimensions(),b=k[a]/u[a]*d["scale"+H],d.set("scale"+H,b))},_scaleObject:function(b,a,c){var k=this._currentTransform,d=k.target,e=d.get("lockScalingX"),u=d.get("lockScalingY"),t=d.get("lockScalingFlip");if(!e||!u){var H=d.translateToOriginPoint(d.getCenterPoint(),k.originX,k.originY);b=d.toLocalPoint(new g.Point(b,a),k.originX,k.originY);a=d._getTransformedDimensions();this._setLocalMouse(b,
k);this._setObjectScale(b,k,e,u,c,t,a);d.setPositionByOrigin(H,k.originX,k.originY)}},_setObjectScale:function(b,a,c,k,d,e,g){var t=a.target,H=!1,F=!1;a.newScaleX=b.x*t.scaleX/g.x;a.newScaleY=b.y*t.scaleY/g.y;e&&0>=a.newScaleX&&a.newScaleX<t.scaleX&&(H=!0);e&&0>=a.newScaleY&&a.newScaleY<t.scaleY&&(F=!0);"equally"!==d||c||k?d?"x"!==d||t.get("lockUniScaling")?"y"!==d||t.get("lockUniScaling")||F||k||t.set("scaleY",a.newScaleY):H||c||t.set("scaleX",a.newScaleX):(H||c||t.set("scaleX",a.newScaleX),F||k||
t.set("scaleY",a.newScaleY)):H||F||this._scaleObjectEqually(b,t,a,g);H||F||this._flipObject(a,d)},_scaleObjectEqually:function(b,a,c,k){b=b.y+b.x;k=k.y*c.original.scaleY/a.scaleY+k.x*c.original.scaleX/a.scaleX;c.newScaleX=c.original.scaleX*b/k;c.newScaleY=c.original.scaleY*b/k;a.set("scaleX",c.newScaleX);a.set("scaleY",c.newScaleY)},_flipObject:function(b,a){0>b.newScaleX&&"y"!==a&&("left"===b.originX?b.originX="right":"right"===b.originX&&(b.originX="left"));0>b.newScaleY&&"x"!==a&&("top"===b.originY?
b.originY="bottom":"bottom"===b.originY&&(b.originY="top"))},_setLocalMouse:function(a,c){var k=c.target;"right"===c.originX?a.x*=-1:"center"===c.originX&&(a.x=2*a.x*c.mouseXSign,0>a.x&&(c.mouseXSign=-c.mouseXSign));"bottom"===c.originY?a.y*=-1:"center"===c.originY&&(a.y=2*a.y*c.mouseYSign,0>a.y&&(c.mouseYSign=-c.mouseYSign));b(a.x)>k.padding?a.x=0>a.x?a.x+k.padding:a.x-k.padding:a.x=0;b(a.y)>k.padding?a.y=0>a.y?a.y+k.padding:a.y-k.padding:a.y=0},_rotateObject:function(b,a){var k=this._currentTransform;
if(!k.target.get("lockRotation")){var e=c(k.ey-k.top,k.ex-k.left),g=c(a-k.top,b-k.left),e=d(g-e+k.theta);0>e&&(e=360+e);k.target.angle=e%360}},setCursor:function(b){this.upperCanvasEl.style.cursor=b},_resetObjectTransform:function(b){b.scaleX=1;b.scaleY=1;b.skewX=0;b.skewY=0;b.setAngle(0)},_drawSelection:function(){var a=this.contextTop,c=this._groupSelector,k=c.left,d=c.top,e=b(k),m=b(d);a.fillStyle=this.selectionColor;a.fillRect(c.ex-(0<k?0:-k),c.ey-(0<d?0:-d),e,m);a.lineWidth=this.selectionLineWidth;
a.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?(k=c.ex+.5-(0<k?0:e),c=c.ey+.5-(0<d?0:m),a.beginPath(),g.util.drawDashedLine(a,k,c,k+e,c,this.selectionDashArray),g.util.drawDashedLine(a,k,c+m-1,k+e,c+m-1,this.selectionDashArray),g.util.drawDashedLine(a,k,c,k,c+m,this.selectionDashArray),g.util.drawDashedLine(a,k+e-1,c,k+e-1,c+m,this.selectionDashArray),a.closePath(),a.stroke()):a.strokeRect(c.ex+.5-(0<k?0:e),c.ey+.5-(0<d?0:m),e,m)},_isLastRenderedObject:function(b){return this.controlsAboveOverlay&&
this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(b,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(b,!0))},findTarget:function(b,a){if(!this.skipTargetFind){if(this._isLastRenderedObject(b))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!a&&this.containsPoint(b,c))return c;c=this._searchPossibleTargets(b,
a);this._fireOverOutEvents(c,b);return c}},_fireOverOutEvents:function(b,a){b?this._hoveredTarget!==b&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:a}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:b,e:a}),b.fire("mouseover"),this._hoveredTarget=b):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:a}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(b,a,c){if(a&&a.visible&&a.evented&&
this.containsPoint(b,a)&&(!this.perPixelTargetFind&&!a.perPixelTargetFind||a.isEditing||!this.isTargetTransparent(a,c.x,c.y)))return!0},_searchPossibleTargets:function(b,a){for(var c,k=this.getPointer(b,!0),d=this._objects.length;d--;)if((!this._objects[d].group||a)&&this._checkTarget(b,this._objects[d],k)){this.relatedTarget=this._objects[d];c=this._objects[d];break}return c},getPointer:function(b,a,c){c||(c=this.upperCanvasEl);b=e(b);var k=c.getBoundingClientRect(),d=k.width||0,m=k.height||0;d&&
m||("top"in k&&"bottom"in k&&(m=Math.abs(k.top-k.bottom)),"right"in k&&"left"in k&&(d=Math.abs(k.right-k.left)));this.calcOffset();b.x-=this._offset.left;b.y-=this._offset.top;a||(b=g.util.transformPoint(b,g.util.invertTransform(this.viewportTransform)));0===d||0===m?c=a=1:(a=c.width/d,c=c.height/m);return{x:b.x*a,y:b.y*c}},_createUpperCanvas:function(){var b=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();g.util.addClass(this.upperCanvasEl,
"upper-canvas "+b);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=
g.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});g.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});g.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(b){var a=this.getWidth()||b.width,c=this.getHeight()||b.height;g.util.setStyle(b,{position:"absolute",width:a+"px",height:c+"px",left:0,top:0});b.width=a;b.height=c;g.util.makeElementUnselectable(b)},_copyCanvasStyle:function(b,a){a.style.cssText=
b.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(b){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=b;b.set("active",!0)},setActiveObject:function(b,a){this._setActiveObject(b);this.renderAll();this.fire("object:selected",{target:b,e:a});b.fire("selected",{e:a});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&
this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(b){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:b});return this},_setActiveGroup:function(b){(this._activeGroup=b)&&b.set("active",!0)},setActiveGroup:function(b,a){this._setActiveGroup(b);b&&(this.fire("object:selected",{target:b,e:a}),b.fire("selected",{e:a}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var b=this.getActiveGroup();
b&&b.destroy();this.setActiveGroup(null)},discardActiveGroup:function(b){this._discardActiveGroup();this.fire("selection:cleared",{e:b});return this},deactivateAll:function(){for(var b=this.getObjects(),a=0,c=b.length;a<c;a++)b[a].set("active",!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(b){var a=this.getActiveGroup()||this.getActiveObject();a&&this.fire("before:selection:cleared",{target:a,e:b});this.deactivateAll();a&&this.fire("selection:cleared",
{e:b});return this},dispose:function(){this.callSuper("dispose");var b=this.wrapperEl;this.removeListeners();b.removeChild(this.upperCanvasEl);b.removeChild(this.lowerCanvasEl);delete this.upperCanvasEl;b.parentNode&&b.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl);delete this.wrapperEl;return this},drawControls:function(b){var a=this.getActiveGroup();a?a._renderControls(b):this._drawObjectsControls(b)},_drawObjectsControls:function(b){for(var a=0,c=this._objects.length;a<c;++a)this._objects[a]&&
this._objects[a].active&&(this._objects[a]._renderControls(b),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[a])}});for(var k in g.StaticCanvas)"prototype"!==k&&(g.Canvas[k]=g.StaticCanvas[k]);g.isTouchSupported&&(g.Canvas.prototype._setCursorFromEvent=function(){});g.Element=g.Canvas})();(function(){var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},a=g.util.addListener,d=g.util.removeListener;g.util.object.extend(g.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),
_initEventListeners:function(){this._bindEvents();a(g.window,"resize",this._onResize);a(this.upperCanvasEl,"mousedown",this._onMouseDown);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"mousewheel",this._onMouseWheel);a(this.upperCanvasEl,"touchstart",this._onMouseDown);a(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),
eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);
this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){d(g.window,"resize",this._onResize);d(this.upperCanvasEl,"mousedown",this._onMouseDown);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"mousewheel",this._onMouseWheel);d(this.upperCanvasEl,"touchstart",this._onMouseDown);d(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&
"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,
b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onMouseDown:function(c){this.__onMouseDown(c);a(g.document,"touchend",this._onMouseUp);a(g.document,"touchmove",this._onMouseMove);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"touchmove",this._onMouseMove);
"touchstart"===c.type?d(this.upperCanvasEl,"mousedown",this._onMouseDown):(a(g.document,"mouseup",this._onMouseUp),a(g.document,"mousemove",this._onMouseMove))},_onMouseUp:function(c){this.__onMouseUp(c);d(g.document,"mouseup",this._onMouseUp);d(g.document,"touchend",this._onMouseUp);d(g.document,"mousemove",this._onMouseMove);d(g.document,"touchmove",this._onMouseMove);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"touchmove",this._onMouseMove);if("touchend"===c.type){var b=
this;setTimeout(function(){a(b.upperCanvasEl,"mousedown",b._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var k=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==k)||!a&&k||!a&&!k&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){var b;
if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);else{this._currentTransform?(this._finalizeCurrentTransform(),b=this._currentTransform.target):b=this.findTarget(a,!0);var k=this._shouldRender(b,this.getPointer(a));this._maybeGroupObjects(a);b&&(b.isMoving=!1);k&&this.renderAll();this._handleCursorAndEvent(a,b)}},_handleCursorAndEvent:function(a,b){this._setCursorFromEvent(a,b);var k=this;setTimeout(function(){k._setCursorFromEvent(a,b)},50);this.fire("mouse:up",{target:b,
e:a});b&&b.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=this._currentTransform.target;a._scaling&&(a._scaling=!1);a.setCoords();this.stateful&&a.hasStateChanged()&&(this.fire("object:modified",{target:a}),a.fire("modified"));this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;
a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.discardActiveObject(a).renderAll();this.clipTo&&g.util.clipContext(this,this.contextTop);var b=g.util.invertTransform(this.viewportTransform),b=g.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseDown(b);this.fire("mouse:down",{e:a});b=this.findTarget(a);"undefined"!==typeof b&&b.fire("mousedown",{e:a,target:b})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=
g.util.invertTransform(this.viewportTransform),b=g.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseMove(b)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:a});b=this.findTarget(a);"undefined"!==typeof b&&b.fire("mousemove",{e:a,target:b})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a});var b=this.findTarget(a);"undefined"!==typeof b&&b.fire("mouseup",
{e:a,target:b})},__onMouseDown:function(a){if(("which"in a?1===a.which:0===a.button)||g.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(!this._currentTransform){var b=this.findTarget(a),k=this.getPointer(a,!0);this._previousPointer=k;var f=this._shouldRender(b,k),h=this._shouldGroup(a,b);this._shouldClearSelection(a,b)?this._clearSelection(a,b,k):h&&(this._handleGrouping(a,b),b=this.getActiveGroup());b&&b.selectable&&(b.__corner||!h)&&(this._beforeTransform(a,b),this._setupCurrentTransform(a,
b));f&&this.renderAll();this.fire("mouse:down",{target:b,e:a});b&&b.fire("mousedown",{e:a})}},_beforeTransform:function(a,b){this.stateful&&b.saveState();if(b._findTargetCorner(this.getPointer(a)))this.onBeforeScaleRotate(b);b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(b,a))},_clearSelection:function(a,b,k){this.deactivateAllWithDispatch(a);b&&b.selectable?this.setActiveObject(b,a):this.selection&&(this._groupSelector={ex:k.x,ey:k.y,top:0,left:0})},
_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center";a.originY="center";a.left=b.x;a.top=b.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=
b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null},__onMouseMove:function(a){var b,k;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);else if(!("undefined"!==typeof a.touches&&1<a.touches.length)){var f=this._groupSelector;f?(k=this.getPointer(a,!0),f.left=k.x-f.ex,f.top=k.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a),!b||b&&!b.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,b));this.fire("mouse:move",{target:b,
e:a});b&&b.fire("mousemove",{e:a})}},_transformObject:function(a){var b=this.getPointer(a),k=this._currentTransform;k.reset=!1;k.target.isMoving=!0;this._beforeScaleTransform(a,k);this._performTransformAction(a,k,b);this.renderAll()},_performTransformAction:function(a,b,k){var f=k.x;k=k.y;var h=b.target,d=b.action;"rotate"===d?(this._rotateObject(f,k),this._fire("rotating",h,a)):"scale"===d?(this._onScale(a,b,f,k),this._fire("scaling",h,a)):"scaleX"===d?(this._scaleObject(f,k,"x"),this._fire("scaling",
h,a)):"scaleY"===d?(this._scaleObject(f,k,"y"),this._fire("scaling",h,a)):"skewX"===d?(this._skewObject(f,k,"x"),this._fire("skewing",h,a)):"skewY"===d?(this._skewObject(f,k,"y"),this._fire("skewing",h,a)):(this._translateObject(f,k),this._fire("moving",h,a),this.setCursor(this.moveCursor))},_fire:function(a,b,k){this.fire("object:"+a,{target:b,e:k});b.fire(a,{e:k})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var k=this._shouldCenterTransform(b.target);
if(k&&("center"!==b.originX||"center"!==b.originY)||!k&&"center"===b.originX&&"center"===b.originY)this._resetCurrentTransform(),b.reset=!0}},_onScale:function(a,b,k,f){!a.shiftKey&&!this.uniScaleTransform||b.target.get("lockUniScaling")?(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(),b.currentAction="scaleEqually",this._scaleObject(k,f,"equally")):(b.currentAction="scale",this._scaleObject(k,f))},_setCursorFromEvent:function(a,b){if(b&&b.selectable){var k=this.getActiveGroup();
(k=b._findTargetCorner&&(!k||!k.contains(b))&&b._findTargetCorner(this.getPointer(a,!0)))?this._setCornerCursor(k,b,a):this.setCursor(b.hoverCursor||this.hoverCursor)}else return this.setCursor(this.defaultCursor),!1;return!0},_setCornerCursor:function(a,b,k){if(a in e)this.setCursor(this._getRotatedCornerCursor(a,b,k));else if("mtr"===a&&b.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(a,b,k){b=Math.round(b.getAngle()%
360/45);0>b&&(b+=8);b+=e[a];k.shiftKey&&0===e[a]%2&&(b+=2);return this.cursorMap[b%8]}})})();(function(){var e=Math.min,a=Math.max;g.util.object.extend(g.Canvas.prototype,{_shouldGroup:function(a,c){var b=this.getActiveObject();return a.shiftKey&&c&&c.selectable&&(this.getActiveGroup()||b&&b!==c)&&this.selection},_handleGrouping:function(a,c){if(c===this.getActiveGroup()&&(c=this.findTarget(a,!0),!c||c.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(c,a):this._createActiveGroup(c,
a);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(a,c){var b=this.getActiveGroup();if(b.contains(a)){if(b.removeWithUpdate(a),a.set("active",!1),1===b.size()){this.discardActiveGroup(c);this.setActiveObject(b.item(0));return}}else b.addWithUpdate(a);this.fire("selection:created",{target:b,e:c});b.set("active",!0)},_createActiveGroup:function(a,c){if(this._activeObject&&a!==this._activeObject){var b=this._createGroup(a);b.addWithUpdate();this.setActiveGroup(b);this._activeObject=
null;this.fire("selection:created",{target:b,e:c})}a.set("active",!0)},_createGroup:function(a){var c=this.getObjects();a=c.indexOf(this._activeObject)<c.indexOf(a)?[this._activeObject,a]:[a,this._activeObject];return new g.Group(a,{canvas:this})},_groupSelectedObjects:function(a){var c=this._collectObjects();1===c.length?this.setActiveObject(c[0],a):1<c.length&&(c=new g.Group(c.reverse(),{canvas:this}),c.addWithUpdate(),this.setActiveGroup(c,a),c.saveCoords(),this.fire("selection:created",{target:c}),
this.renderAll())},_collectObjects:function(){var d=[],c;c=this._groupSelector.ex;for(var b=this._groupSelector.ey,k=c+this._groupSelector.left,f=b+this._groupSelector.top,h=new g.Point(e(c,k),e(b,f)),n=new g.Point(a(c,k),a(b,f)),b=c===k&&b===f,k=this._objects.length;k--&&!((c=this._objects[k])&&c.selectable&&c.visible&&(c.intersectsWithRect(h,n)||c.isContainedWithinRect(h,n)||c.containsPoint(h)||c.containsPoint(n))&&(c.set("active",!0),d.push(c),b)););return d},_maybeGroupObjects:function(a){this.selection&&
this._groupSelector&&this._groupSelectedObjects(a);if(a=this.getActiveGroup())a.setObjectsCoords().setCoords(),a.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();g.util.object.extend(g.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var a=e.format||"png",d=e.quality||1,c=e.multiplier||1;e={left:e.left,top:e.top,width:e.width,height:e.height};this._isRetinaScaling()&&(c*=g.devicePixelRatio);return 1!==c?this.__toDataURLWithMultiplier(a,d,
e,c):this.__toDataURL(a,d,e)},__toDataURL:function(e,a,d){this.renderAll();var c=this.contextContainer.canvas;d=this.__getCroppedCanvas(c,d);"jpg"===e&&(e="jpeg");return g.StaticCanvas.supports("toDataURLWithQuality")?(d||c).toDataURL("image/"+e,a):(d||c).toDataURL("image/"+e)},__getCroppedCanvas:function(e,a){var d,c;if("left"in a||"top"in a||"width"in a||"height"in a)d=g.util.createCanvasElement(),c=d.getContext("2d"),d.width=a.width||this.width,d.height=a.height||this.height,c.drawImage(e,-a.left||
0,-a.top||0);return d},__toDataURLWithMultiplier:function(e,a,d,c){var b=this.getWidth(),k=this.getHeight(),f=b*c,h=k*c,n=this.getActiveObject(),q=this.getActiveGroup(),r=this.contextContainer;1<c&&this.setDimensions({width:f,height:h});r.save();r.scale(c/g.devicePixelRatio,c/g.devicePixelRatio);d.left&&(d.left*=c);d.top&&(d.top*=c);d.width?d.width*=c:1>c&&(d.width=f);d.height?d.height*=c:1>c&&(d.height=h);q?this._tempRemoveBordersControlsFromGroup(q):n&&this.deactivateAll&&this.deactivateAll();e=
this.__toDataURL(e,a,d);this.width=b;this.height=k;this.setDimensions({width:b,height:k});q?this._restoreBordersControlsOnGroup(q):n&&this.setActiveObject&&this.setActiveObject(n);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return e},toDataURLWithMultiplier:function(e,a,d){return this.toDataURL({format:e,multiplier:a,quality:d})},_tempRemoveBordersControlsFromGroup:function(e){e.origHasControls=e.hasControls;e.origBorderColor=e.borderColor;e.hasControls=!0;e.borderColor="rgba(0,0,0,0)";
e.forEachObject(function(a){a.origBorderColor=a.borderColor;a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(e){e.hideControls=e.origHideControls;e.borderColor=e.origBorderColor;e.forEachObject(function(a){a.borderColor=a.origBorderColor;delete a.origBorderColor})}});g.util.object.extend(g.StaticCanvas.prototype,{loadFromDatalessJSON:function(e,a,d){return this.loadFromJSON(e,a,d)},loadFromJSON:function(e,a,d){if(e){var c="string"===typeof e?JSON.parse(e):e;this.clear();var b=
this;this._enlivenObjects(c.objects,function(){b._setBgOverlay(c,a)},d);return this}},_setBgOverlay:function(e,a){var d=this,c={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(e.backgroundImage||e.overlayImage||e.background||e.overlay){var b=function(){c.backgroundImage&&c.overlayImage&&c.backgroundColor&&c.overlayColor&&(d.renderAll(),a&&a())};this.__setBgOverlay("backgroundImage",e.backgroundImage,c,b);this.__setBgOverlay("overlayImage",e.overlayImage,c,b);this.__setBgOverlay("backgroundColor",
e.background,c,b);this.__setBgOverlay("overlayColor",e.overlay,c,b);b()}else a&&a()},__setBgOverlay:function(e,a,d,c){var b=this;if(a)if("backgroundImage"===e||"overlayImage"===e)g.Image.fromObject(a,function(a){b[e]=a;d[e]=!0;c&&c()});else this["set"+g.util.string.capitalize(e,!0)](a,function(){d[e]=!0;c&&c()});else d[e]=!0},_enlivenObjects:function(e,a,d){var c=this;if(e&&0!==e.length){var b=this.renderOnAddRemove;this.renderOnAddRemove=!1;g.util.enlivenObjects(e,function(k){k.forEach(function(b,
a){c.insertAt(b,a,!0)});c.renderOnAddRemove=b;a&&a()},null,d)}else a&&a()},_toDataURL:function(e,a){this.clone(function(d){a(d.toDataURL(e))})},_toDataURLWithMultiplier:function(e,a,d){this.clone(function(c){d(c.toDataURLWithMultiplier(e,a))})},clone:function(e,a){var d=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(a){a.loadFromJSON(d,function(){e&&e(a)})})},cloneWithoutData:function(e){var a=g.document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();var d=
new g.Canvas(a);d.clipTo=this.clipTo;this.backgroundImage?(d.setBackgroundImage(this.backgroundImage.src,function(){d.renderAll();e&&e(d)}),d.backgroundImageOpacity=this.backgroundImageOpacity,d.backgroundImageStretch=this.backgroundImageStretch):e&&e(d)}});(function(e){var a=e.fabric||(e.fabric={});e=a.util.object.extend;var d=a.util.toFixed,c=a.util.string.capitalize,b=a.util.degreesToRadians,k=a.StaticCanvas.supports("setLineDash");a.Object||(a.Object=a.util.createClass({type:"object",originX:"left",
originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,
borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor alignX alignY meetOrSlice skewX skewY".split(" "),
initialize:function(b){b&&this.setOptions(b)},_initGradient:function(b){!b.fill||!b.fill.colorStops||b.fill instanceof a.Gradient||this.set("fill",new a.Gradient(b.fill));!b.stroke||!b.stroke.colorStops||b.stroke instanceof a.Gradient||this.set("stroke",new a.Gradient(b.stroke))},_initPattern:function(b){!b.fill||!b.fill.source||b.fill instanceof a.Pattern||this.set("fill",new a.Pattern(b.fill));!b.stroke||!b.stroke.source||b.stroke instanceof a.Pattern||this.set("stroke",new a.Pattern(b.stroke))},
_initClipping:function(b){b.clipTo&&"string"===typeof b.clipTo&&(b=a.util.getFunctionBody(b.clipTo),"undefined"!==typeof b&&(this.clipTo=new Function("ctx",b)))},setOptions:function(b){for(var a in b)this.set(a,b[a]);this._initGradient(b);this._initPattern(b);this._initClipping(b)},transform:function(a,c){this.group&&this.canvas.preserveObjectStacking&&this.group===this.canvas._activeGroup&&this.group.transform(a);var k=c?this._getLeftTopCoords():this.getCenterPoint();a.translate(k.x,k.y);a.rotate(b(this.angle));
a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1));a.transform(1,0,Math.tan(b(this.skewX)),1,0,0);a.transform(1,Math.tan(b(this.skewY)),0,1,0,0)},toObject:function(b){var c=a.Object.NUM_FRACTION_DIGITS,c={type:this.type,originX:this.originX,originY:this.originY,left:d(this.left,c),top:d(this.top,c),width:d(this.width,c),height:d(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,
strokeWidth:d(this.strokeWidth,c),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:d(this.strokeMiterLimit,c),scaleX:d(this.scaleX,c),scaleY:d(this.scaleY,c),angle:d(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),
backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:d(this.skewX,c),skewY:d(this.skewY,c)};this.includeDefaultValues||(c=this._removeDefaultValues(c));a.util.populateWithProperties(this,c,b);return c},toDatalessObject:function(b){return this.toObject(b)},_removeDefaultValues:function(b){var c=a.util.getKlass(b.type).prototype;c.stateProperties.forEach(function(a){b[a]===
c[a]&&delete b[a];"[object Array]"===Object.prototype.toString.call(b[a])&&"[object Array]"===Object.prototype.toString.call(c[a])&&0===b[a].length&&0===c[a].length&&delete b[a]});return b},toString:function(){return"#<fabric."+c(this.type)+">"},get:function(b){return this[b]},_setObject:function(b){for(var a in b)this._set(a,b[a])},set:function(b,a){"object"===typeof b?this._setObject(b):"function"===typeof a&&"clipTo"!==b?this._set(b,a(this.get(b))):this._set(b,a);return this},_set:function(b,c){if("scaleX"===
b||"scaleY"===b)c=this._constrainScale(c);"scaleX"===b&&0>c?(this.flipX=!this.flipX,c*=-1):"scaleY"===b&&0>c?(this.flipY=!this.flipY,c*=-1):"width"===b||"height"===b?this.minScaleLimit=d(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"!==b||!c||c instanceof a.Shadow||(c=new a.Shadow(c));this[b]=c;return this},setOnGroup:function(){},toggle:function(b){var a=this.get(b);"boolean"===typeof a&&this.set(b,!a);return this},setSourcePath:function(b){this.sourcePath=b;return this},getViewportTransform:function(){return this.canvas&&
this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(b,c){0===this.width&&0===this.height||!this.visible||(b.save(),this._setupCompositeOperation(b),c||this.transform(b),this._setStrokeStyles(b),this._setFillStyles(b),this.transformMatrix&&b.transform.apply(b,this.transformMatrix),this._setOpacity(b),this._setShadow(b),this.clipTo&&a.util.clipContext(this,b),this._render(b,c),this.clipTo&&b.restore(),b.restore())},_setOpacity:function(b){this.group&&this.group._setOpacity(b);
b.globalAlpha*=this.opacity},_setStrokeStyles:function(b){this.stroke&&(b.lineWidth=this.strokeWidth,b.lineCap=this.strokeLineCap,b.lineJoin=this.strokeLineJoin,b.miterLimit=this.strokeMiterLimit,b.strokeStyle=this.stroke.toLive?this.stroke.toLive(b,this):this.stroke)},_setFillStyles:function(b){this.fill&&(b.fillStyle=this.fill.toLive?this.fill.toLive(b,this):this.fill)},_renderControls:function(f,c){if(!(!this.active||c||this.group&&this.group!==this.canvas.getActiveGroup())){var k=this.getViewportTransform(),
d=this.calcTransformMatrix(),d=a.util.multiplyTransformMatrices(k,d),k=a.util.qrDecompose(d);f.save();f.translate(k.translateX,k.translateY);this.group&&this.group===this.canvas.getActiveGroup()?(f.rotate(b(k.angle)),this.drawBordersInGroup(f,k)):(f.rotate(b(this.angle)),this.drawBorders(f));this.drawControls(f);f.restore()}},_setShadow:function(b){if(this.shadow){var c=this.canvas&&this.canvas.viewportTransform[0]||1,k=this.canvas&&this.canvas.viewportTransform[3]||1;this.canvas&&this.canvas._isRetinaScaling()&&
(c*=a.devicePixelRatio,k*=a.devicePixelRatio);b.shadowColor=this.shadow.color;b.shadowBlur=this.shadow.blur*(c+k)*(this.scaleX+this.scaleY)/4;b.shadowOffsetX=this.shadow.offsetX*c*this.scaleX;b.shadowOffsetY=this.shadow.offsetY*k*this.scaleY}},_removeShadow:function(b){this.shadow&&(b.shadowColor="",b.shadowBlur=b.shadowOffsetX=b.shadowOffsetY=0)},_renderFill:function(b){this.fill&&(b.save(),this.fill.gradientTransform&&b.transform.apply(b,this.fill.gradientTransform),this.fill.toLive&&b.translate(-this.width/
2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?b.fill("evenodd"):b.fill(),b.restore())},_renderStroke:function(b){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(b),b.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),k?(b.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(b)):this._renderDashedStroke&&this._renderDashedStroke(b),
b.stroke()):(this.stroke.gradientTransform&&b.transform.apply(b,this.stroke.gradientTransform),this._stroke?this._stroke(b):b.stroke()),b.restore())},clone:function(b,c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),b):new a.Object(this.toObject(c))},cloneAsImage:function(b){var c=this.toDataURL();a.util.loadImage(c,function(c){b&&b(new a.Image(c))});return this},toDataURL:function(b){b||(b={});var c=a.util.createCanvasElement(),k=this.getBoundingRect();c.width=k.width;
c.height=k.height;a.util.wrapElement(c,"div");k=new a.StaticCanvas(c);"jpg"===b.format&&(b.format="jpeg");"jpeg"===b.format&&(k.backgroundColor="#fff");var d={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new a.Point(c.width/2,c.height/2),"center","center");c=this.canvas;k.add(this);b=k.toDataURL(b);this.set(d).setCoords();this.canvas=c;k.dispose();return b},isType:function(b){return this.type===b},complexity:function(){return 0},toJSON:function(b){return this.toObject(b)},
setGradient:function(b,c){c||(c={});var k={colorStops:[]};k.type=c.type||(c.r1||c.r2?"radial":"linear");k.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2};if(c.r1||c.r2)k.coords.r1=c.r1,k.coords.r2=c.r2;c.gradientTransform&&(k.gradientTransform=c.gradientTransform);for(var d in c.colorStops){var e=new a.Color(c.colorStops[d]);k.colorStops.push({offset:d,color:e.toRgb(),opacity:e.getAlpha()})}return this.set(b,a.Gradient.forObject(this,k))},setPatternFill:function(b){return this.set("fill",new a.Pattern(b))},
setShadow:function(b){return this.set("shadow",b?new a.Shadow(b):null)},setColor:function(b){this.set("fill",b);return this},setAngle:function(b){var a=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;a&&this._setOriginToCenter();this.set("angle",b);a&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},
remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(b,c){c=c||this.canvas.getPointer(b);var k=new a.Point(c.x,c.y),d=this._getLeftTopCoords();this.angle&&(k=a.util.rotatePoint(k,d,a.util.degreesToRadians(-this.angle)));return{x:k.x-d.x,y:k.y-d.y}},_setupCompositeOperation:function(b){this.globalCompositeOperation&&(b.globalCompositeOperation=this.globalCompositeOperation)}}),a.util.createAccessors(a.Object),a.Object.prototype.rotate=a.Object.prototype.setAngle,e(a.Object.prototype,
a.Observable),a.Object.NUM_FRACTION_DIGITS=2,a.Object.__uid=0)})("undefined"!==typeof p?p:this);(function(){var e=g.util.degreesToRadians,a={left:-.5,center:0,right:.5},d={top:-.5,center:0,bottom:.5};g.util.object.extend(g.Object.prototype,{translateToGivenOrigin:function(c,b,k,f,h){var e=c.x,q=c.y;b=a[f]-a[b];k=d[h]-d[k];if(b||k)q=this._getTransformedDimensions(),e=c.x+b*q.x,q=c.y+k*q.y;return new g.Point(e,q)},translateToCenterPoint:function(a,b,k){b=this.translateToGivenOrigin(a,b,k,"center","center");
return this.angle?g.util.rotatePoint(b,a,e(this.angle)):b},translateToOriginPoint:function(a,b,k){b=this.translateToGivenOrigin(a,"center","center",b,k);return this.angle?g.util.rotatePoint(b,a,e(this.angle)):b},getCenterPoint:function(){var a=new g.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,b){var k=this.getCenterPoint();return this.translateToOriginPoint(k,a,b)},toLocalPoint:function(a,b,k){var f=this.getCenterPoint();b=
b&&k?this.translateToGivenOrigin(f,"center","center",b,k):new g.Point(this.left,this.top);a=new g.Point(a.x,a.y);this.angle&&(a=g.util.rotatePoint(a,f,-e(this.angle)));return a.subtractEquals(b)},setPositionByOrigin:function(a,b,k){a=this.translateToCenterPoint(a,b,k);a=this.translateToOriginPoint(a,this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(c){var b=e(this.angle),k=this.getWidth(),f=Math.cos(b)*k,b=Math.sin(b)*k;this.left+=f*(a[c]-a[this.originX]);
this.top+=b*(a[c]-a[this.originX]);this.setCoords();this.originX=c},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originY=this.originX="center";this.left=a.x;this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=a.x;this.top=a.y;this._originalOriginY=
this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})})();(function(){function e(a){return[new g.Point(a.tl.x,a.tl.y),new g.Point(a.tr.x,a.tr.y),new g.Point(a.br.x,a.br.y),new g.Point(a.bl.x,a.bl.y)]}var a=g.util.degreesToRadians,d=g.util.multiplyTransformMatrices;g.util.object.extend(g.Object.prototype,{oCoords:null,intersectsWithRect:function(a,b){var k=e(this.oCoords);return"Intersection"===g.Intersection.intersectPolygonRectangle(k,
a,b).status},intersectsWithObject:function(a){return"Intersection"===g.Intersection.intersectPolygonPolygon(e(this.oCoords),e(a.oCoords)).status},isContainedWithinObject:function(a){var b=a.getBoundingRect();a=new g.Point(b.left,b.top);b=new g.Point(b.left+b.width,b.top+b.height);return this.isContainedWithinRect(a,b)},isContainedWithinRect:function(a,b){var k=this.getBoundingRect();return k.left>=a.x&&k.left+k.width<=b.x&&k.top>=a.y&&k.top+k.height<=b.y},containsPoint:function(a){var b=this._getImageLines(this.oCoords);
a=this._findCrossPoints(a,b);return 0!==a&&1===a%2},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,b){var k,f,h,d=0,e;for(e in b)if(h=b[e],!(h.o.y<a.y&&h.d.y<a.y||h.o.y>=a.y&&h.d.y>=a.y)&&(h.o.x===h.d.x&&h.o.x>=a.x?k=h.o.x:(k=(h.d.y-h.o.y)/(h.d.x-h.o.x),f=a.y-0*a.x,h=h.o.y-k*h.o.x,k=-(f-h)/(0-k)),k>=a.x&&(d+=1),2===d))break;return d},getBoundingRectWidth:function(){return this.getBoundingRect().width},
getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();return g.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){a=this._constrainScale(a);
0>a&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1);this.scaleY=this.scaleX=a;this.setCoords();return this},scaleToWidth:function(a){var b=this.getBoundingRect().width/this.getWidth();return this.scale(a/this.width/b)},scaleToHeight:function(a){var b=this.getBoundingRect().height/this.getHeight();return this.scale(a/this.height/b)},setCoords:function(){var c=a(this.angle),b=this.getViewportTransform(),k=this._calculateCurrentDimensions(),f=k.x,h=k.y;0>f&&(f=Math.abs(f));var k=Math.sin(c),d=
Math.cos(c),e=0<f?Math.atan(h/f):0,r=f/Math.cos(e)/2,m=Math.cos(e+c)*r,c=Math.sin(e+c)*r,e=g.util.transformPoint(this.getCenterPoint(),b),b=new g.Point(e.x-m,e.y-c),f=new g.Point(b.x+f*d,b.y+f*k),h=new g.Point(b.x-h*k,b.y+h*d),m=new g.Point(e.x+m,e.y+c),c=new g.Point((b.x+h.x)/2,(b.y+h.y)/2),e=new g.Point((f.x+b.x)/2,(f.y+b.y)/2),r=new g.Point((m.x+f.x)/2,(m.y+f.y)/2),u=new g.Point((m.x+h.x)/2,(m.y+h.y)/2),k=new g.Point(e.x+k*this.rotatingPointOffset,e.y-d*this.rotatingPointOffset);this.oCoords={tl:b,
tr:f,br:m,bl:h,ml:c,mt:e,mr:r,mb:u,mtr:k};this._setCornerCoords&&this._setCornerCoords();return this},_calcRotateMatrix:function(){if(this.angle){var c=a(this.angle),b=Math.cos(c),c=Math.sin(c);return[b,c,-c,b,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var a=this.getCenterPoint(),a=[1,0,0,1,a.x,a.y],b=this._calcRotateMatrix(),k=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),f=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0],f=d(f,a),f=d(f,b);return f=d(f,k)},
_calcDimensionsTransformMatrix:function(c,b,k){c=[1,0,Math.tan(a(c)),1];b=[1,Math.tan(a(b)),0,1];k=d([this.scaleX*(k&&this.flipX?-1:1),0,0,this.scaleY*(k&&this.flipY?-1:1)],c,!0);return d(k,b,!0)}})})();g.util.object.extend(g.Object.prototype,{sendToBack:function(){this.group?g.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?g.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);
return this},sendBackwards:function(e){this.group?g.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas.sendBackwards(this,e);return this},bringForward:function(e){this.group?g.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas.bringForward(this,e);return this},moveTo:function(e){this.group?g.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas.moveTo(this,e);return this}});g.util.object.extend(g.Object.prototype,{getSvgStyles:function(e){var a=
this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",d=this.fillRule,c=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",b=this.strokeWidth?this.strokeWidth:"0",k=this.strokeDashArray?this.strokeDashArray.join(" "):"none",f=this.strokeLineCap?this.strokeLineCap:"butt",h=this.strokeLineJoin?this.strokeLineJoin:"miter",n=this.strokeMiterLimit?this.strokeMiterLimit:"4",g="undefined"!==typeof this.opacity?this.opacity:"1",r=this.visible?"":" visibility: hidden;";
e=e?"":this.getSvgFilter();return["stroke: ",c,"; stroke-width: ",b,"; stroke-dasharray: ",k,"; stroke-linecap: ",f,"; stroke-linejoin: ",h,"; stroke-miterlimit: ",n,"; fill: ",a,"; fill-rule: ",d,"; opacity: ",g,";",e,r].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var e=g.util.toFixed,a=this.getAngle(),d=this.getSkewX()%360,c=this.getSkewY()%360,b=this.getCenterPoint(),
k=g.Object.NUM_FRACTION_DIGITS,b="path-group"===this.type?"":"translate("+e(b.x,k)+" "+e(b.y,k)+")",a=0!==a?" rotate("+e(a,k)+")":"",f=1===this.scaleX&&1===this.scaleY?"":" scale("+e(this.scaleX,k)+" "+e(this.scaleY,k)+")",d=0!==d?" skewX("+e(d,k)+")":"",e=0!==c?" skewY("+e(c,k)+")":"",c="path-group"===this.type?this.width:0,k="path-group"===this.type?this.height:0;return[b,a,f,this.flipX?" matrix(-1 0 0 1 "+c+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+k+")":"",d,e].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?
" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var e=[];this.fill&&this.fill.toLive&&e.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&e.push(this.stroke.toSVG(this,!1));this.shadow&&e.push(this.shadow.toSVG(this));return e}});g.util.object.extend(g.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(e){return this.get(e)!==this.originalState[e]},this)},saveState:function(e){this.stateProperties.forEach(function(a){this.originalState[a]=
this.get(a)},this);e&&e.stateProperties&&e.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});(function(){var e=g.util.degreesToRadians;g.util.object.extend(g.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var d=a.x;a=a.y;var c;this.__corner=0;for(var b in this.oCoords)if(this.isControlVisible(b)&&("mtr"!==b||this.hasRotatingPoint)&&
(!this.get("lockUniScaling")||"mt"!==b&&"mr"!==b&&"mb"!==b&&"ml"!==b)&&(c=this._getImageLines(this.oCoords[b].corner),c=this._findCrossPoints({x:d,y:a},c),0!==c&&1===c%2))return this.__corner=b;return!1},_setCornerCoords:function(){var a=this.oCoords,d=e(45-this.angle),c=.707106*this.cornerSize,b=c*Math.cos(d),d=c*Math.sin(d),k,f;for(f in a)c=a[f].x,k=a[f].y,a[f].corner={tl:{x:c-d,y:k-b},tr:{x:c+b,y:k-d},bl:{x:c-b,y:k+d},br:{x:c+d,y:k+b}}},_getNonTransformedDimensions:function(){var a=this.strokeWidth,
d=this.width,c=this.height,b=!0,k=!0;"line"===this.type&&"butt"===this.strokeLineCap&&(k=d,b=c);k&&(c+=0>c?-a:a);b&&(d+=0>d?-a:a);return{x:d,y:c}},_getTransformedDimensions:function(a,d){"undefined"===typeof a&&(a=this.skewX);"undefined"===typeof d&&(d=this.skewY);for(var c=this._getNonTransformedDimensions(),b=c.x/2,c=c.y/2,b=[{x:-b,y:-c},{x:b,y:-c},{x:-b,y:c},{x:b,y:c}],k=this._calcDimensionsTransformMatrix(a,d,!1),c=0;c<b.length;c++)b[c]=g.util.transformPoint(b[c],k);b=g.util.makeBoundingBoxFromPoints(b);
return{x:b.width,y:b.height}},_calculateCurrentDimensions:function(){var a=this.getViewportTransform(),d=this._getTransformedDimensions(),c=d.x,d=d.y,c=c+2*this.padding,d=d+2*this.padding;return g.util.transformPoint(new g.Point(c,d),a,!0)},drawBorders:function(a){if(!this.hasBorders)return this;var d=this._calculateCurrentDimensions(),c=1/this.borderScaleFactor,b=d.x+c,d=d.y+c;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;a.lineWidth=c;a.strokeRect(-b/
2,-d/2,b,d);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(c=-d/2,a.beginPath(),a.moveTo(0,c),a.lineTo(0,c-this.rotatingPointOffset),a.closePath(),a.stroke());a.restore();return this},drawBordersInGroup:function(a,d){if(!this.hasBorders)return this;var c=this._getNonTransformedDimensions(),b=g.util.customTransformMatrix(d.scaleX,d.scaleY,d.skewX),k=g.util.transformPoint(c,b),c=1/this.borderScaleFactor,b=k.x+c+2*this.padding,k=k.y+c+2*this.padding;
a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;a.lineWidth=c;a.strokeRect(-b/2,-k/2,b,k);a.restore();return this},drawControls:function(a){if(!this.hasControls)return this;var d=this._calculateCurrentDimensions(),c=d.x,d=d.y,b=this.cornerSize,k=-(c+b)/2,b=-(d+b)/2,f=this.transparentCorners?"strokeRect":"fillRect";a.save();a.lineWidth=1;a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;this._drawControl("tl",
a,f,k,b);this._drawControl("tr",a,f,k+c,b);this._drawControl("bl",a,f,k,b+d);this._drawControl("br",a,f,k+c,b+d);this.get("lockUniScaling")||(this._drawControl("mt",a,f,k+c/2,b),this._drawControl("mb",a,f,k+c/2,b+d),this._drawControl("mr",a,f,k+c,b+d/2),this._drawControl("ml",a,f,k,b+d/2));this.hasRotatingPoint&&this._drawControl("mtr",a,f,k+c/2,b-this.rotatingPointOffset);a.restore();return this},_drawControl:function(a,d,c,b,k){this.isControlVisible(a)&&(a=this.cornerSize,"undefined"!==typeof G_vmlCanvasManager||
this.transparentCorners||d.clearRect(b,k,a,a),d[c](b,k,a,a))},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,d){this._getControlsVisibility()[a]=d;return this},setControlsVisibility:function(a){a||(a={});for(var d in a)this.setControlVisible(d,a[d]);return this},_getControlsVisibility:function(){this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();g.util.object.extend(g.StaticCanvas.prototype,
{FX_DURATION:500,fxCenterObjectH:function(e,a){a=a||{};var d=function(){},c=a.onComplete||d,b=a.onChange||d,k=this;g.util.animate({startValue:e.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(a){e.set("left",a);k.renderAll();b()},onComplete:function(){e.setCoords();c()}});return this},fxCenterObjectV:function(e,a){a=a||{};var d=function(){},c=a.onComplete||d,b=a.onChange||d,k=this;g.util.animate({startValue:e.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,
onChange:function(a){e.set("top",a);k.renderAll();b()},onComplete:function(){e.setCoords();c()}});return this},fxRemove:function(e,a){a=a||{};var d=function(){},c=a.onComplete||d,b=a.onChange||d,k=this;g.util.animate({startValue:e.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){e.set("active",!1)},onChange:function(a){e.set("opacity",a);k.renderAll();b()},onComplete:function(){k.remove(e);c()}});return this}});g.util.object.extend(g.Object.prototype,{animate:function(){if(arguments[0]&&
"object"===typeof arguments[0]){var e=[],a,d;for(a in arguments[0])e.push(a);for(var c=0,b=e.length;c<b;c++)a=e[c],d=c!==b-1,this._animate(a,arguments[0][a],arguments[1],d)}else this._animate.apply(this,arguments);return this},_animate:function(e,a,d,c){var b=this,k;a=a.toString();d=d?g.util.object.clone(d):{};~e.indexOf(".")&&(k=e.split("."));var f=k?this.get(k[0])[k[1]]:this.get(e);"from"in d||(d.from=f);a=~a.indexOf("=")?f+parseFloat(a.replace("=","")):parseFloat(a);g.util.animate({startValue:d.from,
endValue:a,byValue:d.by,easing:d.easing,duration:d.duration,abort:d.abort&&function(){return d.abort.call(b)},onChange:function(a){k?b[k[0]][k[1]]=a:b.set(e,a);c||d.onChange&&d.onChange()},onComplete:function(){c||(b.setCoords(),d.onComplete&&d.onComplete())}})}});(function(e){function a(b,a){var c=b.origin,k=b.axis1,d=b.axis2,e=b.dimension,g=a.nearest,t=a.center,H=a.farthest;return function(){switch(this.get(c)){case g:return Math.min(this.get(k),this.get(d));case t:return Math.min(this.get(k),this.get(d))+
.5*this.get(e);case H:return Math.max(this.get(k),this.get(d))}}}var d=e.fabric||(e.fabric={}),c=d.util.object.extend,b={x1:1,x2:1,y1:1,y2:1},k=d.StaticCanvas.supports("setLineDash");d.Line?d.warn("fabric.Line is already defined"):(d.Line=d.util.createClass(d.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(b,a){a=a||{};b||(b=[0,0,0,0]);this.callSuper("initialize",a);this.set("x1",b[0]);this.set("y1",b[1]);this.set("x2",b[2]);this.set("y2",b[3]);this._setWidthHeight(a)},_setWidthHeight:function(b){b||
(b={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in b?b.left:this._getLeftToOriginX();this.top="top"in b?b.top:this._getTopToOriginY()},_set:function(a,c){this.callSuper("_set",a,c);"undefined"!==typeof b[a]&&this._setWidthHeight();return this},_getLeftToOriginX:a({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:a({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},
{nearest:"top",center:"center",farthest:"bottom"}),_render:function(b,a){b.beginPath();if(a){var c=this.getCenterPoint();b.translate(c.x-this.strokeWidth/2,c.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&k)c=this.calcLinePoints(),b.moveTo(c.x1,c.y1),b.lineTo(c.x2,c.y2);b.lineWidth=this.strokeWidth;c=b.strokeStyle;b.strokeStyle=this.stroke||b.fillStyle;this.stroke&&this._renderStroke(b);b.strokeStyle=c},_renderDashedStroke:function(b){var a=this.calcLinePoints();b.beginPath();
d.util.drawDashedLine(b,a.x1,a.y1,a.x2,a.y2,this.strokeDashArray);b.closePath()},toObject:function(b){return c(this.callSuper("toObject",b),this.calcLinePoints())},calcLinePoints:function(){var b=this.x1<=this.x2?-1:1,a=this.y1<=this.y2?-1:1;return{x1:b*this.width*.5,x2:b*this.width*-.5,y1:a*this.height*.5,y2:a*this.height*-.5}},toSVG:function(b){var a=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&"path-group"===this.group.type||(c=this.calcLinePoints());
a.push("<line ",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return b?b(a.join("")):a.join("")},complexity:function(){return 1}}),d.Line.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),d.Line.fromElement=function(b,a){var k=d.parseAttributes(b,d.Line.ATTRIBUTE_NAMES);return new d.Line([k.x1||0,k.y1||0,k.x2||0,k.y2||0],c(k,a))},d.Line.fromObject=function(b){return new d.Line([b.x1,
b.y1,b.x2,b.y2],b)})})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=Math.PI,c=a.util.object.extend;a.Circle?a.warn("fabric.Circle is already defined."):(a.Circle=a.util.createClass(a.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*d,initialize:function(b){b=b||{};this.callSuper("initialize",b);this.set("radius",b.radius||0);this.startAngle=b.startAngle||this.startAngle;this.endAngle=b.endAngle||this.endAngle},_set:function(b,a){this.callSuper("_set",b,a);"radius"===
b&&this.setRadius(a);return this},toObject:function(b){return c(this.callSuper("toObject",b),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(b){var a=this._createBaseSVGMarkup(),f=0,c=0,e=(this.endAngle-this.startAngle)%(2*d);if(0===e)this.group&&"path-group"===this.group.type&&(f=this.left+this.radius,c=this.top+this.radius),a.push("<circle ",'cx="'+f+'" cy="'+c+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),
" ",this.getSvgTransformMatrix(),'"/>\n');else{var f=Math.cos(this.startAngle)*this.radius,c=Math.sin(this.startAngle)*this.radius,g=Math.cos(this.endAngle)*this.radius,r=Math.sin(this.endAngle)*this.radius;a.push('<path d="M '+f+" "+c," A "+this.radius+" "+this.radius," 0 ",+(e>d?1:0)+" 1"," "+g+" "+r,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return b?b(a.join("")):a.join("")},_render:function(b,a){b.beginPath();b.arc(a?this.left+
this.radius:0,a?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(b);this._renderStroke(b)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(b){this.radius=b;return this.set("width",2*b).set("height",2*b)},complexity:function(){return 1}}),a.Circle.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),a.Circle.fromElement=function(b,k){k||(k={});var f=
a.parseAttributes(b,a.Circle.ATTRIBUTE_NAMES);if(!("radius"in f&&0<=f.radius))throw Error("value of `r` attribute is required and can not be negative");f.left=f.left||0;f.top=f.top||0;f=new a.Circle(c(f,k));f.left-=f.radius;f.top-=f.radius;return f},a.Circle.fromObject=function(b){return new a.Circle(b)})})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={});a.Triangle?a.warn("fabric.Triangle is already defined"):(a.Triangle=a.util.createClass(a.Object,{type:"triangle",initialize:function(a){a=
a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var c=this.width/2,b=this.height/2;a.beginPath();a.moveTo(-c,b);a.lineTo(0,-b);a.lineTo(c,b);a.closePath();this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(d){var c=this.width/2,b=this.height/2;d.beginPath();a.util.drawDashedLine(d,-c,b,0,-b,this.strokeDashArray);a.util.drawDashedLine(d,0,-b,c,b,this.strokeDashArray);a.util.drawDashedLine(d,c,b,-c,b,this.strokeDashArray);
d.closePath()},toSVG:function(a){var c=this._createBaseSVGMarkup(),b=this.width/2,k=this.height/2,b=[-b+" "+k,"0 "+-k,b+" "+k].join();c.push("<polygon ",'points="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(c.join("")):c.join("")},complexity:function(){return 1}}),a.Triangle.fromObject=function(d){return new a.Triangle(d)})})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=2*Math.PI,c=a.util.object.extend;a.Ellipse?a.warn("fabric.Ellipse is already defined."):
(a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",rx:0,ry:0,initialize:function(b){b=b||{};this.callSuper("initialize",b);this.set("rx",b.rx||0);this.set("ry",b.ry||0)},_set:function(b,a){this.callSuper("_set",b,a);switch(b){case "rx":this.rx=a;this.set("width",2*a);break;case "ry":this.ry=a,this.set("height",2*a)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(b){return c(this.callSuper("toObject",
b),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(b){var a=this._createBaseSVGMarkup(),f=0,c=0;this.group&&"path-group"===this.group.type&&(f=this.left+this.rx,c=this.top+this.ry);a.push("<ellipse ",'cx="',f,'" cy="',c,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return b?b(a.join("")):a.join("")},_render:function(b,a){b.beginPath();b.save();b.transform(1,0,0,this.ry/this.rx,0,0);b.arc(a?this.left+
this.rx:0,a?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,d,!1);b.restore();this._renderFill(b);this._renderStroke(b)},complexity:function(){return 1}}),a.Ellipse.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),a.Ellipse.fromElement=function(b,k){k||(k={});var f=a.parseAttributes(b,a.Ellipse.ATTRIBUTE_NAMES);f.left=f.left||0;f.top=f.top||0;f=new a.Ellipse(c(f,k));f.top-=f.ry;f.left-=f.rx;return f},a.Ellipse.fromObject=function(b){return new a.Ellipse(b)})})("undefined"!==typeof p?
p:this);(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Rect?a.warn("fabric.Rect is already defined"):(e=a.Object.prototype.stateProperties.concat(),e.push("rx","ry","x","y"),a.Rect=a.util.createClass(a.Object,{stateProperties:e,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{};this.callSuper("initialize",a);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a,b){if(1===this.width&&
1===this.height)a.fillRect(-.5,-.5,1,1);else{var k=this.rx?Math.min(this.rx,this.width/2):0,f=this.ry?Math.min(this.ry,this.height/2):0,h=this.width,d=this.height,e=b?this.left:-this.width/2,g=b?this.top:-this.height/2,m=0!==k||0!==f;a.beginPath();a.moveTo(e+k,g);a.lineTo(e+h-k,g);m&&a.bezierCurveTo(e+h-.4477152502*k,g,e+h,g+.4477152502*f,e+h,g+f);a.lineTo(e+h,g+d-f);m&&a.bezierCurveTo(e+h,g+d-.4477152502*f,e+h-.4477152502*k,g+d,e+h-k,g+d);a.lineTo(e+k,g+d);m&&a.bezierCurveTo(e+.4477152502*k,g+d,
e,g+d-.4477152502*f,e,g+d-f);a.lineTo(e,g+f);m&&a.bezierCurveTo(e,g+.4477152502*f,e+.4477152502*k,g,e+k,g);a.closePath();this._renderFill(a);this._renderStroke(a)}},_renderDashedStroke:function(c){var b=-this.width/2,k=-this.height/2,f=this.width,h=this.height;c.beginPath();a.util.drawDashedLine(c,b,k,b+f,k,this.strokeDashArray);a.util.drawDashedLine(c,b+f,k,b+f,k+h,this.strokeDashArray);a.util.drawDashedLine(c,b+f,k+h,b,k+h,this.strokeDashArray);a.util.drawDashedLine(c,b,k+h,b,k,this.strokeDashArray);
c.closePath()},toObject:function(a){a=d(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=this._createBaseSVGMarkup(),k=this.left,f=this.top;this.group&&"path-group"===this.group.type||(k=-this.width/2,f=-this.height/2);b.push("<rect ",'x="',k,'" y="',f,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',
this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),a.Rect.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),a.Rect.fromElement=function(c,b){if(!c)return null;b=b||{};var k=a.parseAttributes(c,a.Rect.ATTRIBUTE_NAMES);k.left=k.left||0;k.top=k.top||0;k=new a.Rect(d(b?a.util.object.clone(b):{},k));k.visible=0<k.width&&0<k.height;return k},a.Rect.fromObject=function(c){return new a.Rect(c)})})("undefined"!==
typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={});a.Polyline?a.warn("fabric.Polyline is already defined"):(a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(d,c){return a.Polygon.prototype.initialize.call(this,d,c)},_calcDimensions:function(){return a.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return a.Polygon.prototype._applyPointOffset.call(this)},toObject:function(d){return a.Polygon.prototype.toObject.call(this,
d)},toSVG:function(d){return a.Polygon.prototype.toSVG.call(this,d)},_render:function(d){a.Polygon.prototype.commonRender.call(this,d)&&(this._renderFill(d),this._renderStroke(d))},_renderDashedStroke:function(d){var c,b;d.beginPath();for(var k=0,f=this.points.length;k<f;k++)c=this.points[k],b=this.points[k+1]||c,a.util.drawDashedLine(d,c.x,c.y,b.x,b.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),a.Polyline.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polyline.fromElement=
function(d,c){if(!d)return null;c||(c={});var b=a.parsePointsAttribute(d.getAttribute("points")),k=a.parseAttributes(d,a.Polyline.ATTRIBUTE_NAMES);return new a.Polyline(b,a.util.object.extend(k,c))},a.Polyline.fromObject=function(d){return new a.Polyline(d.points,d,!0)})})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend,c=a.util.array.min,b=a.util.array.max,k=a.util.toFixed;a.Polygon?a.warn("fabric.Polygon is already defined"):(a.Polygon=a.util.createClass(a.Object,
{type:"polygon",points:null,minX:0,minY:0,initialize:function(b,a){a=a||{};this.points=b||[];this.callSuper("initialize",a);this._calcDimensions();"top"in a||(this.top=this.minY);"left"in a||(this.left=this.minX);this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var a=this.points,h=c(a,"x"),k=c(a,"y"),d=b(a,"x"),a=b(a,"y");this.width=d-h||0;this.height=a-k||0;this.minX=h||0;this.minY=k||0},toObject:function(b){return d(this.callSuper("toObject",b),{points:this.points.concat()})},
toSVG:function(b){for(var a=[],c,d=this._createBaseSVGMarkup(),e=0,m=this.points.length;e<m;e++)a.push(k(this.points[e].x,2),",",k(this.points[e].y,2)," ");this.group&&"path-group"===this.group.type||(c=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");d.push("<",this.type," ",'points="',a.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),c," ",this.getSvgTransformMatrix(),'"/>\n');return b?b(d.join("")):d.join("")},_render:function(b,a){this.commonRender(b,
a)&&(this._renderFill(b),this.stroke||this.strokeDashArray)&&(b.closePath(),this._renderStroke(b))},commonRender:function(b,a){var c,k=this.points.length;if(!k||isNaN(this.points[k-1].y))return!1;a||b.translate(-this.pathOffset.x,-this.pathOffset.y);b.beginPath();b.moveTo(this.points[0].x,this.points[0].y);for(var d=0;d<k;d++)c=this.points[d],b.lineTo(c.x,c.y);return!0},_renderDashedStroke:function(b){a.Polyline.prototype._renderDashedStroke.call(this,b);b.closePath()},complexity:function(){return this.points.length}}),
a.Polygon.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polygon.fromElement=function(b,c){if(!b)return null;c||(c={});var k=a.parsePointsAttribute(b.getAttribute("points")),e=a.parseAttributes(b,a.Polygon.ATTRIBUTE_NAMES);return new a.Polygon(k,d(e,c))},a.Polygon.fromObject=function(b){return new a.Polygon(b.points,b,!0)})})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=a.util.array.min,c=a.util.array.max,b=a.util.object.extend,k=Object.prototype.toString,f=a.util.drawArc,
h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},n={m:"l",M:"L"};a.Path?a.warn("fabric.Path is already defined"):(a.Path=a.util.createClass(a.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(b,a){a=a||{};this.setOptions(a);b||(b=[]);var f="[object Array]"===k.call(b);if(this.path=f?b:b.match&&b.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))f||(this.path=this._parsePath()),this._setPositionDimensions(a),a.sourcePath&&this.setSourcePath(a.sourcePath)},_setPositionDimensions:function(b){var a=this._parseDimensions();
this.minX=a.left;this.minY=a.top;this.width=a.width;this.height=a.height;"undefined"===typeof b.left&&(this.left=a.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0));"undefined"===typeof b.top&&(this.top=a.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0));this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(b){var a,c=null,h=0,k=0,d=0,e=0,n=0,g=0,l,D,y=-this.pathOffset.x,B=-this.pathOffset.y;
this.group&&"path-group"===this.group.type&&(B=y=0);b.beginPath();for(var x=0,w=this.path.length;x<w;++x){a=this.path[x];switch(a[0]){case "l":d+=a[1];e+=a[2];b.lineTo(d+y,e+B);break;case "L":d=a[1];e=a[2];b.lineTo(d+y,e+B);break;case "h":d+=a[1];b.lineTo(d+y,e+B);break;case "H":d=a[1];b.lineTo(d+y,e+B);break;case "v":e+=a[1];b.lineTo(d+y,e+B);break;case "V":e=a[1];b.lineTo(d+y,e+B);break;case "m":d+=a[1];e+=a[2];h=d;k=e;b.moveTo(d+y,e+B);break;case "M":d=a[1];e=a[2];h=d;k=e;b.moveTo(d+y,e+B);break;
case "c":l=d+a[5];D=e+a[6];n=d+a[3];g=e+a[4];b.bezierCurveTo(d+a[1]+y,e+a[2]+B,n+y,g+B,l+y,D+B);d=l;e=D;break;case "C":d=a[5];e=a[6];n=a[3];g=a[4];b.bezierCurveTo(a[1]+y,a[2]+B,n+y,g+B,d+y,e+B);break;case "s":l=d+a[3];D=e+a[4];null===c[0].match(/[CcSs]/)?(n=d,g=e):(n=2*d-n,g=2*e-g);b.bezierCurveTo(n+y,g+B,d+a[1]+y,e+a[2]+B,l+y,D+B);n=d+a[1];g=e+a[2];d=l;e=D;break;case "S":l=a[3];D=a[4];null===c[0].match(/[CcSs]/)?(n=d,g=e):(n=2*d-n,g=2*e-g);b.bezierCurveTo(n+y,g+B,a[1]+y,a[2]+B,l+y,D+B);d=l;e=D;n=
a[1];g=a[2];break;case "q":l=d+a[3];D=e+a[4];n=d+a[1];g=e+a[2];b.quadraticCurveTo(n+y,g+B,l+y,D+B);d=l;e=D;break;case "Q":l=a[3];D=a[4];b.quadraticCurveTo(a[1]+y,a[2]+B,l+y,D+B);d=l;e=D;n=a[1];g=a[2];break;case "t":l=d+a[1];D=e+a[2];null===c[0].match(/[QqTt]/)?(n=d,g=e):(n=2*d-n,g=2*e-g);b.quadraticCurveTo(n+y,g+B,l+y,D+B);d=l;e=D;break;case "T":l=a[1];D=a[2];null===c[0].match(/[QqTt]/)?(n=d,g=e):(n=2*d-n,g=2*e-g);b.quadraticCurveTo(n+y,g+B,l+y,D+B);d=l;e=D;break;case "a":f(b,d+y,e+B,[a[1],a[2],a[3],
a[4],a[5],a[6]+d+y,a[7]+e+B]);d+=a[6];e+=a[7];break;case "A":f(b,d+y,e+B,[a[1],a[2],a[3],a[4],a[5],a[6]+y,a[7]+B]);d=a[6];e=a[7];break;case "z":case "Z":d=h,e=k,b.closePath()}c=a}this._renderFill(b);this._renderStroke(b)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){a=b(this.callSuper("toObject",a),{path:this.path.map(function(b){return b.slice()}),pathOffset:this.pathOffset});this.sourcePath&&(a.sourcePath=
this.sourcePath);this.transformMatrix&&(a.transformMatrix=this.transformMatrix);return a},toDatalessObject:function(b){b=this.toObject(b);this.sourcePath&&(b.path=this.sourcePath);delete b.sourcePath;return b},toSVG:function(b){for(var a=[],f=this._createBaseSVGMarkup(),c="",h=0,k=this.path.length;h<k;h++)a.push(this.path[h].join(" "));a=a.join(" ");this.group&&"path-group"===this.group.type||(c=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");f.push("<path ",'d="',a,'" style="',this.getSvgStyles(),
'" transform="',this.getSvgTransform(),c,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return b?b(f.join("")):f.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var b=[],a=[],f,c,k=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,d,e=0,g=this.path.length;e<g;e++){f=this.path[e];d=f.slice(1).trim();for(a.length=0;c=k.exec(d);)a.push(c[0]);f=[f.charAt(0)];d=0;for(var J=a.length;d<J;d++)c=parseFloat(a[d]),isNaN(c)||f.push(c);c=f[0];d=h[c.toLowerCase()];
J=n[c]||c;if(f.length-1>d)for(var l=1,D=f.length;l<D;l+=d)b.push([c].concat(f.slice(l,l+d))),c=J;else b.push(f)}return b},_parseDimensions:function(){for(var b=[],f=[],h,k=null,e=0,n=0,g=0,z=0,J=0,l=0,D,y,B,x=0,w=this.path.length;x<w;++x){h=this.path[x];switch(h[0]){case "l":g+=h[1];z+=h[2];B=[];break;case "L":g=h[1];z=h[2];B=[];break;case "h":g+=h[1];B=[];break;case "H":g=h[1];B=[];break;case "v":z+=h[1];B=[];break;case "V":z=h[1];B=[];break;case "m":g+=h[1];z+=h[2];e=g;n=z;B=[];break;case "M":g=
h[1];z=h[2];e=g;n=z;B=[];break;case "c":D=g+h[5];y=z+h[6];J=g+h[3];l=z+h[4];B=a.util.getBoundsOfCurve(g,z,g+h[1],z+h[2],J,l,D,y);g=D;z=y;break;case "C":g=h[5];z=h[6];J=h[3];l=h[4];B=a.util.getBoundsOfCurve(g,z,h[1],h[2],J,l,g,z);break;case "s":D=g+h[3];y=z+h[4];null===k[0].match(/[CcSs]/)?(J=g,l=z):(J=2*g-J,l=2*z-l);B=a.util.getBoundsOfCurve(g,z,J,l,g+h[1],z+h[2],D,y);J=g+h[1];l=z+h[2];g=D;z=y;break;case "S":D=h[3];y=h[4];null===k[0].match(/[CcSs]/)?(J=g,l=z):(J=2*g-J,l=2*z-l);B=a.util.getBoundsOfCurve(g,
z,J,l,h[1],h[2],D,y);g=D;z=y;J=h[1];l=h[2];break;case "q":D=g+h[3];y=z+h[4];J=g+h[1];l=z+h[2];B=a.util.getBoundsOfCurve(g,z,J,l,J,l,D,y);g=D;z=y;break;case "Q":J=h[1];l=h[2];B=a.util.getBoundsOfCurve(g,z,J,l,J,l,h[3],h[4]);g=h[3];z=h[4];break;case "t":D=g+h[1];y=z+h[2];null===k[0].match(/[QqTt]/)?(J=g,l=z):(J=2*g-J,l=2*z-l);B=a.util.getBoundsOfCurve(g,z,J,l,J,l,D,y);g=D;z=y;break;case "T":D=h[1];y=h[2];null===k[0].match(/[QqTt]/)?(J=g,l=z):(J=2*g-J,l=2*z-l);B=a.util.getBoundsOfCurve(g,z,J,l,J,l,D,
y);g=D;z=y;break;case "a":B=a.util.getBoundsOfArc(g,z,h[1],h[2],h[3],h[4],h[5],h[6]+g,h[7]+z);g+=h[6];z+=h[7];break;case "A":B=a.util.getBoundsOfArc(g,z,h[1],h[2],h[3],h[4],h[5],h[6],h[7]);g=h[6];z=h[7];break;case "z":case "Z":g=e,z=n}k=h;B.forEach(function(a){b.push(a.x);f.push(a.y)});b.push(g);f.push(z)}h=d(b)||0;k=d(f)||0;e=c(b)||0;n=c(f)||0;return{left:h,top:k,width:e-h,height:n-k}}}),a.Path.fromObject=function(b,f){"string"===typeof b.path?a.loadSVGFromURL(b.path,function(c){c=c[0];var h=b.path;
delete b.path;a.util.object.extend(c,b);c.setSourcePath(h);f(c)}):f(new a.Path(b.path,b))},a.Path.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["d"]),a.Path.fromElement=function(f,c,h){f=a.parseAttributes(f,a.Path.ATTRIBUTE_NAMES);c&&c(new a.Path(f.d,b(f,h)))},a.Path.async=!0)})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend,c=a.util.array.invoke,b=a.Object.prototype.toObject;a.PathGroup?a.warn("fabric.PathGroup is already defined"):(a.PathGroup=a.util.createClass(a.Path,
{type:"path-group",fill:"",initialize:function(b,a){a=a||{};this.paths=b||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;a.toBeParsed&&(this.parseDimensionsFromPaths(a),delete a.toBeParsed);this.setOptions(a);this.setCoords();a.sourcePath&&this.setSourcePath(a.sourcePath)},parseDimensionsFromPaths:function(b){for(var f,c,d=[],e=[],g,m=this.paths.length;m--;){f=this.paths[m];c=f.height+f.strokeWidth;g=f.width+f.strokeWidth;f=[{x:f.left,y:f.top},{x:f.left+g,y:f.top},{x:f.left,y:f.top+
c},{x:f.left+g,y:f.top+c}];g=this.paths[m].transformMatrix;for(var u=0;u<f.length;u++)c=f[u],g&&(c=a.util.transformPoint(c,g,!1)),d.push(c.x),e.push(c.y)}b.width=Math.max.apply(null,d);b.height=Math.max.apply(null,e)},render:function(b){if(this.visible){b.save();this.transformMatrix&&b.transform.apply(b,this.transformMatrix);this.transform(b);this._setShadow(b);this.clipTo&&a.util.clipContext(this,b);b.translate(-this.width/2,-this.height/2);for(var f=0,c=this.paths.length;f<c;++f)this.paths[f].render(b,
!0);this.clipTo&&b.restore();b.restore()}},_set:function(b,a){if("fill"===b&&a&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(b,a);return this.callSuper("_set",b,a)},toObject:function(a){a=d(b.call(this,a),{paths:c(this.getObjects(),"toObject",a)});this.sourcePath&&(a.sourcePath=this.sourcePath);return a},toDatalessObject:function(b){b=this.toObject(b);this.sourcePath&&(b.paths=this.sourcePath);return b},toSVG:function(b){var a=this.getObjects(),c=this.getPointByOrigin("left",
"top"),d="translate("+c.x+" "+c.y+")",c=this._createBaseSVGMarkup();c.push("<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),d,this.getSvgTransform(),'" ',">\n");for(var d=0,e=a.length;d<e;d++)c.push("\t",a[d].toSVG(b));c.push("</g>\n");return b?b(c.join("")):c.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var b=this.getObjects()[0].get("fill")||"";if("string"!==
typeof b)return!1;b=b.toLowerCase();return this.getObjects().every(function(a){a=a.get("fill")||"";return"string"===typeof a&&a.toLowerCase()===b})},complexity:function(){return this.paths.reduce(function(b,a){return b+(a&&a.complexity?a.complexity():0)},0)},getObjects:function(){return this.paths}}),a.PathGroup.fromObject=function(b,f){"string"===typeof b.paths?a.loadSVGFromURL(b.paths,function(c){var d=b.paths;delete b.paths;c=a.util.groupSVGElements(c,b,d);f(c)}):a.util.enlivenObjects(b.paths,
function(c){delete b.paths;f(new a.PathGroup(c,b))})},a.PathGroup.async=!0)})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend,c=a.util.array.min,b=a.util.array.max,k=a.util.array.invoke;if(!a.Group){var f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};a.Group=a.util.createClass(a.Object,a.Collection,{type:"group",strokeWidth:0,initialize:function(b,a,f){a=a||{};this._objects=[];f&&this.callSuper("initialize",
a);this._objects=b||[];for(b=this._objects.length;b--;)this._objects[b].group=this;this.originalState={};a.originX&&(this.originX=a.originX);a.originY&&(this.originY=a.originY);f?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",a));this.setCoords();this.saveCoords()},_updateObjectsCoords:function(b){for(var a=this._objects.length;a--;)this._updateObjectCoords(this._objects[a],b)},_updateObjectCoords:function(b,a){b.__origHasControls=b.hasControls;
b.hasControls=!1;if(!a){var f=b.getLeft(),c=b.getTop(),k=this.getCenterPoint();b.set({originalLeft:f,originalTop:c,left:f-k.x,top:c-k.y});b.setCoords()}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(b){this._restoreObjectsState();a.util.resetObjectTransform(this);b&&(this._objects.push(b),b.group=this,b._set("canvas",this.canvas));this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(b){b.set("active",
!0);b.group=this},removeWithUpdate:function(b){this._restoreObjectsState();a.util.resetObjectTransform(this);this.forEachObject(this._setObjectActive,this);this.remove(b);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(b){b.group=this;b._set("canvas",this.canvas)},_onObjectRemoved:function(b){delete b.group;b.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,
textAlign:!0,backgroundColor:!0},_set:function(b,a){var f=this._objects.length;if(this.delegatedProperties[b]||"canvas"===b)for(;f--;)this._objects[f].set(b,a);else for(;f--;)this._objects[f].setOnGroup(b,a);this.callSuper("_set",b,a)},toObject:function(b){return d(this.callSuper("toObject",b),{objects:k(this._objects,"toObject",b)})},render:function(b){if(this.visible){b.save();this.transformMatrix&&b.transform.apply(b,this.transformMatrix);this.transform(b);this._setShadow(b);this.clipTo&&a.util.clipContext(this,
b);for(var f=0,c=this._objects.length;f<c;f++)this._renderObject(this._objects[f],b);this.clipTo&&b.restore();b.restore()}},_renderControls:function(b,a){this.callSuper("_renderControls",b,a);for(var f=0,c=this._objects.length;f<c;f++)this._objects[f]._renderControls(b)},_renderObject:function(b,a){if(b.visible){var f=b.hasRotatingPoint;b.hasRotatingPoint=!1;b.render(a);b.hasRotatingPoint=f}},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(b){var f=
b.calcTransformMatrix(),f=a.util.qrDecompose(f),c=new a.Point(f.translateX,f.translateY);b.scaleX=f.scaleX;b.scaleY=f.scaleY;b.skewX=f.skewX;b.skewY=f.skewY;b.angle=f.angle;b.flipX=!1;b.flipY=!1;b.setPositionByOrigin(c,"center","center");return b},_restoreObjectState:function(b){this.realizeTransform(b);b.setCoords();b.hasControls=b.__origHasControls;delete b.__origHasControls;b.set("active",!1);delete b.group;return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=
this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(b){b.setCoords()});return this},_calcBounds:function(b){for(var a=[],f=[],c,k,d=["tr","br","bl","tl"],e=0,g=this._objects.length,F,z=d.length;e<g;++e)for(c=this._objects[e],c.setCoords(),F=0;F<z;F++)k=d[F],a.push(c.oCoords[k].x),f.push(c.oCoords[k].y);this.set(this._getBounds(a,
f,b))},_getBounds:function(f,k,d){var e=a.util.invertTransform(this.getViewportTransform()),m=a.util.transformPoint(new a.Point(c(f),c(k)),e);f=a.util.transformPoint(new a.Point(b(f),b(k)),e);f={width:f.x-m.x||0,height:f.y-m.y||0};d||(f.left=m.x||0,f.top=m.y||0,"center"===this.originX&&(f.left+=f.width/2),"right"===this.originX&&(f.left+=f.width),"center"===this.originY&&(f.top+=f.height/2),"bottom"===this.originY&&(f.top+=f.height));return f},toSVG:function(b){var a=this._createBaseSVGMarkup();a.push('<g transform="',
this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var f=0,c=this._objects.length;f<c;f++)a.push("\t",this._objects[f].toSVG(b));a.push("</g>\n");return b?b(a.join("")):a.join("")},get:function(b){if(b in f){if(this[b])return this[b];for(var a=0,c=this._objects.length;a<c;a++)if(this._objects[a][b])return!0;return!1}return b in this.delegatedProperties?this._objects[0]&&this._objects[0].get(b):this[b]}});a.Group.fromObject=function(b,f){a.util.enlivenObjects(b.objects,
function(c){delete b.objects;f&&f(new a.Group(c,b,!0))})};a.Group.async=!0}})("undefined"!==typeof p?p:this);(function(e){var a=g.util.object.extend;e.fabric||(e.fabric={});e.fabric.Image?g.warn("fabric.Image is already defined."):(g.Image=g.util.createClass(g.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,initialize:function(a,c){c||(c={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",c);this._initElement(a,
c)},getElement:function(){return this._element},setElement:function(a,c,b){this._originalElement=this._element=a;this._initConfig(b);0!==this.filters.length?this.applyFilters(c):c&&c();return this},setCrossOrigin:function(a){this.crossOrigin=a;this._element.crossOrigin=a;return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){a.save();this._setStrokeStyles(a);a.beginPath();a.strokeRect(-this.width/2,-this.height/2,this.width,this.height);
a.closePath();a.restore()},_renderDashedStroke:function(a){var c=-this.width/2,b=-this.height/2,k=this.width,f=this.height;a.save();this._setStrokeStyles(a);a.beginPath();g.util.drawDashedLine(a,c,b,c+k,b,this.strokeDashArray);g.util.drawDashedLine(a,c+k,b,c+k,b+f,this.strokeDashArray);g.util.drawDashedLine(a,c+k,b+f,c,b+f,this.strokeDashArray);g.util.drawDashedLine(a,c,b+f,c,b,this.strokeDashArray);a.closePath();a.restore()},toObject:function(d){var c=[];this.filters.forEach(function(b){b&&c.push(b.toObject())});
d=a(this.callSuper("toObject",d),{src:this._originalElement.src||this._originalElement._src,filters:c,crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice});0<this.resizeFilters.length&&(d.resizeFilters=this.resizeFilters.map(function(b){return b&&b.toObject()}));this.includeDefaultValues||this._removeDefaultValues(d);return d},toSVG:function(a){var c=this._createBaseSVGMarkup(),b=-this.width/2,k=-this.height/2,f="none";this.group&&"path-group"===this.group.type&&
(b=this.left,k=this.top);"none"!==this.alignX&&"none"!==this.alignY&&(f="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);c.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',b,'" y="',k,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',f,'"',"></image>\n");if(this.stroke||this.strokeDashArray)f=this.fill,this.fill=null,c.push("<rect ",'x="',b,'" y="',k,'" width="',
this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=f;c.push("</g>\n");return a?a(c.join("")):c.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(a,c,b){g.util.loadImage(a,function(a){return this.setElement(a,c,b)},this,b&&b.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,c){this.constructor.fromObject(this.toObject(c),a)},applyFilters:function(a,
c,b,k){c=c||this.filters;if(b=b||this._originalElement){var f=b,h=g.util.createCanvasElement(),e=g.util.createImage(),q=this;h.width=f.width;h.height=f.height;h.getContext("2d").drawImage(f,0,0,f.width,f.height);if(0===c.length)return this._element=b,a&&a(),h;c.forEach(function(b){b&&b.applyTo(h,b.scaleX||q.scaleX,b.scaleY||q.scaleY);!k&&b&&"Resize"===b.type&&(q.width*=b.scaleX,q.height*=b.scaleY)});e.width=h.width;e.height=h.height;g.isLikelyNode?(e.src=h.toBuffer(v,g.Image.pngCompression),q._element=
e,!k&&(q._filteredEl=e),a&&a()):(e.onload=function(){q._element=e;!k&&(q._filteredEl=e);a&&a();e.onload=h=f=null},e.src=h.toDataURL("image/png"));return h}},_render:function(a,c){var b,k,f=this._findMargins(),h;b=c?this.left:-this.width/2;k=c?this.top:-this.height/2;"slice"===this.meetOrSlice&&(a.beginPath(),a.rect(b,k,this.width,this.height),a.clip());!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,h=this.applyFilters(null,
this.resizeFilters,this._filteredEl||this._originalElement,!0)):h=this._element;h&&a.drawImage(h,b+f.marginX,k+f.marginY,f.width,f.height);this._renderStroke(a)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var a=this.width,c=this.height,b=0,k=0;if("none"!==this.alignX||"none"!==this.alignY)a=[this.width/this._element.width,this.height/this._element.height],c="meet"===this.meetOrSlice?Math.min.apply(null,a):Math.max.apply(null,
a),a=this._element.width*c,c*=this._element.height,"Mid"===this.alignX&&(b=(this.width-a)/2),"Max"===this.alignX&&(b=this.width-a),"Mid"===this.alignY&&(k=(this.height-c)/2),"Max"===this.alignY&&(k=this.height-c);return{width:a,height:c,marginX:b,marginY:k}},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",a.height)},_initElement:function(a,c){this.setElement(g.util.getById(a),null,c);g.util.addClass(this.getElement(),g.Image.CSS_CANVAS)},_initConfig:function(a){a||
(a={});this.setOptions(a);this._setWidthHeight(a);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(a,c){a&&a.length?g.util.enlivenObjects(a,function(b){c&&c(b)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0;this.height="height"in a?a.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),g.Image.CSS_CANVAS="canvas-img",g.Image.prototype.getSvgSrc=
g.Image.prototype.getSrc,g.Image.fromObject=function(a,c){g.util.loadImage(a.src,function(b){g.Image.prototype._initFilters.call(a,a.filters,function(k){a.filters=k||[];g.Image.prototype._initFilters.call(a,a.resizeFilters,function(f){a.resizeFilters=f||[];f=new g.Image(b,a);c&&c(f)})})},null,a.crossOrigin)},g.Image.fromURL=function(a,c,b){g.util.loadImage(a,function(a){c&&c(new g.Image(a,b))},null,b&&b.crossOrigin)},g.Image.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),
g.Image.fromElement=function(d,c,b){d=g.parseAttributes(d,g.Image.ATTRIBUTE_NAMES);var k;d.preserveAspectRatio&&(k=g.util.parsePreserveAspectRatioAttribute(d.preserveAspectRatio),a(d,k));g.Image.fromURL(d["xlink:href"],c,a(b?g.util.object.clone(b):{},d))},g.Image.async=!0,g.Image.pngCompression=1)})("undefined"!==typeof p?p:this);g.util.object.extend(g.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.getAngle()%360;return 0<e?90*Math.round((e-1)/90):90*Math.round(e/90)},straighten:function(){this.setAngle(this._getAngleValueForStraighten());
return this},fxStraighten:function(e){e=e||{};var a=function(){},d=e.onComplete||a,c=e.onChange||a,b=this;g.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){b.setAngle(a);c()},onComplete:function(){b.setCoords();d()},onStart:function(){b.set("active",!1)}});return this}});g.util.object.extend(g.StaticCanvas.prototype,{straightenObject:function(e){e.straighten();this.renderAll();return this},fxStraightenObject:function(e){e.fxStraighten({onChange:this.renderAll.bind(this)});
return this}});g.Image.filters=g.Image.filters||{};g.Image.filters.BaseFilter=g.util.createClass({type:"BaseFilter",initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var a in e)this[a]=e[a]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Brightness=a.util.createClass(a.Image.filters.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{};this.brightness=
a.brightness||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var k=a.data,f=this.brightness,h=0,d=k.length;h<d;h+=4)k[h]+=f,k[h+1]+=f,k[h+2]+=f;b.putImageData(a,0,0)},toObject:function(){return d(this.callSuper("toObject"),{brightness:this.brightness})}});a.Image.filters.Brightness.fromObject=function(c){return new a.Image.filters.Brightness(c)}})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Convolute=
a.util.createClass(a.Image.filters.BaseFilter,{type:"Convolute",initialize:function(a){a=a||{};this.opaque=a.opaque;this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(a){var b=this.matrix,k=a.getContext("2d"),f=k.getImageData(0,0,a.width,a.height);a=Math.round(Math.sqrt(b.length));for(var h=Math.floor(a/2),d=f.data,e=f.width,f=f.height,g=k.createImageData(e,f),m=g.data,u=this.opaque?1:0,t,H,F,z,J,l,D,y=0;y<f;y++)for(var B=0;B<e;B++){J=4*(y*e+B);for(var x=z=F=H=t=0;x<a;x++)for(var w=0;w<a;w++)D=
y+x-h,l=B+w-h,0>D||D>f||0>l||l>e||(l=4*(D*e+l),D=b[x*a+w],t+=d[l]*D,H+=d[l+1]*D,F+=d[l+2]*D,z+=d[l+3]*D);m[J]=t;m[J+1]=H;m[J+2]=F;m[J+3]=z+u*(255-z)}k.putImageData(g,0,0)},toObject:function(){return d(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});a.Image.filters.Convolute.fromObject=function(c){return new a.Image.filters.Convolute(c)}})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.GradientTransparency=a.util.createClass(a.Image.filters.BaseFilter,
{type:"GradientTransparency",initialize:function(a){a=a||{};this.threshold=a.threshold||100},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var k=a.data,f=this.threshold,h=k.length,d=0,e=k.length;d<e;d+=4)k[d+3]=f+255*(h-d)/h;b.putImageData(a,0,0)},toObject:function(){return d(this.callSuper("toObject"),{threshold:this.threshold})}});a.Image.filters.GradientTransparency.fromObject=function(c){return new a.Image.filters.GradientTransparency(c)}})("undefined"!==
typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={});a.Image.filters.Grayscale=a.util.createClass(a.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);for(var b=a.data,k=a.width*a.height*4,f=0,h;f<k;)h=(b[f]+b[f+1]+b[f+2])/3,b[f]=h,b[f+1]=h,b[f+2]=h,f+=4;c.putImageData(a,0,0)}});a.Image.filters.Grayscale.fromObject=function(){return new a.Image.filters.Grayscale}})("undefined"!==typeof p?p:this);(function(e){var a=
e.fabric||(e.fabric={});a.Image.filters.Invert=a.util.createClass(a.Image.filters.BaseFilter,{type:"Invert",applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var b=a.data,k=b.length,f;for(f=0;f<k;f+=4)b[f]=255-b[f],b[f+1]=255-b[f+1],b[f+2]=255-b[f+2];c.putImageData(a,0,0)}});a.Image.filters.Invert.fromObject=function(){return new a.Image.filters.Invert}})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Mask=
a.util.createClass(a.Image.filters.BaseFilter,{type:"Mask",initialize:function(a){a=a||{};this.mask=a.mask;this.channel=-1<[0,1,2,3].indexOf(a.channel)?a.channel:0},applyTo:function(c){if(this.mask){var b=c.getContext("2d"),k=b.getImageData(0,0,c.width,c.height),f=k.data,h=this.mask.getElement(),d=a.util.createCanvasElement(),e=this.channel,g=k.width*k.height*4;d.width=c.width;d.height=c.height;d.getContext("2d").drawImage(h,0,0,c.width,c.height);h=d.getContext("2d").getImageData(0,0,c.width,c.height).data;
for(c=0;c<g;c+=4)f[c+3]=h[c+e];b.putImageData(k,0,0)}},toObject:function(){return d(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});a.Image.filters.Mask.fromObject=function(c,b){a.util.loadImage(c.mask.src,function(k){c.mask=new a.Image(k,c.mask);b&&b(new a.Image.filters.Mask(c))})};a.Image.filters.Mask.async=!0})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Noise=a.util.createClass(a.Image.filters.BaseFilter,
{type:"Noise",initialize:function(a){a=a||{};this.noise=a.noise||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var k=a.data,f=this.noise,h,d=0,e=k.length;d<e;d+=4)h=(.5-Math.random())*f,k[d]+=h,k[d+1]+=h,k[d+2]+=h;b.putImageData(a,0,0)},toObject:function(){return d(this.callSuper("toObject"),{noise:this.noise})}});a.Image.filters.Noise.fromObject=function(c){return new a.Image.filters.Noise(c)}})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||
(e.fabric={}),d=a.util.object.extend;a.Image.filters.Pixelate=a.util.createClass(a.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(a){a=a||{};this.blocksize=a.blocksize||4},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var k=a.data,f=a.height,h=a.width,d,e,g,m,u,t,H;for(e=0;e<f;e+=this.blocksize)for(g=0;g<h;g+=this.blocksize){d=4*e*h+4*g;m=k[d];u=k[d+1];t=k[d+2];H=k[d+3];for(var F=e,z=e+this.blocksize;F<z;F++)for(var J=g,l=g+this.blocksize;J<l;J++)d=
4*F*h+4*J,k[d]=m,k[d+1]=u,k[d+2]=t,k[d+3]=H}b.putImageData(a,0,0)},toObject:function(){return d(this.callSuper("toObject"),{blocksize:this.blocksize})}});a.Image.filters.Pixelate.fromObject=function(c){return new a.Image.filters.Pixelate(c)}})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.RemoveWhite=a.util.createClass(a.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{};this.threshold=a.threshold||30;this.distance=
a.distance||20},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var k=a.data,f=this.distance,h=255-this.threshold,d=Math.abs,e,g,m,u=0,t=k.length;u<t;u+=4)e=k[u],g=k[u+1],m=k[u+2],e>h&&g>h&&m>h&&d(e-g)<f&&d(e-m)<f&&d(g-m)<f&&(k[u+3]=0);b.putImageData(a,0,0)},toObject:function(){return d(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});a.Image.filters.RemoveWhite.fromObject=function(c){return new a.Image.filters.RemoveWhite(c)}})("undefined"!==
typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={});a.Image.filters.Sepia=a.util.createClass(a.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var b=a.data,k=b.length,f,h;for(f=0;f<k;f+=4)h=.3*b[f]+.59*b[f+1]+.11*b[f+2],b[f]=h+100,b[f+1]=h+50,b[f+2]=h+255;c.putImageData(a,0,0)}});a.Image.filters.Sepia.fromObject=function(){return new a.Image.filters.Sepia}})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||
(e.fabric={});a.Image.filters.Sepia2=a.util.createClass(a.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var b=a.data,k=b.length,f,h,e,g;for(f=0;f<k;f+=4)h=b[f],e=b[f+1],g=b[f+2],b[f]=(.393*h+.769*e+.189*g)/1.351,b[f+1]=(.349*h+.686*e+.168*g)/1.203,b[f+2]=(.272*h+.534*e+.131*g)/2.14;c.putImageData(a,0,0)}});a.Image.filters.Sepia2.fromObject=function(){return new a.Image.filters.Sepia2}})("undefined"!==typeof p?p:this);(function(e){var a=
e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Tint=a.util.createClass(a.Image.filters.BaseFilter,{type:"Tint",initialize:function(c){c=c||{};this.color=c.color||"#000000";this.opacity="undefined"!==typeof c.opacity?c.opacity:(new a.Color(this.color)).getAlpha()},applyTo:function(c){var b=c.getContext("2d");c=b.getImageData(0,0,c.width,c.height);var k=c.data,f=k.length,h,d,e,g,m,u,t,H;h=(new a.Color(this.color)).getSource();d=h[0]*this.opacity;e=h[1]*this.opacity;g=h[2]*this.opacity;
H=1-this.opacity;for(h=0;h<f;h+=4)m=k[h],u=k[h+1],t=k[h+2],k[h]=d+m*H,k[h+1]=e+u*H,k[h+2]=g+t*H;b.putImageData(c,0,0)},toObject:function(){return d(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});a.Image.filters.Tint.fromObject=function(c){return new a.Image.filters.Tint(c)}})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Multiply=a.util.createClass(a.Image.filters.BaseFilter,{type:"Multiply",initialize:function(a){a=
a||{};this.color=a.color||"#000000"},applyTo:function(c){var b=c.getContext("2d");c=b.getImageData(0,0,c.width,c.height);var k=c.data,f=k.length,h,d;d=(new a.Color(this.color)).getSource();for(h=0;h<f;h+=4)k[h]*=d[0]/255,k[h+1]*=d[1]/255,k[h+2]*=d[2]/255;b.putImageData(c,0,0)},toObject:function(){return d(this.callSuper("toObject"),{color:this.color})}});a.Image.filters.Multiply.fromObject=function(c){return new a.Image.filters.Multiply(c)}})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric;
a.Image.filters.Blend=a.util.createClass({type:"Blend",initialize:function(a){a=a||{};this.color=a.color||"#000";this.image=a.image||!1;this.mode=a.mode||"multiply";this.alpha=a.alpha||1},applyTo:function(d){var c=d.getContext("2d");d=c.getImageData(0,0,d.width,d.height);var b=d.data,k,f,h,e,g,r,m,u=!1;this.image?(u=!0,m=a.util.createCanvasElement(),m.width=this.image.width,m.height=this.image.height,m=new a.StaticCanvas(m),m.add(this.image),m=m.getContext("2d").getImageData(0,0,m.width,m.height).data):
(m=(new a.Color(this.color)).getSource(),k=m[0]*this.alpha,f=m[1]*this.alpha,h=m[2]*this.alpha);for(var t=0,H=b.length;t<H;t+=4)switch(e=b[t],g=b[t+1],r=b[t+2],u&&(k=m[t]*this.alpha,f=m[t+1]*this.alpha,h=m[t+2]*this.alpha),this.mode){case "multiply":b[t]=e*k/255;b[t+1]=g*f/255;b[t+2]=r*h/255;break;case "screen":b[t]=1-(1-e)*(1-k);b[t+1]=1-(1-g)*(1-f);b[t+2]=1-(1-r)*(1-h);break;case "add":b[t]=Math.min(255,e+k);b[t+1]=Math.min(255,g+f);b[t+2]=Math.min(255,r+h);break;case "diff":case "difference":b[t]=
Math.abs(e-k);b[t+1]=Math.abs(g-f);b[t+2]=Math.abs(r-h);break;case "subtract":e-=k;g-=f;r-=h;b[t]=0>e?0:e;b[t+1]=0>g?0:g;b[t+2]=0>r?0:r;break;case "darken":b[t]=Math.min(e,k);b[t+1]=Math.min(g,f);b[t+2]=Math.min(r,h);break;case "lighten":b[t]=Math.max(e,k),b[t+1]=Math.max(g,f),b[t+2]=Math.max(r,h)}c.putImageData(d,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});a.Image.filters.Blend.fromObject=function(d){return new a.Image.filters.Blend(d)}})("undefined"!==
typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=Math.pow,c=Math.floor,b=Math.sqrt,k=Math.abs,f=Math.max,h=Math.round,n=Math.sin,g=Math.ceil;a.Image.filters.Resize=a.util.createClass(a.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(b,a,f){this.rcpScaleX=1/a;this.rcpScaleY=1/f;var c=b.width,k=b.height;a=h(c*a);f=h(k*f);var d;"sliceHack"===this.resizeType&&(d=this.sliceByTwo(b,c,k,a,f));"hermite"===this.resizeType&&(d=this.hermiteFastResize(b,
c,k,a,f));"bilinear"===this.resizeType&&(d=this.bilinearFiltering(b,c,k,a,f));"lanczos"===this.resizeType&&(d=this.lanczosResize(b,c,k,a,f));b.width=a;b.height=f;b.getContext("2d").putImageData(d,0,0)},sliceByTwo:function(b,h,k,d,e){var n=b.getContext("2d"),g,q=.5,l=.5,D=1,y=1,B=!1,x=!1,w=h,p=k,K=a.util.createCanvasElement(),E=K.getContext("2d");d=c(d);e=c(e);K.width=f(d,h);K.height=f(e,k);d>h&&(q=2,D=-1);e>k&&(l=2,y=-1);g=n.getImageData(0,0,h,k);b.width=f(d,h);b.height=f(e,k);for(n.putImageData(g,
0,0);!B||!x;)h=w,k=p,d*D<c(w*q*D)?w=c(w*q):(w=d,B=!0),e*y<c(p*l*y)?p=c(p*l):(p=e,x=!0),g=n.getImageData(0,0,h,k),E.putImageData(g,0,0),n.clearRect(0,0,w,p),n.drawImage(K,0,0,h,k,0,0,w,p);return n.getImageData(0,0,d,e)},lanczosResize:function(a,f,h,e,H){var F,z,J,l;function D(a){var n,g,q,r,y,v,C,A,S,O;J=(a+.5)*K;F=c(J);for(n=0;n<H;n++){l=(n+.5)*E;z=c(l);S=A=C=v=y=0;for(g=F-P;g<=F+P;g++)if(!(0>g||g>=f)){O=c(1E3*k(g-J));Q[O]||(Q[O]={});for(var R=z-U;R<=z+U;R++)0>R||R>=h||(q=c(1E3*k(R-l)),Q[O][q]||(Q[O][q]=
p(b(d(O*L,2)+d(q*M,2))/1E3)),q=Q[O][q],0<q&&(r=4*(R*f+g),y+=q,v+=q*x[r],C+=q*x[r+1],A+=q*x[r+2],S+=q*x[r+3]))}r=4*(n*e+a);w[r]=v/y;w[r+1]=C/y;w[r+2]=A/y;w[r+3]=S/y}return++a<e?D(a):B}a=a.getContext("2d");var y=a.getImageData(0,0,f,h),B=a.getImageData(0,0,e,H),x=y.data,w=B.data,p=function(b){return function(a){if(a>b)return 0;a*=Math.PI;if(1E-16>k(a))return 1;var f=a/b;return n(a)*n(f)/a/f}}(this.lanczosLobes),K=this.rcpScaleX,E=this.rcpScaleY,L=2/this.rcpScaleX,M=2/this.rcpScaleY,P=g(K*this.lanczosLobes/
2),U=g(E*this.lanczosLobes/2),Q={};z=F=l=J=void 0;return D(0)},bilinearFiltering:function(b,a,f,h,k){var d,e,n,g,q,l,B,x,w,p,K=0,E=this.rcpScaleX,L=this.rcpScaleY;B=b.getContext("2d");b=4*(a-1);f=B.getImageData(0,0,a,f).data;var M=B.getImageData(0,0,h,k),P=M.data;for(B=0;B<k;B++)for(x=0;x<h;x++)for(q=c(E*x),l=c(L*B),w=E*x-q,p=L*B-l,l=4*(l*a+q),q=0;4>q;q++)d=f[l+q],e=f[l+4+q],n=f[l+b+q],g=f[l+b+4+q],d=d*(1-w)*(1-p)+e*w*(1-p)+n*p*(1-w)+g*w*p,P[K++]=d;return M},hermiteFastResize:function(a,f,h,d,e){var n=
this.rcpScaleX,z=this.rcpScaleY,J=g(n/2),l=g(z/2);a=a.getContext("2d");h=a.getImageData(0,0,f,h).data;a=a.getImageData(0,0,d,e);for(var D=a.data,y=0;y<e;y++)for(var B=0;B<d;B++){for(var x=4*(B+y*d),w=0,p=0,K=0,E=0,L=0,M=0,P=0,U=(y+.5)*z,Q=c(y*z);Q<(y+1)*z;Q++)for(var v=k(U-(Q+.5))/l,C=(B+.5)*n,v=v*v,A=c(B*n);A<(B+1)*n;A++){var N=k(C-(A+.5))/J,w=b(v+N*N);1<w&&-1>w||(w=2*w*w*w-3*w*w+1,0<w&&(N=4*(A+Q*f),P+=w*h[N+3],K+=w,255>h[N+3]&&(w=w*h[N+3]/250),E+=w*h[N],L+=w*h[N+1],M+=w*h[N+2],p+=w))}D[x]=E/p;D[x+
1]=L/p;D[x+2]=M/p;D[x+3]=P/K}return a},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});a.Image.filters.Resize.fromObject=function(b){return new a.Image.filters.Resize(b)}})("undefined"!==typeof p?p:this);(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend,c=a.util.object.clone,b=a.util.toFixed,k=a.StaticCanvas.supports("setLineDash"),f=a.Object.NUM_FRACTION_DIGITS;a.Text?a.warn("fabric.Text is already defined"):
(e=a.Object.prototype.stateProperties.concat(),e.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),a.Text=a.util.createClass(a.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",
fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:e,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(b,a){a=a||{};this.text=b;this.__skipDimension=!0;this.setOptions(a);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(b){this.__skipDimension||(b||(b=a.util.createCanvasElement().getContext("2d"),this._setTextStyles(b)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this._cacheLinesWidth="justify"!==this.textAlign,
this.width=this._getTextWidth(b),this._cacheLinesWidth=!0,this.height=this._getTextHeight(b))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(b){this.clipTo&&a.util.clipContext(this,b);this._setOpacity(b);this._setShadow(b);this._setupCompositeOperation(b);this._renderTextBackground(b);this._setStrokeStyles(b);this._setFillStyles(b);this._renderText(b);this._renderTextDecoration(b);this.clipTo&&
b.restore()},_renderText:function(b){this._translateForTextAlign(b);this._renderTextFill(b);this._renderTextStroke(b);this._translateForTextAlign(b,!0)},_translateForTextAlign:function(b,a){if("left"!==this.textAlign&&"justify"!==this.textAlign){var f=a?-1:1;b.translate("center"===this.textAlign?f*this.width/2:f*this.width,0)}},_setTextStyles:function(b){b.textBaseline="alphabetic";this.skipTextAlign||(b.textAlign=this.textAlign);b.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*
this._getHeightOfLine()},_getTextWidth:function(b){for(var a=this._getLineWidth(b,0),f=1,c=this._textLines.length;f<c;f++){var k=this._getLineWidth(b,f);k>a&&(a=k)}return a},_renderChars:function(b,a,f,c,k){var d=b.slice(0,-4);if(this[d].toLive){var e=-this.width/2+this[d].offsetX||0,g=-this.height/2+this[d].offsetY||0;a.save();a.translate(e,g);c-=e;k-=g}a[b](f,c,k);this[d].toLive&&a.restore()},_renderTextLine:function(b,a,f,c,k,d){k-=this.fontSize*this._fontSizeFraction;var e=this._getLineWidth(a,
d);if("justify"!==this.textAlign||this.width<e)this._renderChars(b,a,f,c,k,d);else for(var e=f.split(/\s+/),g=0,F=this._getWidthOfWords(a,f,d,0),F=this.width-F,z=e.length-1,F=0<z?F/z:0,z=0,J,l=0,D=e.length;l<D;l++){for(;" "===f[g]&&g<f.length;)g++;J=e[l];this._renderChars(b,a,J,c+z,k,d,g);z+=this._getWidthOfWords(a,J,d,g)+F;g+=J.length}},_getWidthOfWords:function(b,a){return b.measureText(a.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/
2},isEmptyStyles:function(){return!0},_renderTextFill:function(b){if(this.fill||!this.isEmptyStyles())for(var a=0,f=0,c=this._textLines.length;f<c;f++){var k=this._getHeightOfLine(b,f),d=k/this.lineHeight;this._renderTextLine("fillText",b,this._textLines[f],this._getLeftOffset(),this._getTopOffset()+a+d,f);a+=k}},_renderTextStroke:function(b){if(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles()){var a=0;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(b);b.save();this.strokeDashArray&&
(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),k&&b.setLineDash(this.strokeDashArray));b.beginPath();for(var f=0,c=this._textLines.length;f<c;f++){var d=this._getHeightOfLine(b,f),e=d/this.lineHeight;this._renderTextLine("strokeText",b,this._textLines[f],this._getLeftOffset(),this._getTopOffset()+a+e,f);a+=d}b.closePath();b.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(b){this._renderTextBoxBackground(b);
this._renderTextLinesBackground(b)},_renderTextBoxBackground:function(b){this.backgroundColor&&(b.fillStyle=this.backgroundColor,b.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),this._removeShadow(b))},_renderTextLinesBackground:function(b){if(this.textBackgroundColor){var a=0,f,c,k;b.fillStyle=this.textBackgroundColor;for(var d=0,e=this._textLines.length;d<e;d++)f=this._getHeightOfLine(b,d),""!==this._textLines[d]&&(c="justify"===this.textAlign?this.width:this._getLineWidth(b,
d),k=this._getLineLeftOffset(c),b.fillRect(this._getLeftOffset()+k,this._getTopOffset()+a,c,f/this.lineHeight)),a+=f;this._removeShadow(b)}},_getLineLeftOffset:function(b){return"center"===this.textAlign?(this.width-b)/2:"right"===this.textAlign?this.width-b:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[]},_shouldClearCache:function(){var b=!1;if(this._forceClearCache)return this._forceClearCache=!1,!0;for(var a in this._dimensionAffectingProps)this["__"+a]!==this[a]&&(this["__"+
a]=this[a],b=!0);return b},_getLineWidth:function(b,a){if(this.__lineWidths[a])return this.__lineWidths[a];var f,c=this._textLines[a];""===c?f=0:"justify"===this.textAlign&&this._cacheLinesWidth?(f=c.split(/\s+/),f=1<f.length?this.width:b.measureText(c).width):f=b.measureText(c).width;this._cacheLinesWidth&&(this.__lineWidths[a]=f);return f},_renderTextDecoration:function(b){if(this.textDecoration){var a=this.height/2,f=[];-1<this.textDecoration.indexOf("underline")&&f.push(.85);-1<this.textDecoration.indexOf("line-through")&&
f.push(.43);-1<this.textDecoration.indexOf("overline")&&f.push(-.12);if(0<f.length){var c,k=0,d,e,g,F,z,J;c=0;for(d=this._textLines.length;c<d;c++){F=this._getLineWidth(b,c);z=this._getLineLeftOffset(F);J=this._getHeightOfLine(b,c);e=0;for(g=f.length;e<g;e++)b.fillRect(this._getLeftOffset()+z,k+(this._fontSizeMult-1+f[e])*this.fontSize-a,F,this.fontSize/15);k+=J}}}},_getFontDeclaration:function(){return[a.isLikelyNode?this.fontWeight:this.fontStyle,a.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+
"px",a.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(b,a){this.visible&&(b.save(),this._setTextStyles(b),this._shouldClearCache()&&this._initDimensions(b),a||this.transform(b),this.transformMatrix&&b.transform.apply(b,this.transformMatrix),this.group&&"path-group"===this.group.type&&b.translate(this.left,this.top),this._render(b),b.restore())},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(b){b=d(this.callSuper("toObject",
b),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});this.includeDefaultValues||this._removeDefaultValues(b);return b},toSVG:function(b){var a=this._createBaseSVGMarkup(),f=this._getSVGLeftTopOffsets(this.ctx),f=this._getSVGTextAndBg(f.textTop,f.textLeft);this._wrapSVGTextAndBg(a,f);return b?b(a.join("")):
a.join("")},_getSVGLeftTopOffsets:function(b){b=this._getHeightOfLine(b,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:b}},_wrapSVGTextAndBg:function(b,a){var f=this.getSvgFilter(),f=""===f?"":' style="'+f+'"';b.push('\t<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',f,">\n",a.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,
"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(!0),'" >\n',a.textSpans.join(""),"\t\t</text>\n","\t</g>\n")},_getSVGTextAndBg:function(b,a){var f=[],c=[],k=0;this._setSVGBg(c);for(var d=0,e=this._textLines.length;d<e;d++)this.textBackgroundColor&&this._setSVGTextLineBg(c,d,a,b,k),
this._setSVGTextLineText(d,f,k,a,b,c),k+=this._getHeightOfLine(this.ctx,d);return{textSpans:f,textBgRects:c}},_setSVGTextLineText:function(c,k,d,e,m){d=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-m+d-this.height/2;"justify"===this.textAlign?this._setSVGTextLineJustifed(c,k,d,e):k.push('\t\t\t<tspan x="',b(e+this._getLineLeftOffset(this._getLineWidth(this.ctx,c)),f),'" ','y="',b(d,f),'" ',this._getFillAttributes(this.fill),">",a.util.string.escapeXml(this._textLines[c]),"</tspan>\n")},
_setSVGTextLineJustifed:function(c,k,d,e){var m=a.util.createCanvasElement().getContext("2d");this._setTextStyles(m);var g=this._textLines[c],t=g.split(/\s+/),g=this._getWidthOfWords(m,g),g=this.width-g,H=t.length-1,g=0<H?g/H:0,F=this._getFillAttributes(this.fill),z;e+=this._getLineLeftOffset(this._getLineWidth(m,c));c=0;for(z=t.length;c<z;c++)H=t[c],k.push('\t\t\t<tspan x="',b(e,f),'" ','y="',b(d,f),'" ',F,">",a.util.string.escapeXml(H),"</tspan>\n"),e+=this._getWidthOfWords(m,H)+g},_setSVGTextLineBg:function(a,
c,k,d,e){a.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',b(k+this._getLineLeftOffset(this._getLineWidth(this.ctx,c)),f),'" y="',b(e-this.height/2,f),'" width="',b(this._getLineWidth(this.ctx,c),f),'" height="',b(this._getHeightOfLine(this.ctx,c)/this.lineHeight,f),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&a.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',b(-this.width/2,f),'" y="',b(-this.height/2,f),'" width="',b(this.width,f),
'" height="',b(this.height,f),'"></rect>\n')},_getFillAttributes:function(b){var f=b&&"string"===typeof b?new a.Color(b):"";return f&&f.getSource()&&1!==f.getAlpha()?'opacity="'+f.getAlpha()+'" fill="'+f.setAlpha(1).toRgb()+'"':'fill="'+b+'"'},_set:function(b,a){this.callSuper("_set",b,a);b in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),a.Text.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),
a.Text.DEFAULT_SVG_FONT_SIZE=16,a.Text.fromElement=function(b,f){if(!b)return null;var c=a.parseAttributes(b,a.Text.ATTRIBUTE_NAMES);f=a.util.object.extend(f?a.util.object.clone(f):{},c);f.top=f.top||0;f.left=f.left||0;"dx"in c&&(f.left+=c.dx);"dy"in c&&(f.top+=c.dy);"fontSize"in f||(f.fontSize=a.Text.DEFAULT_SVG_FONT_SIZE);f.originX||(f.originX="left");c="";"textContent"in b?c=b.textContent:"firstChild"in b&&null!==b.firstChild&&"data"in b.firstChild&&null!==b.firstChild.data&&(c=b.firstChild.data);
var c=c.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),c=new a.Text(c,f),k=0;"left"===c.originX&&(k=c.getWidth()/2);"right"===c.originX&&(k=-c.getWidth()/2);c.set({left:c.getLeft()+k,top:c.getTop()-c.getHeight()/2+c.fontSize*(.18+c._fontSizeFraction)});return c},a.Text.fromObject=function(b){return new a.Text(b.text,c(b))},a.util.createAccessors(a.Text))})("undefined"!==typeof p?p:this);(function(){var e=g.util.object.clone;g.IText=g.util.createClass(g.Text,g.Observable,{type:"i-text",selectionStart:0,
selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,styles:null,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},__widthOfSpace:[],initialize:function(a,d){this.styles=d?d.styles||{}:{};this.callSuper("initialize",a,d);this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache");
this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var a=this.styles,d;for(d in a)for(var c in a[d])for(var b in a[d][c])return!1;return!0},setSelectionStart:function(a){a=Math.max(a,0);this.selectionStart!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionStart=a);this._updateTextarea()},setSelectionEnd:function(a){a=Math.min(a,this.text.length);this.selectionEnd!==a&&(this.fire("selection:changed"),this.canvas&&
this.canvas.fire("text:selection:changed",{target:this}),this.selectionEnd=a);this._updateTextarea()},getSelectionStyles:function(a,d){if(2===arguments.length){for(var c=[],b=a;b<d;b++)c.push(this.getSelectionStyles(b));return c}c=this.get2DCursorLocation(a);return this._getStyleDeclaration(c.lineIndex,c.charIndex)||{}},setSelectionStyles:function(a){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,a);else for(var d=this.selectionStart;d<this.selectionEnd;d++)this._extendStyles(d,
a);this._forceClearCache=!0;return this},_extendStyles:function(a,d){var c=this.get2DCursorLocation(a);this._getLineStyle(c.lineIndex)||this._setLineStyle(c.lineIndex,{});this._getStyleDeclaration(c.lineIndex,c.charIndex)||this._setStyleDeclaration(c.lineIndex,c.charIndex,{});g.util.object.extend(this._getStyleDeclaration(c.lineIndex,c.charIndex),d)},_render:function(a){this.callSuper("_render",a);this.ctx=a;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var a=
this.text.split(""),d,c;this.canvas.contextTop?(c=this.canvas.contextTop,c.save(),c.transform.apply(c,this.canvas.viewportTransform),this.transform(c),this.transformMatrix&&c.transform.apply(c,this.transformMatrix)):(c=this.ctx,c.save());this.selectionStart===this.selectionEnd?(d=this._getCursorBoundaries(a,"cursor"),this.renderCursor(d,c)):(d=this._getCursorBoundaries(a,"selection"),this.renderSelection(a,d,c));c.restore()}},get2DCursorLocation:function(a){"undefined"===typeof a&&(a=this.selectionStart);
for(var d=this._textLines.length,c=0;c<d;c++){if(a<=this._textLines[c].length)return{lineIndex:c,charIndex:a};a-=this._textLines[c].length+1}return{lineIndex:c-1,charIndex:this._textLines[c-1].length<a?this._textLines[c-1].length:a}},getCurrentCharStyle:function(a,d){var c=this._getStyleDeclaration(a,0===d?0:d-1);return{fontSize:c&&c.fontSize||this.fontSize,fill:c&&c.fill||this.fill,textBackgroundColor:c&&c.textBackgroundColor||this.textBackgroundColor,textDecoration:c&&c.textDecoration||this.textDecoration,
fontFamily:c&&c.fontFamily||this.fontFamily,fontWeight:c&&c.fontWeight||this.fontWeight,fontStyle:c&&c.fontStyle||this.fontStyle,stroke:c&&c.stroke||this.stroke,strokeWidth:c&&c.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(a,d){var c=this._getStyleDeclaration(a,0===d?0:d-1);return c&&c.fontSize?c.fontSize:this.fontSize},getCurrentCharColor:function(a,d){var c=this._getStyleDeclaration(a,0===d?0:d-1);return c&&c.fill?c.fill:this.cursorColor},_getCursorBoundaries:function(a,d){var c=
Math.round(this._getLeftOffset()),b=this._getTopOffset(),k=this._getCursorBoundariesOffsets(a,d);return{left:c,top:b,leftOffset:k.left+k.lineLeft,topOffset:k.top}},_getCursorBoundariesOffsets:function(a,d){for(var c=0,b=0,k=0,f=0,h=0,e=0;e<this.selectionStart;e++)"\n"===a[e]?(h=0,f+=this._getHeightOfLine(this.ctx,b),b++,k=0):(h+=this._getWidthOfChar(this.ctx,a[e],b,k),k++),c=this._getLineLeftOffset(this._getLineWidth(this.ctx,b));"cursor"===d&&(f+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,
b)/this.lineHeight-this.getCurrentCharFontSize(b,k)*(1-this._fontSizeFraction));return{top:f,left:h,lineLeft:c}},renderCursor:function(a,d){var c=this.get2DCursorLocation(),b=c.lineIndex,c=c.charIndex,k=this.getCurrentCharFontSize(b,c),f=0===b&&0===c?this._getLineLeftOffset(this._getLineWidth(d,b)):a.leftOffset;d.fillStyle=this.getCurrentCharColor(b,c);d.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;d.fillRect(a.left+f,a.top+a.topOffset,this.cursorWidth/this.scaleX,k)},renderSelection:function(a,
d,c){c.fillStyle=this.selectionColor;a=this.get2DCursorLocation(this.selectionStart);for(var b=this.get2DCursorLocation(this.selectionEnd),k=a.lineIndex,f=b.lineIndex,h=k;h<=f;h++){var e=this._getLineLeftOffset(this._getLineWidth(c,h))||0,g=this._getHeightOfLine(this.ctx,h),r=0,m=this._textLines[h];if(h===k)for(var u=0,t=m.length;u<t;u++)u>=a.charIndex&&(h!==f||u<b.charIndex)&&(r+=this._getWidthOfChar(c,m[u],h,u)),u<a.charIndex&&(e+=this._getWidthOfChar(c,m[u],h,u));else if(h>k&&h<f)r+=this._getLineWidth(c,
h)||5;else if(h===f)for(u=0,t=b.charIndex;u<t;u++)r+=this._getWidthOfChar(c,m[u],h,u);c.fillRect(d.left+e,d.top+d.topOffset,r,g);d.topOffset+=g}},_renderChars:function(a,d,c,b,k,f,h){if(this.isEmptyStyles())return this._renderCharsFast(a,d,c,b,k);h=h||0;this.skipTextAlign=!0;b-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var e=this._getHeightOfLine(d,f),g=this._getLineLeftOffset(this._getLineWidth(d,f)),r,m="";b+=g||0;d.save();k-=e/this.lineHeight*this._fontSizeFraction;
for(var u=h,t=c.length+h;u<=t;u++){r=r||this.getCurrentCharStyle(f,u);g=this.getCurrentCharStyle(f,u+1);if(this._hasStyleChanged(r,g)||u===t)this._renderChar(a,d,f,u-1,m,b,k,e),m="",r=g;m+=c[u-h]}d.restore()},_renderCharsFast:function(a,d,c,b,k){this.skipTextAlign=!1;"fillText"===a&&this.fill&&this.callSuper("_renderChars",a,d,c,b,k);"strokeText"===a&&(this.stroke&&0<this.strokeWidth||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",a,d,c,b,k)},_renderChar:function(a,d,c,b,k,f,h,e){var g,
r,m,u=this._getStyleDeclaration(c,b),t;u?(g=this._getHeightOfChar(d,k,c,b),m=u.stroke,r=u.fill,t=u.textDecoration):g=this.fontSize;m=(m||this.stroke)&&"strokeText"===a;r=(r||this.fill)&&"fillText"===a;u&&d.save();a=this._applyCharStylesGetWidth(d,k,c,b,u||{});t=t||this.textDecoration;u&&u.textBackgroundColor&&this._removeShadow(d);r&&d.fillText(k,f,h);m&&d.strokeText(k,f,h);if(t||""!==t)k=this._fontSizeFraction*e/this.lineHeight,this._renderCharDecoration(d,t,f,h,k,a,g);u&&d.restore();d.translate(a,
0)},_hasStyleChanged:function(a,d){return a.fill!==d.fill||a.fontSize!==d.fontSize||a.textBackgroundColor!==d.textBackgroundColor||a.textDecoration!==d.textDecoration||a.fontFamily!==d.fontFamily||a.fontWeight!==d.fontWeight||a.fontStyle!==d.fontStyle||a.stroke!==d.stroke||a.strokeWidth!==d.strokeWidth},_renderCharDecoration:function(a,d,c,b,k,f,h){if(d){k=h/15;b={underline:b+h/10,"line-through":b-h*(this._fontSizeFraction+this._fontSizeMult-1)+k,overline:b-(this._fontSizeMult-this._fontSizeFraction)*
h};h=["underline","line-through","overline"];var e,g;for(e=0;e<h.length;e++)g=h[e],-1<d.indexOf(g)&&a.fillRect(c,b[g],f,k)}},_renderTextLine:function(a,d,c,b,k,f){this.isEmptyStyles()||(k+=this.fontSize*(this._fontSizeFraction+.03));this.callSuper("_renderTextLine",a,d,c,b,k,f)},_renderTextDecoration:function(a){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",a)},_renderTextLinesBackground:function(a){this.callSuper("_renderTextLinesBackground",a);for(var d=0,c,b,k=this._getLeftOffset(),
f=this._getTopOffset(),h,e,g,r=0,m=this._textLines.length;r<m;r++){c=this._getHeightOfLine(a,r);h=this._textLines[r];if(""!==h&&this.styles&&this._getLineStyle(r)){b=this._getLineWidth(a,r);b=this._getLineLeftOffset(b);for(var u=0,t=h.length;u<t;u++)(g=this._getStyleDeclaration(r,u))&&g.textBackgroundColor&&(e=h[u],a.fillStyle=g.textBackgroundColor,a.fillRect(k+b+this._getWidthOfCharsAt(a,r,u),f+d,this._getWidthOfChar(a,e,r,u)+1,c/this.lineHeight))}d+=c}},_getCacheProp:function(a,d){return a+d.fontFamily+
d.fontSize+d.fontWeight+d.fontStyle+d.shadow},_applyCharStylesGetWidth:function(a,d,c,b,k){c=this._getStyleDeclaration(c,b);b=k&&e(k)||e(c);this._applyFontStyles(b);k=this._getCacheProp(d,b);if(!c&&this._charWidthsCache[k]&&this.caching)return this._charWidthsCache[k];"string"===typeof b.shadow&&(b.shadow=new g.Shadow(b.shadow));c=b.fill||this.fill;a.fillStyle=c.toLive?c.toLive(a,this):c;b.stroke&&(a.strokeStyle=b.stroke&&b.stroke.toLive?b.stroke.toLive(a,this):b.stroke);a.lineWidth=b.strokeWidth||
this.strokeWidth;a.font=this._getFontDeclaration.call(b);b.shadow&&(b.scaleX=this.scaleX,b.scaleY=this.scaleY,b.canvas=this.canvas,this._setShadow.call(b,a));this.caching&&this._charWidthsCache[k]||(a=a.measureText(d).width,this.caching&&(this._charWidthsCache[k]=a));return this._charWidthsCache[k]},_applyFontStyles:function(a){a.fontFamily||(a.fontFamily=this.fontFamily);a.fontSize||(a.fontSize=this.fontSize);a.fontWeight||(a.fontWeight=this.fontWeight);a.fontStyle||(a.fontStyle=this.fontStyle)},
_getStyleDeclaration:function(a,d,c){return c?this.styles[a]&&this.styles[a][d]?e(this.styles[a][d]):{}:this.styles[a]&&this.styles[a][d]?this.styles[a][d]:null},_setStyleDeclaration:function(a,d,c){this.styles[a][d]=c},_deleteStyleDeclaration:function(a,d){delete this.styles[a][d]},_getLineStyle:function(a){return this.styles[a]},_setLineStyle:function(a,d){this.styles[a]=d},_deleteLineStyle:function(a){delete this.styles[a]},_getWidthOfChar:function(a,d,c,b){if("justify"===this.textAlign&&this._reSpacesAndTabs.test(d))return this._getWidthOfSpace(a,
c);var k=this._getStyleDeclaration(c,b,!0);this._applyFontStyles(k);k=this._getCacheProp(d,k);if(this._charWidthsCache[k]&&this.caching)return this._charWidthsCache[k];if(a)return a.save(),d=this._applyCharStylesGetWidth(a,d,c,b),a.restore(),d},_getHeightOfChar:function(a,d,c){return(a=this._getStyleDeclaration(d,c))&&a.fontSize?a.fontSize:this.fontSize},_getWidthOfCharsAt:function(a,d,c){var b=0,k,f;for(k=0;k<c;k++)f=this._textLines[d][k],b+=this._getWidthOfChar(a,f,d,k);return b},_getLineWidth:function(a,
d){if(this.__lineWidths[d])return this.__lineWidths[d];this.__lineWidths[d]=this._getWidthOfCharsAt(a,d,this._textLines[d].length);return this.__lineWidths[d]},_getWidthOfSpace:function(a,d){if(this.__widthOfSpace[d])return this.__widthOfSpace[d];var c=this._textLines[d],b=this._getWidthOfWords(a,c,d,0),b=this.width-b,c=c.length-c.replace(this._reSpacesAndTabs,"").length,c=b/c;return this.__widthOfSpace[d]=c},_getWidthOfWords:function(a,d,c,b){for(var k=0,f=0;f<d.length;f++){var h=d[f];h.match(/\s/)||
(k+=this._getWidthOfChar(a,h,c,f+b))}return k},_getHeightOfLine:function(a,d){if(this.__lineHeights[d])return this.__lineHeights[d];for(var c=this._textLines[d],b=this._getHeightOfChar(a,d,0),k=1,c=c.length;k<c;k++){var f=this._getHeightOfChar(a,d,k);f>b&&(b=f)}this.__lineHeights[d]=b*this.lineHeight*this._fontSizeMult;return this.__lineHeights[d]},_getTextHeight:function(a){for(var d=0,c=0,b=this._textLines.length;c<b;c++)d+=this._getHeightOfLine(a,c);return d},toObject:function(a){var d={},c,b,
k;for(c in this.styles)for(b in k=this.styles[c],d[c]={},k)d[c][b]=e(k[b]);return g.util.object.extend(this.callSuper("toObject",a),{styles:d})}});g.IText.fromObject=function(a){return new g.IText(a.text,e(a))}})();(function(){var e=g.util.object.clone;g.util.object.extend(g.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var a=
this;setTimeout(function(){a.selected=!0},100)})},initAddedHandler:function(){var a=this;this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers());a.canvas&&(a.canvas._iTextInstances=a.canvas._iTextInstances||[],a.canvas._iTextInstances.push(a))})},initRemovedHandler:function(){var a=this;this.on("removed",function(){a.canvas&&(a.canvas._iTextInstances=a.canvas._iTextInstances||[],g.util.removeFromArray(a.canvas._iTextInstances,
a))})},_initCanvasHandlers:function(){var a=this;this.canvas.on("selection:cleared",function(){g.IText.prototype.exitEditingOnOthers(a.canvas)});this.canvas.on("mouse:up",function(){a.canvas._iTextInstances&&a.canvas._iTextInstances.forEach(function(a){a.__isMousedown=!1})});this.canvas.on("object:selected",function(){g.IText.prototype.exitEditingOnOthers(a.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(a,
d,c,b){var k;k={isAborted:!1,abort:function(){this.isAborted=!0}};a.animate("_currentCursorOpacity",d,{duration:c,onComplete:function(){if(!k.isAborted)a[b]()},onChange:function(){a.canvas&&(a.canvas.clearContext(a.canvas.contextTop||a.ctx),a.renderCursorOrSelection())},abort:function(){return k.isAborted}});return k},_onTickComplete:function(){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){a._currentTickCompleteState=a._animateCursor(a,
0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(a){var d=this;a=a?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);this._currentCursorOpacity=1;this.canvas&&(this.canvas.clearContext(this.canvas.contextTop||this.ctx),this.renderCursorOrSelection());this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){d._tick()},
a)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0);this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},
findWordBoundaryLeft:function(a){var d=0,c=a-1;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)d++,c--;for(;/\S/.test(this.text.charAt(c))&&-1<c;)d++,c--;return a-d},findWordBoundaryRight:function(a){var d=0,c=a;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)d++,c++;for(;/\S/.test(this.text.charAt(c))&&c<this.text.length;)d++,c++;return a+d},findLineBoundaryLeft:function(a){for(var d=0,c=a-1;!/\n/.test(this.text.charAt(c))&&
-1<c;)d++,c--;return a-d},findLineBoundaryRight:function(a){for(var d=0,c=a;!/\n/.test(this.text.charAt(c))&&c<this.text.length;)d++,c++;return a+d},getNumNewLinesInSelectedText:function(){for(var a=this.getSelectedText(),d=0,c=0,b=a.length;c<b;c++)"\n"===a[c]&&d++;return d},searchWordBoundary:function(a,d){for(var c=this._reSpace.test(this.text.charAt(a))?a-1:a,b=this.text.charAt(c),k=/[ \n\.,;!\?\-]/;!k.test(b)&&0<c&&c<this.text.length;)c+=d,b=this.text.charAt(c);k.test(b)&&"\n"!==b&&(c+=1===d?
0:1);return c},selectWord:function(a){var d=this.searchWordBoundary(a,-1);a=this.searchWordBoundary(a,1);this.setSelectionStart(d);this.setSelectionEnd(a)},selectLine:function(a){var d=this.findLineBoundaryLeft(a);a=this.findLineBoundaryRight(a);this.setSelectionStart(d);this.setSelectionEnd(a)},enterEditing:function(a){if(!this.isEditing&&this.editable){this.canvas&&this.exitEditingOnOthers(this.canvas);this.isEditing=!0;this.initHiddenTextarea(a);this.hiddenTextarea.focus();this._updateTextarea();
this._saveEditingProps();this._setEditingProps();this._tick();this.fire("editing:entered");if(!this.canvas)return this;this.canvas.renderAll();this.canvas.fire("text:editing:entered",{target:this});this.initMouseMoveHandler();return this}},exitEditingOnOthers:function(a){a._iTextInstances&&a._iTextInstances.forEach(function(a){a.selected=!1;a.isEditing&&a.exitEditing()})},initMouseMoveHandler:function(){var a=this;this.canvas.on("mouse:move",function(d){a.__isMousedown&&a.isEditing&&(d=a.getSelectionStartFromPointer(d.e),
d>=a.__selectionStartOnMouseDown?(a.setSelectionStart(a.__selectionStartOnMouseDown),a.setSelectionEnd(d)):(a.setSelectionStart(d),a.setSelectionEnd(a.__selectionStartOnMouseDown)))})},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea&&!this.inCompositionMode&&
(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd,this.selectionStart===this.selectionEnd)){var a=this._calcTextareaPosition();this.hiddenTextarea.style.left=a.x+"px";this.hiddenTextarea.style.top=a.y+"px"}},_calcTextareaPosition:function(){var a=this.text.split(""),a=this._getCursorBoundaries(a,"cursor"),d=this.get2DCursorLocation(),c=d.lineIndex,b=d.charIndex,d=this.getCurrentCharFontSize(c,b),b=0===c&&
0===b?this._getLineLeftOffset(this._getLineWidth(this.ctx,c)):a.leftOffset,c=this.calcTransformMatrix(),a={x:a.left+b,y:a.top+a.topOffset+d};this.hiddenTextarea.style.fontSize=d+"px";return g.util.transformPoint(a,c)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},
_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){this.isEditing=this.selected=!1;this.selectable=!0;this.selectionEnd=
this.selectionStart;this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");this.canvas&&this.canvas.fire("text:editing:exited",{target:this});return this},_removeExtraneousStyles:function(){for(var a in this.styles)this._textLines[a]||delete this.styles[a]},_removeCharsFromTo:function(a,d){for(;d!==a;)this._removeSingleCharAndStyle(a+
1),d--;this.setSelectionStart(a)},_removeSingleCharAndStyle:function(a){var d="\n"===this.text[a-1];this.removeStyleObject(d,d?a:a-1);this.text=this.text.slice(0,a-1)+this.text.slice(a);this._textLines=this._splitTextIntoLines()},insertChars:function(a,d){var c;1<this.selectionEnd-this.selectionStart&&(this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart));if(!d&&this.isEmptyStyles())this.insertChar(a,!1);else for(var b=0,k=a.length;b<k;b++)d&&(c=
g.copiedTextStyle[b]),this.insertChar(a[b],b<k-1,c)},insertChar:function(a,d,c){var b="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+a+this.text.slice(this.selectionEnd);this._textLines=this._splitTextIntoLines();this.insertStyleObjects(a,b,c);this.selectionEnd=this.selectionStart+=a.length;d||(this._updateTextarea(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this}))},insertNewlineStyleObject:function(a,
d,c){this.shiftLineStyles(a,1);this.styles[a+1]||(this.styles[a+1]={});var b={},k={};this.styles[a]&&this.styles[a][d-1]&&(b=this.styles[a][d-1]);if(c)k[0]=e(b);else for(var f in this.styles[a])parseInt(f,10)>=d&&(k[parseInt(f,10)-d]=this.styles[a][f],delete this.styles[a][f]);this.styles[a+1]=k;this._forceClearCache=!0},insertCharStyleObject:function(a,d,c){var b=this.styles[a],k=e(b);0!==d||c||(d=1);for(var f in k){var h=parseInt(f,10);h>=d&&(b[h+1]=k[h],k[h-1]||delete b[h])}this.styles[a][d]=c||
e(b[d-1]);this._forceClearCache=!0},insertStyleObjects:function(a,d,c){var b=this.get2DCursorLocation(),k=b.lineIndex,b=b.charIndex;this._getLineStyle(k)||this._setLineStyle(k,{});"\n"===a?this.insertNewlineStyleObject(k,b,d):this.insertCharStyleObject(k,b,c)},shiftLineStyles:function(a,d){var c=e(this.styles),b;for(b in this.styles){var k=parseInt(b,10);k>a&&(this.styles[k+d]=c[k],c[k-d]||delete this.styles[k])}},removeStyleObject:function(a,d){var c=this.get2DCursorLocation(d);this._removeStyleObject(a,
c,c.lineIndex,c.charIndex)},_getTextOnPreviousLine:function(a){return this._textLines[a-1]},_removeStyleObject:function(a,d,c,b){if(a){var k=this._getTextOnPreviousLine(d.lineIndex),k=k?k.length:0;this.styles[c-1]||(this.styles[c-1]={});for(b in this.styles[c])this.styles[c-1][parseInt(b,10)+k]=this.styles[c][b];this.shiftLineStyles(d.lineIndex,-1)}else for(k in(d=this.styles[c])&&delete d[b],c=e(d),c)a=parseInt(k,10),a>=b&&0!==a&&(d[a-1]=c[a],delete d[a])},insertNewline:function(){this.insertChars("\n")}})})();
g.util.object.extend(g.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(e){this.__newClickTime=+new Date;var a=this.canvas.getPointer(e.e);this.isTripleClick(a)?(this.fire("tripleclick",e),this._stopEvent(e.e)):this.isDoubleClick(a)&&(this.fire("dblclick",e),this._stopEvent(e.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=
this.__newClickTime;this.__lastPointer=a;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(e){return 500>this.__newClickTime-this.__lastClickTime&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y&&this.__lastIsEditing},isTripleClick:function(e){return 500>this.__newClickTime-this.__lastClickTime&&500>this.__lastClickTime-this.__lastLastClickTime&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault();
e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(e){this.selectWord(this.getSelectionStartFromPointer(e.e))});this.on("tripleclick",function(e){this.selectLine(this.getSelectionStartFromPointer(e.e))})},initMousedownHandler:function(){this.on("mousedown",function(e){if(this.editable){var a=this.canvas.getPointer(e.e);this.__mousedownX=
a.x;this.__mousedownY=a.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(e.e);this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))}})},_isObjectMoved:function(e){e=this.canvas.getPointer(e);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",function(e){this.__isMousedown=!1;this.editable&&!this._isObjectMoved(e.e)&&
(this.__lastSelected&&!this.__corner&&(this.enterEditing(e.e),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(e){var a=this.getSelectionStartFromPointer(e);e.shiftKey?a<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(a)):this.setSelectionEnd(a):(this.setSelectionStart(a),this.setSelectionEnd(a))},getSelectionStartFromPointer:function(e){e=this.getLocalPointer(e);for(var a=0,d=0,c=0,b=0,k,f=0,h=this._textLines.length;f<h;f++){k=this._textLines[f];
for(var c=c+this._getHeightOfLine(this.ctx,f)*this.scaleY,d=this._getLineWidth(this.ctx,f),d=this._getLineLeftOffset(d)*this.scaleX,n=0,g=k.length;n<g;n++)if(a=d,d+=this._getWidthOfChar(this.ctx,k[n],f,this.flipX?g-n:n)*this.scaleX,c<=e.y||d<=e.x)b++;else return this._getNewSelectionStartFromOffset(e,a,d,b+f,g);if(e.y<c)return this._getNewSelectionStartFromOffset(e,a,d,b+f-1,g)}return this.text.length},_getNewSelectionStartFromOffset:function(e,a,d,c,b){e=c+(d-e.x>e.x-a?0:1);this.flipX&&(e=b-e);e>
this.text.length&&(e=this.text.length);return e}});g.util.object.extend(g.IText.prototype,{initHiddenTextarea:function(e){e&&this.canvas?e=this.canvas.getPointer(e):(this.oCoords||this.setCoords(),e=this.oCoords.tl);this.hiddenTextarea=g.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: absolute; top: "+e.y+"px; left: "+e.x+"px; opacity: 0; width: 0px; height: 0px; z-index: -999;";this.canvas?this.canvas.lowerCanvasEl.parentNode.appendChild(this.hiddenTextarea):
g.document.body.appendChild(this.hiddenTextarea);g.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));g.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this));g.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this));g.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));g.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this));g.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));g.util.addListener(this.hiddenTextarea,
"compositionstart",this.onCompositionStart.bind(this));g.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this));g.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this));!this._clickHandlerInitialized&&this.canvas&&(g.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",
35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",67:"copy",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){this.isEditing&&e.keyCode in this._keysMap&&(this[this._keysMap[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.renderAll())},onKeyUp:function(e){!this.isEditing||this._copyDone?this._copyDone=
!1:e.keyCode in this._ctrlKeysMap&&(e.ctrlKey||e.metaKey)&&(this[this._ctrlKeysMap[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.renderAll())},onInput:function(e){if(this.isEditing&&!this.inCompositionMode){var a=this.selectionStart||0,d=this.selectionEnd||0,c=this.text.length,b=this.hiddenTextarea.value.length;b>c?(a="left"===this._selectionDirection?d:a,c=this.hiddenTextarea.value.slice(a,a+(b-c))):c=this.hiddenTextarea.value.slice(a,a+(b-c+d-a));this.insertChars(c);
e.stopPropagation()}},onCompositionStart:function(){this.inCompositionMode=!0;this.prevCompositionLength=0;this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){e=e.data;this.selectionStart=this.compositionStart;this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd;this.insertChars(e,!1);this.prevCompositionLength=e.length},forwardDelete:function(e){if(this.selectionStart===
this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(e)}this.removeChars(e)},copy:function(e){if(this.selectionStart!==this.selectionEnd){var a=this.getSelectedText(),d=this._getClipboardData(e);d&&d.setData("text",a);g.copiedText=a;g.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd);e.stopImmediatePropagation();e.preventDefault();this._copyDone=!0}},paste:function(e){var a=null,a=this._getClipboardData(e),d=!0;a?(a=a.getData("text").replace(/\r/g,
""),g.copiedTextStyle&&g.copiedText===a||(d=!1)):a=g.copiedText;a&&this.insertChars(a,d);e.stopImmediatePropagation();e.preventDefault()},cut:function(e){this.selectionStart!==this.selectionEnd&&(this.copy(e),this.removeChars(e))},_getClipboardData:function(e){return e&&e.clipboardData||g.window.clipboardData},getDownCursorOffset:function(e,a){var d=a?this.selectionEnd:this.selectionStart,c=this.get2DCursorLocation(d),b=c.lineIndex,k=this._textLines[b].slice(0,c.charIndex),f=this._textLines[b].slice(c.charIndex),
h=this._textLines[b+1]||"";if(b===this._textLines.length-1||e.metaKey||34===e.keyCode)return this.text.length-d;for(var d=this._getLineWidth(this.ctx,b),n=this._getLineLeftOffset(d),g=0,r=k.length;g<r;g++)d=k[g],n+=this._getWidthOfChar(this.ctx,d,b,g);c=this._getIndexOnNextLine(c,h,n);return f.length+1+c},_getIndexOnNextLine:function(e,a,d){var c=e.lineIndex+1;e=this._getLineWidth(this.ctx,c);var b=this._getLineLeftOffset(e),k=0,f;e=0;for(var h=a.length;e<h;e++){var n=this._getWidthOfChar(this.ctx,
a[e],c,e),b=b+n;if(b>d){f=!0;c=b;b=Math.abs(b-n-d);k=Math.abs(c-d)<b?e+1:e;break}}f||(k=a.length);return k},moveCursorDown:function(e){this.abortCursorAnimation();this._currentCursorOpacity=1;var a=this.getDownCursorOffset(e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorDownWithShift(a):this.moveCursorDownWithoutShift(a);this.initDelayedCursor()},moveCursorDownWithoutShift:function(e){this._selectionDirection="right";this.setSelectionStart(this.selectionStart+e);this.setSelectionEnd(this.selectionStart)},
swapSelectionPoints:function(){var e=this.selectionEnd;this.setSelectionEnd(this.selectionStart);this.setSelectionStart(e)},moveCursorDownWithShift:function(e){this.selectionEnd===this.selectionStart&&(this._selectionDirection="right");"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd+e):this.setSelectionStart(this.selectionStart+e);this.selectionEnd<this.selectionStart&&"left"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="right");this.selectionEnd>
this.text.length&&this.setSelectionEnd(this.text.length)},getUpCursorOffset:function(e,a){var d=a?this.selectionEnd:this.selectionStart,c=this.get2DCursorLocation(d),b=c.lineIndex;if(0===b||e.metaKey||33===e.keyCode)return d;var d=this._textLines[b].slice(0,c.charIndex),k=this._textLines[b-1]||"",f;f=this._getLineWidth(this.ctx,c.lineIndex);for(var h=this._getLineLeftOffset(f),n=0,g=d.length;n<g;n++)f=d[n],h+=this._getWidthOfChar(this.ctx,f,b,n);c=this._getIndexOnPrevLine(c,k,h);return k.length-c+
d.length},_getIndexOnPrevLine:function(e,a,d){var c=e.lineIndex-1;e=this._getLineWidth(this.ctx,c);var b=this._getLineLeftOffset(e),k=0,f;e=0;for(var h=a.length;e<h;e++){var n=this._getWidthOfChar(this.ctx,a[e],c,e),b=b+n;if(b>d){f=!0;c=b;b=Math.abs(b-n-d);k=Math.abs(c-d)<b?e:e-1;break}}f||(k=a.length-1);return k},moveCursorUp:function(e){this.abortCursorAnimation();this._currentCursorOpacity=1;var a=this.getUpCursorOffset(e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorUpWithShift(a):
this.moveCursorUpWithoutShift(a);this.initDelayedCursor()},moveCursorUpWithShift:function(e){this.selectionEnd===this.selectionStart&&(this._selectionDirection="left");"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd-e):this.setSelectionStart(this.selectionStart-e);this.selectionEnd<this.selectionStart&&"right"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="left")},moveCursorUpWithoutShift:function(e){this.selectionStart===this.selectionEnd&&
this.setSelectionStart(this.selectionStart-e);this.setSelectionEnd(this.selectionStart);this._selectionDirection="left"},moveCursorLeft:function(e){if(0!==this.selectionStart||0!==this.selectionEnd)this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorLeftWithShift(e):this.moveCursorLeftWithoutShift(e),this.initDelayedCursor()},_move:function(e,a,d){var c="selectionStart"===a?"setSelectionStart":"setSelectionEnd";if(e.altKey)this[c](this["findWordBoundary"+d](this[a]));
else if(e.metaKey||35===e.keyCode||36===e.keyCode)this[c](this["findLineBoundary"+d](this[a]));else this[c](this[a]+("Left"===d?-1:1))},_moveLeft:function(e,a){this._move(e,a,"Left")},_moveRight:function(e,a){this._move(e,a,"Right")},moveCursorLeftWithoutShift:function(e){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(e,"selectionStart");this.setSelectionEnd(this.selectionStart)},moveCursorLeftWithShift:function(e){"right"===this._selectionDirection&&this.selectionStart!==
this.selectionEnd?this._moveLeft(e,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(e,"selectionStart"))},moveCursorRight:function(e){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorRightWithShift(e):this.moveCursorRightWithoutShift(e),this.initDelayedCursor())},moveCursorRightWithShift:function(e){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?
this._moveRight(e,"selectionStart"):(this._selectionDirection="right",this._moveRight(e,"selectionEnd"))},moveCursorRightWithoutShift:function(e){this._selectionDirection="right";this.selectionStart===this.selectionEnd?(this._moveRight(e,"selectionStart"),this.setSelectionEnd(this.selectionStart)):(this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText()),this.setSelectionStart(this.selectionEnd))},removeChars:function(e){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(e):
this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.setSelectionEnd(this.selectionStart);this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(e){0!==this.selectionStart&&(e.metaKey?(e=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)):e.altKey?(e=this.findWordBoundaryLeft(this.selectionStart),
this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)):(this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)))}});(function(){var e=g.util.toFixed,a=g.Object.NUM_FRACTION_DIGITS;g.util.object.extend(g.IText.prototype,{_setSVGTextLineText:function(a,c,b,k,f,h){this._getLineStyle(a)?this._setSVGTextLineChars(a,c,b,k,h):g.Text.prototype._setSVGTextLineText.call(this,a,c,b,k,f)},_setSVGTextLineChars:function(a,c,b,k,f){b=this._textLines[a];
k=0;for(var h=this._getLineLeftOffset(this._getLineWidth(this.ctx,a))-this.width/2,e=this._getSVGLineTopOffset(a),g=this._getHeightOfLine(this.ctx,a),r=0,m=b.length;r<m;r++){var u=this._getStyleDeclaration(a,r)||{};c.push(this._createTextCharSpan(b[r],u,h,e.lineTop+e.offset,k));var t=this._getWidthOfChar(this.ctx,b[r],a,r);u.textBackgroundColor&&f.push(this._createTextCharBg(u,h,e.lineTop,g,t,k));k+=t}},_getSVGLineTopOffset:function(a){for(var c=0,b=0,b=0;b<a;b++)c+=this._getHeightOfLine(this.ctx,
b);b=this._getHeightOfLine(this.ctx,b);return{lineTop:c,offset:(this._fontSizeMult-this._fontSizeFraction)*b/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(d,c,b,k,f,h){return['\t\t<rect fill="',d.textBackgroundColor,'" x="',e(c+h,a),'" y="',e(b-this.height/2,a),'" width="',e(f,a),'" height="',e(k/this.lineHeight,a),'"></rect>\n'].join("")},_createTextCharSpan:function(d,c,b,k,f){var h=this.getSvgStyles.call(g.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",
getSvgFilter:g.Object.prototype.getSvgFilter},c));return['\t\t\t<tspan x="',e(b+f,a),'" y="',e(k-this.height/2,a),'" ',c.fontFamily?'font-family="'+c.fontFamily.replace(/"/g,"'")+'" ':"",c.fontSize?'font-size="'+c.fontSize+'" ':"",c.fontStyle?'font-style="'+c.fontStyle+'" ':"",c.fontWeight?'font-weight="'+c.fontWeight+'" ':"",c.textDecoration?'text-decoration="'+c.textDecoration+'" ':"",'style="',h,'">',g.util.string.escapeXml(d),"</tspan>\n"].join("")}})})();(function(e){var a=e.fabric||(e.fabric=
{}),d=a.util.object.clone;a.Textbox=a.util.createClass(a.IText,a.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:0,__cachedLines:null,initialize:function(c,b){this.ctx=a.util.createCanvasElement().getContext("2d");this.callSuper("initialize",c,b);this.set({lockUniScaling:!1,lockScalingY:!0,lockScalingFlip:!0,hasBorders:!0});this.setControlsVisibility(a.Textbox.getTextboxControlVisibility());this._dimensionAffectingProps.width=!0},_initDimensions:function(c){this.__skipDimension||(c||(c=a.util.createCanvasElement().getContext("2d"),
this._setTextStyles(c)),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(c))},_generateStyleMap:function(){for(var a=0,b=0,k=0,f={},h=0;h<this._textLines.length;h++)"\n"===this.text[k]?(b=0,k++,a++):" "===this.text[k]&&(b++,k++),f[h]={line:a,offset:b},k+=this._textLines[h].length,b+=this._textLines[h].length;return f},_getStyleDeclaration:function(a,b,k){if(this._styleMap){var f=
this._styleMap[a];if(!f)return k?{}:null;a=f.line;b=f.offset+b}return this.callSuper("_getStyleDeclaration",a,b,k)},_setStyleDeclaration:function(a,b,k){var f=this._styleMap[a];a=f.line;b=f.offset+b;this.styles[a][b]=k},_deleteStyleDeclaration:function(a,b){var k=this._styleMap[a];a=k.line;b=k.offset+b;delete this.styles[a][b]},_getLineStyle:function(a){return this.styles[this._styleMap[a].line]},_setLineStyle:function(a,b){this.styles[this._styleMap[a].line]=b},_deleteLineStyle:function(a){delete this.styles[this._styleMap[a].line]},
_wrapText:function(a,b){var k=b.split(this._reNewline),f=[],h;for(h=0;h<k.length;h++)f=f.concat(this._wrapLine(a,k[h],h));return f},_measureText:function(a,b,k,f){var h=0;f=f||0;for(var d=0,e=b.length;d<e;d++)h+=this._getWidthOfChar(a,b[d],k,d+f);return h},_wrapLine:function(a,b,k){var f=0,h=[],d="";b=b.split(" ");for(var e="",g=0,m=0,u=0,t=0,H=!0,F=0;F<b.length;F++)e=b[F],m=this._measureText(a,e,k,g),g+=e.length,f+=u+m,f>=this.width&&!H&&(h.push(d),d="",f=m,H=!0),H||(d+=" "),d+=e,u=this._measureText(a,
" ",k,g),g++,H=!1,m>t&&(t=m);F&&h.push(d);t>this.dynamicMinWidth&&(this.dynamicMinWidth=t);return h},_splitTextIntoLines:function(){var a=this.textAlign;this.ctx.save();this._setTextStyles(this.ctx);this.textAlign="left";var b=this._wrapText(this.ctx,this.text);this.textAlign=a;this.ctx.restore();this._textLines=b;this._styleMap=this._generateStyleMap();return b},setOnGroup:function(a,b){"scaleX"===a&&(this.set("scaleX",Math.abs(1/b)),this.set("width",this.get("width")*b/("undefined"===typeof this.__oldScaleX?
1:this.__oldScaleX)),this.__oldScaleX=b)},get2DCursorLocation:function(a){"undefined"===typeof a&&(a=this.selectionStart);for(var b=this._textLines.length,k=0,f=0;f<b;f++){var h=this._textLines[f].length;if(a<=k+h)return{lineIndex:f,charIndex:a-k};k+=h;"\n"!==this.text[k]&&" "!==this.text[k]||k++}return{lineIndex:b-1,charIndex:this._textLines[b-1].length}},_getCursorBoundariesOffsets:function(a,b){for(var k=0,f=0,h=this.get2DCursorLocation(),d=this._textLines[h.lineIndex].split(""),e=this._getLineLeftOffset(this._getLineWidth(this.ctx,
h.lineIndex)),g=0;g<h.charIndex;g++)f+=this._getWidthOfChar(this.ctx,d[g],h.lineIndex,g);for(g=0;g<h.lineIndex;g++)k+=this._getHeightOfLine(this.ctx,g);"cursor"===b&&(k+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,h.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(h.lineIndex,h.charIndex)*(1-this._fontSizeFraction));return{top:k,left:f,lineLeft:e}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(c){return a.util.object.extend(this.callSuper("toObject",
c),{minWidth:this.minWidth})}});a.Textbox.fromObject=function(c){return new a.Textbox(c.text,d(c))};a.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}};a.Textbox.instances=[]})("undefined"!==typeof p?p:this);(function(){var e=g.Canvas.prototype._setObjectScale;g.Canvas.prototype._setObjectScale=function(a,c,b,k,f,h,n){var q=c.target;q instanceof g.Textbox?(a=a.x/c.scaleX/(q.width+q.strokeWidth)*q.width,a>=q.getMinWidth()&&q.set("width",
a)):e.call(g.Canvas.prototype,a,c,b,k,f,h,n)};g.Group.prototype._refreshControlsVisibility=function(){if("undefined"!==typeof g.Textbox)for(var a=this._objects.length;a--;)if(this._objects[a]instanceof g.Textbox){this.setControlsVisibility(g.Textbox.getTextboxControlVisibility());break}};var a=g.util.object.clone;g.util.object.extend(g.Textbox.prototype,{_removeExtraneousStyles:function(){for(var a in this._styleMap)this._textLines[a]||delete this.styles[this._styleMap[a].line]},insertCharStyleObject:function(a,
c,b){var k=this._styleMap[a];a=k.line;c=k.offset+c;g.IText.prototype.insertCharStyleObject.apply(this,[a,c,b])},insertNewlineStyleObject:function(a,c,b){var k=this._styleMap[a];a=k.line;c=k.offset+c;g.IText.prototype.insertNewlineStyleObject.apply(this,[a,c,b])},shiftLineStyles:function(d,c){var b=a(this.styles);d=this._styleMap[d].line;for(var k in this.styles){var f=parseInt(k,10);f>d&&(this.styles[f+c]=b[f],b[f-c]||delete this.styles[f])}},_getTextOnPreviousLine:function(a){for(var c=this._textLines[a-
1];this._styleMap[a-2]&&this._styleMap[a-2].line===this._styleMap[a-1].line;)c=this._textLines[a-2]+c,a--;return c},removeStyleObject:function(a,c){var b=this.get2DCursorLocation(c),k=this._styleMap[b.lineIndex];this._removeStyleObject(a,b,k.line,k.offset+b.charIndex)}})})();(function(){var e=g.IText.prototype._getNewSelectionStartFromOffset;g.IText.prototype._getNewSelectionStartFromOffset=function(a,d,c,b,k){b=e.call(this,a,d,c,b,k);for(c=d=a=0;c<this._textLines.length;c++){a+=this._textLines[c].length;
if(a+d>=b)break;"\n"!==this.text[a+d]&&" "!==this.text[a+d]||d++}return b-c+d}})();(function(){function e(a,f,h){var d=c.parse(a);d.port||(d.port=0===d.protocol.indexOf("https:")?443:80);a=(0===d.protocol.indexOf("https:")?k:b).request({hostname:d.hostname,port:d.port,path:d.path,method:"GET"},function(b){var a="";f&&b.setEncoding(f);b.on("end",function(){h(a)});b.on("data",function(f){200===b.statusCode&&(a+=f)})});a.on("error",function(b){b.errno===process.ECONNREFUSED?g.log("ECONNREFUSED: connection refused to "+
d.hostname+":"+d.port):g.log(b.message);h(null)});a.end()}function a(b,a){require("fs").readFile(b,function(b,f){if(b)throw g.log(b),b;a(f)})}if("undefined"===typeof document||"undefined"===typeof A){var d=require("xmldom").DOMParser,c=require("url"),b=require("http"),k=require("https"),f=require("canvas"),h=require("canvas").Image;g.util.loadImage=function(b,f,c){function k(a){a?(d.src=new Buffer(a,"binary"),d._src=b,f&&f.call(c,d)):(d=null,f&&f.call(c,null,!0))}var d=new h;b&&(b instanceof Buffer||
0===b.indexOf("data"))?(d.src=d._src=b,f&&f.call(c,d)):b&&0!==b.indexOf("http")?a(b,k):b?e(b,"binary",k):f&&f.call(c,b)};g.loadSVGFromURL=function(b,f,c){b=b.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();0!==b.indexOf("http")?a(b,function(b){g.loadSVGFromString(b.toString(),f,c)}):e(b,"",function(b){g.loadSVGFromString(b,f,c)})};g.loadSVGFromString=function(b,a,f){b=(new d).parseFromString(b);g.parseSVGDocument(b.documentElement,function(b,f){a&&a(b,f)},f)};g.util.getScript=function(b,a){e(b,"",
function(b){eval(b);a&&a()})};g.Image.fromObject=function(b,a){g.util.loadImage(b.src,function(f){var c=new g.Image(f);c._initConfig(b);c._initFilters(b.filters,function(f){c.filters=f||[];c._initFilters(b.resizeFilters,function(b){c.resizeFilters=b||[];a&&a(c)})})})};g.createCanvasForNode=function(b,a,c,h){h=h||c;var k=g.document.createElement("canvas");b=new f(b||600,a||600,h);k.style={};k.width=b.width;k.height=b.height;c=new (g.Canvas||g.StaticCanvas)(k,c);c.contextContainer=b.getContext("2d");
c.nodeCanvas=b;c.Font=f.Font;return c};g.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};g.StaticCanvas.prototype.createJPEGStream=function(b){return this.nodeCanvas.createJPEGStream(b)};var n=g.StaticCanvas.prototype.setWidth;g.StaticCanvas.prototype.setWidth=function(b,a){n.call(this,b,a);this.nodeCanvas.width=b;return this};g.Canvas&&(g.Canvas.prototype.setWidth=g.StaticCanvas.prototype.setWidth);var q=g.StaticCanvas.prototype.setHeight;g.StaticCanvas.prototype.setHeight=
function(b,a){q.call(this,b,a);this.nodeCanvas.height=b;return this};g.Canvas&&(g.Canvas.prototype.setHeight=g.StaticCanvas.prototype.setHeight)}})();g.Object.prototype.drawBorders=function(e){if(!this.hasBorders)return this;var a=this._calculateCurrentDimensions(),d=1/this.borderScaleFactor,c=a.x+d,a=a.y+d;e.save();e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;e.strokeStyle=this.borderColor;e.lineWidth=d;d=this.borderStrokeDashArray?this.borderStrokeDashArray:[1E3,0];e.beginPath();g.util.drawDashedLine(e,
-c/2,-a/2,-c/2,+a/2,d);g.util.drawDashedLine(e,-c/2,+a/2,+c/2,+a/2,d);g.util.drawDashedLine(e,+c/2,+a/2,+c/2,-a/2,d);g.util.drawDashedLine(e,+c/2,-a/2,-c/2,-a/2,d);e.closePath();e.stroke();this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(c=-a/2,e.beginPath(),g.util.drawDashedLine(e,0,c-this.rotatingPointOffset,0,c,d),e.closePath(),e.stroke());e.restore();return this};return g})});
(function(C){var A=window.AmazonUIPageJS||window.P,v=A._namespace||A.attributeErrors,l=v?v("AmazonCustomCommonAssets"):A;l.guardFatal?l.guardFatal(C)(l,window):l.execute(function(){C(l,window)})})(function(C,A,v){C.when("A","ready").register("acc-util",function(l){return{}});C.when("A","ready").register("acc-font",function(l){(function(){var p=l.$,g=[],e=l.state("ctsStateData");if(l.objectIsEmpty(e))for(e=0;3>e;e++){var a=l.state("ctsStateInfo"+e);l.objectIsEmpty(a)||g.push(a)}else g=
e.surfaces;g.length&&l.each(g,function(a){if(a.FontSettings&&a.FontSettings.fonts){var c=a.FontSettings.fonts;l.each(c,function(b){if(b.fontURL&&b.isActive){var a;a=c.length;b=b.fontURL.split("/");1>b.length?a=null:(b=b[b.length-1].split("."),a=1>b.length?null:"ac_"+a+"_"+b[0].substring(0,20));a&&p("<span>&nbsp;</span>").css("font-family",a).appendTo("body")}})}})})()});C.when("A","acc-weblab-is-required","acc-weblab-bbq-updates","acc-weblab-enable-tabletapp","ready").register("acc-weblab",
function(l,p,g,e){var a={},d={};d[p.name]=p.treatment;d[g.name]=g.treatment;d[e.name]=e.treatment;a.getTreatment=function(a){var b=d[a];return l.objectIsEmpty(b)?(A.console&&console.log("Weblab "+a+" not found"),v):b};a.isT1=function(c){return"T1"===a.getTreatment(c)};return a});C.when("A").register("acc-weblab-is-required",function(l){return{name:"AC_ENABLED_ATC_REQUIRED_TEXT_LAUNCH_75411",treatment:"T1"}});C.when("A").register("acc-weblab-bbq-updates",function(l){return{name:"AMAZON_CUSTOM_BBQ_UPDATES_70086",
treatment:"T1"}});C.when("A").register("acc-weblab-enable-tabletapp",function(l){return{name:"AC_PRODUCT_TABLETAPP_75334",treatment:"C"}})});
(function(C){var A=window.AmazonUIPageJS||window.P,v=A._namespace||A.attributeErrors,l=v?v("AmazonCustomBuyBoxAssets"):A;l.guardFatal?l.guardFatal(C)(l,window):l.execute(function(){C(l,window)})})(function(C,A,v){(function(){C.when("A","acc-weblab","ready").register("BuyBox",function(l,p){return function(g){function e(){var b={},a={},f=!1;q.controller!==v&&(b=q.controller.getJSON());a.customizationData=JSON.stringify(b);g("#amazonCustomUseCaseId").length&&(a.clientId=g("#amazonCustomUseCaseId").val());
g(".pc-error-container").hide();f=H(b);l.post("/gp/product/features/callSetCustomizationDatav2.html",{dataType:"json",params:a,contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(b){f&&l.trigger("amazon-custom-log-ref-tag","hasNonASCII",{msg:b.result.pcToken});"OK"===b.result.Status&&b.result.pcToken!==v?(l.trigger("amazon-custom-log-ref-tag","AddToCartClick"),g("#UNIQ-pcToken",g(".pc-buy-box")).val(b.result.pcToken),g("#addToCart").submit()):g(".pc-error-container").show()},
error:function(b){g(".pc-error-container").show()}})}function a(b){var a=g("#pc-atc"),f=g(".pc-atc-wrapper");b?(a.prop("disabled",!1),f.removeClass("a-button-disabled")):(a.prop("disabled",!0),f.addClass("a-button-disabled"))}function d(b,a){k(g(".pc-atc-missing-customization"),b,a)}function c(b,a){k(g(".pc-atc-missing-required-text"),b,a)}function b(b,a){k(g(".pc-atc-containing-emoji"),b,a)}function k(b,a,f){a?b.show():b.hide();f&&f.error?b.addClass("a-color-error"):b.removeClass("a-color-error")}
function f(b){r=!0;b&&(m=b.callback)}function h(){r=!1;m=null}var n={$el:v,showLabel:!0,controller:v},q={},r=!1,m=null,u=function(b){q=g.extend({},n,b);return this};u.prototype.getComponentName=function(){return"BuyBox"};u.prototype.Init=function(){t.Bind();p.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_LAUNCH_75411")&&(d(!1),c(!1),b(!1))};var t={Bind:function(){l.declarative("upload-metadata","click",function(b){b.$event.preventDefault();g("#pc-atc").is(":disabled")||(p.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_LAUNCH_75411")&&
r?g.isFunction(m)&&m():(l.trigger("amazon-custom-popup-close",new Date),e()))});l.on("enableBuybox",function(){a(!0)});l.on("disableBuybox",function(){a(!1)});p.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_LAUNCH_75411")&&(l.on("showMissingCustomization",function(b){d(!0,b)}),l.on("hideMissingCustomization",function(){d(!1)}),l.on("showMissingRequiredFields",function(b){c(!0,b)}),l.on("hideMissingRequiredFields",function(){c(!1)}),l.on("showContainingEmoji",function(a){b(!0,a)}),l.on("hideContainingEmoji",
function(){b(!1)}),l.on("blockBuybox",f),l.on("unblockBuybox",h))}},H=function(b){b=b.customizationInfo["version3.0"].surfaces;for(var a=new RegExp(/[^\x00-\x7F]+/g),f=0;f<b.length;f++)for(var c=0;c<b[f].areas.length;c++)if("TextPrinting"===b[f].areas[c].customizationType&&a.test(b[f].areas[c].text))return!0;return!1};return u}(l.$)})})();C.when("a-modal","ac-ajax-customizer","acc-weblab").execute(function(l,p,g){g.isT1("AMAZON_CUSTOM_BBQ_UPDATES_70086")&&(new p({viewFactory:l,viewName:"pc-popover-content",
deviceType:"web"})).init(!0)})});